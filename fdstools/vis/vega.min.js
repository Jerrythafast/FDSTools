!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.vg=e()}}(function(){var e;return function t(e,n,r){function i(s,o){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){t.exports={version:"2.2.4",dataflow:e("vega-dataflow"),parse:e("./src/parse/"),scene:{Bounder:e("./src/scene/Bounder"),Builder:e("./src/scene/Builder"),Encoder:e("./src/scene/Encoder"),GroupBuilder:e("./src/scene/GroupBuilder")},transforms:e("./src/transforms"),schema:e("./src/core/schema"),config:e("./src/core/config"),util:e("datalib"),debug:e("vega-logging").debug}},{"./src/core/config":88,"./src/core/schema":89,"./src/parse/":95,"./src/scene/Bounder":107,"./src/scene/Builder":108,"./src/scene/Encoder":109,"./src/scene/GroupBuilder":110,"./src/transforms":139,datalib:24,"vega-dataflow":39,"vega-logging":45}],2:[function(e,t,n){},{}],3:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.dsv={})}(this,function(e){"use strict";var t=function(e){function t(e,t){var r;return n(e,function(e,n){if(r)return r(e,n-1);var i=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");r=t?function(e,n){return t(i(e),n)}:i})}function n(e,t){function n(){if(c>=l)return s;if(i)return i=!1,a;var t=c;if(34===e.charCodeAt(t)){for(var n=t;n++<l;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}c=n+2;var r=e.charCodeAt(n+1);return 13===r?(i=!0,10===e.charCodeAt(n+2)&&++c):10===r&&(i=!0),e.slice(t+1,n).replace(/""/g,'"')}for(;l>c;){var r=e.charCodeAt(c++),o=1;if(10===r)i=!0;else if(13===r)i=!0,10===e.charCodeAt(c)&&(++c,++o);else if(r!==u)continue;return e.slice(t,c-o)}return e.slice(t)}for(var r,i,a={},s={},o=[],l=e.length,c=0,d=0;(r=n())!==s;){for(var f=[];r!==a&&r!==s;)f.push(r),r=n();t&&null==(f=t(f,d++))||o.push(f)}return o}function r(t){if(Array.isArray(t[0]))return i(t);var n=Object.create(null),r=[];return t.forEach(function(e){for(var t in e)(t+="")in n||r.push(n[t]=t)}),[r.map(s).join(e)].concat(t.map(function(t){return r.map(function(e){return s(t[e])}).join(e)})).join("\n")}function i(e){return e.map(a).join("\n")}function a(t){return t.map(s).join(e)}function s(e){return o.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var o=new RegExp('["'+e+"\n]"),u=e.charCodeAt(0);return{parse:t,parseRows:n,format:r,formatRows:i}};e.csv=t(","),e.tsv=t("	"),e.dsv=t})},{}],4:[function(t,n,r){"undefined"==typeof Map?(Map=function(){this.clear()},Map.prototype={set:function(e,t){return this._[e]=t,this},get:function(e){return this._[e]},has:function(e){return e in this._},"delete":function(e){return e in this._&&delete this._[e]},clear:function(){this._=Object.create(null)},get size(){var e=0;for(var t in this._)++e;return e},forEach:function(e){for(var t in this._)e(this._[t],t,this)}}):function(){var e=new Map;e.set(0,0)!==e&&(e=e.set,Map.prototype.set=function(){return e.apply(this,arguments),this})}(),function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.format={})}(this,function(e){"use strict";function t(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function n(e){return e=t(Math.abs(e)),e?e[1]:NaN}function r(e,n){var r=t(e,n);if(!r)return e+"";var i=r[0],a=r[1],s=a-(g=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+t(e,n+s-1)[0]}function i(e,n){var r=t(e,n);if(!r)return e+"";var i=r[0],a=r[1];return 0>a?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}function a(e,t){e=e.toPrecision(t);e:for(var n,r=e.length,i=1,a=-1;r>i;++i)switch(e[i]){case".":a=n=i;break;case"0":0===a&&(a=i),n=i;break;case"e":break e;default:a>0&&(a=0)}return a>0?e.slice(0,a)+e.slice(n+1):e}function s(e){return new o(e)}function o(e){if(!(t=I.exec(e)))throw new Error("invalid format: "+e);var t,n=t[1]||" ",r=t[2]||">",i=t[3]||"-",a=t[4]||"",s=!!t[5],o=t[6]&&+t[6],u=!!t[7],l=t[8]&&+t[8].slice(1),c=t[9]||"";"n"===c?(u=!0,c="g"):P[c]||(c=""),(s||"0"===n&&"="===r)&&(s=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=a,this.zero=s,this.width=o,this.comma=u,this.precision=l,this.type=c}function u(e,t){return function(n,r){for(var i=n.length,a=[],s=0,o=e[0],u=0;i>0&&o>0&&(u+o+1>r&&(o=Math.max(1,r-u)),a.push(n.substring(i-=o,i+o)),!((u+=o+1)>r));)o=e[s=(s+1)%e.length];return a.reverse().join(t)}}function l(e){return e}function c(e){function t(e){e=s(e);var t=e.fill,n=e.align,r=e.sign,u=e.symbol,l=e.zero,c=e.width,d=e.comma,f=e.precision,h=e.type,p="$"===u?a[0]:"#"===u&&/[boxX]/.test(h)?"0"+h.toLowerCase():"",m="$"===u?a[1]:/[%p]/.test(h)?"%":"",v=P[h],y=!h||/[defgprs%]/.test(h);return f=null==f?h?6:12:/[gprs]/.test(h)?Math.max(1,Math.min(21,f)):Math.max(0,Math.min(20,f)),function(e){var a=p,s=m;if("c"===h)s=v(e)+s,e="";else{e=+e;var u=(0>e||0>1/e)&&(e*=-1,!0);if(e=v(e,f),a=(u?"("===r?r:"-":"-"===r||"("===r?"":r)+a,s=s+("s"===h?O[8+g/3]:"")+(u&&"("===r?")":""),y)for(var _,b=-1,x=e.length;++b<x;)if(_=e.charCodeAt(b),48>_||_>57){s=(46===_?o+e.slice(b+1):e.slice(b))+s,e=e.slice(0,b);break}}d&&!l&&(e=i(e,1/0));var w=a.length+e.length+s.length,k=c>w?new Array(c-w+1).join(t):"";switch(d&&l&&(e=i(k+e,k.length?c-s.length:1/0),k=""),n){case"<":return a+e+s+k;case"=":return a+k+e+s;case"^":return k.slice(0,w=k.length>>1)+a+e+s+k.slice(w)}return k+a+e+s}}function r(e,r){var i=t((e=s(e),e.type="f",e)),a=3*Math.max(-8,Math.min(8,Math.floor(n(r)/3))),o=Math.pow(10,-a),u=O[8+a/3];return function(e){return i(o*e)+u}}var i=e.grouping&&e.thousands?u(e.grouping,e.thousands):l,a=e.currency,o=e.decimal;return{format:t,formatPrefix:r}}function d(e,t){return Math.max(0,n(Math.abs(t))-n(Math.abs(e)))+1}function f(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(n(t)/3)))-n(Math.abs(e)))}function h(e){return Math.max(0,-n(Math.abs(e)))}function p(e){return"string"!=typeof e||(e=U.get(e))?c(e):null}var g,m={decimal:".",thousands:",",grouping:[3],currency:["¥",""]},v={decimal:",",thousands:" ",grouping:[3],currency:[""," руб."]},y={decimal:",",thousands:".",grouping:[3],currency:["R$",""]},_={decimal:",",thousands:".",grouping:[3],currency:["","zł"]},b={decimal:",",thousands:".",grouping:[3],currency:["€ ",""]},x={decimal:",",thousands:".",grouping:[3],currency:[""," ден."]},w={decimal:",",thousands:".",grouping:[3],currency:["€",""]},k={decimal:".",thousands:",",grouping:[3],currency:["₪",""]},S={decimal:",",thousands:".",grouping:[3],currency:[""," €"]},M={decimal:",",thousands:" ",grouping:[3],currency:["","$"]},T={decimal:",",thousands:" ",grouping:[3],currency:[""," €"]},A={decimal:",",thousands:".",grouping:[3],currency:[""," €"]},E={decimal:".",thousands:",",grouping:[3],currency:["$",""]},L={decimal:".",thousands:",",grouping:[3],currency:["£",""]},C={decimal:".",thousands:",",grouping:[3],currency:["$",""]},D={decimal:",",thousands:".",grouping:[3],currency:[""," €"]},N={decimal:",",thousands:".",grouping:[3],currency:[""," €"]},P={"":a,"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return i(100*e,t)},r:i,s:r,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}},I=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;o.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var O=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"],U=(new Map).set("ca-ES",N).set("de-DE",D).set("en-CA",C).set("en-GB",L).set("en-US",E).set("es-ES",A).set("fi-FI",T).set("fr-CA",M).set("fr-FR",S).set("he-IL",k).set("it-IT",w).set("mk-MK",x).set("nl-NL",b).set("pl-PL",_).set("pt-BR",y).set("ru-RU",v).set("zh-CN",m),z=c(E);e.format=z.format,e.formatPrefix=z.formatPrefix,e.localeFormat=p,e.formatSpecifier=s,e.precisionFixed=h,e.precisionPrefix=f,e.precisionRound=d})},{}],5:[function(t,n,r){"undefined"==typeof Map?(Map=function(){this.clear()},Map.prototype={set:function(e,t){return this._[e]=t,this},get:function(e){return this._[e]},has:function(e){return e in this._},"delete":function(e){return e in this._&&delete this._[e]},clear:function(){this._=Object.create(null)},get size(){var e=0;for(var t in this._)++e;return e},forEach:function(e){for(var t in this._)e(this._[t],t,this)}}):function(){var e=new Map;e.set(0,0)!==e&&(e=e.set,Map.prototype.set=function(){return e.apply(this,arguments),this})}(),function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.timeFormat={})}(this,function(e){"use strict";function t(e,n,r){function i(t){return e(t=new Date(+t)),t}return i.floor=i,i.round=function(t){var r=new Date(+t),i=new Date(t-1);return e(r),e(i),n(i,1),i-t>t-r?r:i},i.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},i.offset=function(e,t){return n(e=new Date(+e),null==t?1:Math.floor(t)),e},i.range=function(t,r,i){var a=[];if(t=new Date(t-1),r=new Date(+r),i=null==i?1:Math.floor(i),!(r>t&&i>0))return a;for(n(t,1),e(t),r>t&&a.push(new Date(+t));n(t,i),e(t),r>t;)a.push(new Date(+t));return a},i.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(i.count=function(t,n){return be.setTime(+t),xe.setTime(+n),e(be),e(xe),Math.floor(r(be,xe))}),i}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}function i(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function a(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function s(e){return{y:e,m:0,d:1,H:0,M:0,S:0,L:0}}function o(e){function t(e,t){return function(n){for(var r,i,a,s=[],o=-1,u=0,l=e.length;++o<l;)37===e.charCodeAt(o)&&(s.push(e.slice(u,o)),null!=(i=Ce[r=e.charAt(++o)])&&(r=e.charAt(++o)),(a=t[r])&&(r=a(n,null==i?"e"===r?" ":"0":i)),s.push(r),u=o+1);return s.push(e.slice(u,o)),s.join("")}}function n(e,t){return function(n){var i=s(1900),o=r(i,e,n,0);if(o!=n.length)return null;if("p"in i&&(i.H=i.H%12+12*i.p),"Z"in i){if("w"in i&&("W"in i||"U"in i)){var u=a(s(i.y)).getUTCDay();"W"in i&&(i.U=i.W,i.w=(i.w+6)%7,--u),i.m=0,i.d=i.w+7*i.U-(u+6)%7}return i.H+=i.Z/100|0,i.M+=i.Z%100,a(i)}if("w"in i&&("W"in i||"U"in i)){var u=t(s(i.y)).getDay();"W"in i&&(i.U=i.W,i.w=(i.w+6)%7,--u),i.m=0,i.d=i.w+7*i.U-(u+6)%7}return t(i)}}function r(e,t,n,r){for(var i,a,s=0,o=t.length,u=n.length;o>s;){if(r>=u)return-1;if(i=t.charCodeAt(s++),37===i){if(i=t.charAt(s++),a=Ue[i in Ce?t.charAt(s++):i],!a||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function o(e,t,n){var r=Ae.exec(t.slice(n));return r?(e.w=Ee.get(r[0].toLowerCase()),n+r[0].length):-1}function u(e,t,n){var r=Me.exec(t.slice(n));return r?(e.w=Te.get(r[0].toLowerCase()),n+r[0].length):-1}function l(e,t,n){var r=Ne.exec(t.slice(n));return r?(e.m=Pe.get(r[0].toLowerCase()),n+r[0].length):-1}function te(e,t,n){var r=Le.exec(t.slice(n));return r?(e.m=De.get(r[0].toLowerCase()),n+r[0].length):-1}function ne(e,t,n){return r(e,me,t,n)}function re(e,t,n){return r(e,ve,t,n)}function ie(e,t,n){return r(e,ye,t,n)}function ae(e,t,n){var r=Se.get(t.slice(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n)}function se(e){return xe[e.getDay()]}function oe(e){return be[e.getDay()]}function ue(e){return ke[e.getMonth()]}function le(e){return we[e.getMonth()]}function ce(e){return _e[+(e.getHours()>=12)]}function de(e){return xe[e.getUTCDay()]}function fe(e){return be[e.getUTCDay()]}function he(e){return ke[e.getUTCMonth()]}function pe(e){return we[e.getUTCMonth()]}function ge(e){return _e[+(e.getUTCHours()>=12)]}var me=e.dateTime,ve=e.date,ye=e.time,_e=e.periods,be=e.days,xe=e.shortDays,we=e.months,ke=e.shortMonths,Se=d(_e),Me=c(be),Te=d(be),Ae=c(xe),Ee=d(xe),Le=c(we),De=d(we),Ne=c(ke),Pe=d(ke),Ie={a:se,A:oe,b:ue,B:le,c:null,d:T,e:T,H:A,I:E,j:L,L:C,m:D,M:N,p:ce,S:P,U:I,w:O,W:U,x:null,X:null,y:z,Y:j,Z:F,"%":ee},Oe={a:de,A:fe,b:he,B:pe,c:null,d:R,e:R,H:q,I:G,j:B,L:$,m:Y,M:H,p:ge,S:W,U:V,w:X,W:J,x:null,X:null,y:K,Y:Z,Z:Q,"%":ee},Ue={a:o,A:u,b:l,B:te,c:ne,d:_,e:_,H:x,I:x,j:b,L:S,m:y,M:w,p:ae,S:k,U:h,w:f,W:p,x:re,X:ie,y:m,Y:g,Z:v,"%":M};return Ie.x=t(ve,Ie),Ie.X=t(ye,Ie),Ie.c=t(me,Ie),Oe.x=t(ve,Oe),Oe.X=t(ye,Oe),Oe.c=t(me,Oe),{format:function(e){var r=t(e+="",Ie);return r.parse=n(e,i),r.toString=function(){return e},r},utcFormat:function(e){var r=t(e+="",Oe);return r.parse=n(e,a),r.toString=function(){return e},r}}}function u(e,t,n){var r=0>e?"-":"",i=(r?-e:e)+"",a=i.length;return r+(n>a?new Array(n-a+1).join(t)+i:i)}function l(e){return e.replace(Pe,"\\$&")}function c(e){return new RegExp("^(?:"+e.map(l).join("|")+")","i")}function d(e){for(var t=new Map,n=-1,r=e.length;++n<r;)t.set(e[n].toLowerCase(),n);return t}function f(e,t,n){var r=De.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function h(e,t,n){var r=De.exec(t.slice(n));return r?(e.U=+r[0],n+r[0].length):-1}function p(e,t,n){var r=De.exec(t.slice(n));return r?(e.W=+r[0],n+r[0].length):-1}function g(e,t,n){var r=De.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function m(e,t,n){var r=De.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function v(e,t,n){return/^[+-]\d{4}$/.test(t=t.slice(n,n+5))?(e.Z=-t,n+5):-1}function y(e,t,n){var r=De.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function _(e,t,n){var r=De.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function b(e,t,n){var r=De.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function x(e,t,n){var r=De.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function w(e,t,n){var r=De.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function k(e,t,n){var r=De.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function S(e,t,n){var r=De.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function M(e,t,n){var r=Ne.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function T(e,t){return u(e.getDate(),t,2)}function A(e,t){return u(e.getHours(),t,2)}function E(e,t){return u(e.getHours()%12||12,t,2)}function L(e,t){return u(1+we.count(Me(e),e),t,3)}function C(e,t){return u(e.getMilliseconds(),t,3)}function D(e,t){return u(e.getMonth()+1,t,2)}function N(e,t){return u(e.getMinutes(),t,2)}function P(e,t){return u(e.getSeconds(),t,2)}function I(e,t){return u(ke.count(Me(e),e),t,2)}function O(e){return e.getDay()}function U(e,t){return u(Se.count(Me(e),e),t,2)}function z(e,t){return u(e.getFullYear()%100,t,2)}function j(e,t){return u(e.getFullYear()%1e4,t,4)}function F(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+u(t/60|0,"0",2)+u(t%60,"0",2)}function R(e,t){return u(e.getUTCDate(),t,2)}function q(e,t){return u(e.getUTCHours(),t,2)}function G(e,t){return u(e.getUTCHours()%12||12,t,2)}function B(e,t){return u(1+Te.count(Le(e),e),t,3)}function $(e,t){return u(e.getUTCMilliseconds(),t,3)}function Y(e,t){return u(e.getUTCMonth()+1,t,2)}function H(e,t){return u(e.getUTCMinutes(),t,2)}function W(e,t){return u(e.getUTCSeconds(),t,2)}function V(e,t){return u(Ae.count(Le(e),e),t,2)}function X(e){return e.getUTCDay()}function J(e,t){return u(Ee.count(Le(e),e),t,2)}function K(e,t){return u(e.getUTCFullYear()%100,t,2)}function Z(e,t){return u(e.getUTCFullYear()%1e4,t,4)}function Q(){return"+0000"}function ee(){return"%"}function te(e){return e.toISOString()}function ne(e){return"string"!=typeof e||(e=ze.get(e))?o(e):null}var re={dateTime:"%a %b %e %X %Y",date:"%Y/%-m/%-d",time:"%H:%M:%S",periods:["上午","下午"],days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],shortDays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortMonths:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},ie={dateTime:"%A, %e %B %Y г. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],shortDays:["вс","пн","вт","ср","чт","пт","сб"],months:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],shortMonths:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"]},ae={dateTime:"%A, %e de %B de %Y. %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],shortDays:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],shortMonths:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]},se={dateTime:"%A, %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],shortDays:["Niedz.","Pon.","Wt.","Śr.","Czw.","Pt.","Sob."],months:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],shortMonths:["Stycz.","Luty","Marz.","Kwie.","Maj","Czerw.","Lipc.","Sierp.","Wrz.","Paźdz.","Listop.","Grudz."]},oe={dateTime:"%a %e %B %Y %T",date:"%d-%m-%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],shortDays:["zo","ma","di","wo","do","vr","za"],months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],shortMonths:["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"]},ue={dateTime:"%A, %e %B %Y г. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["недела","понеделник","вторник","среда","четврток","петок","сабота"],shortDays:["нед","пон","вто","сре","чет","пет","саб"],months:["јануари","февруари","март","април","мај","јуни","јули","август","септември","октомври","ноември","декември"],shortMonths:["јан","фев","мар","апр","мај","јун","јул","авг","сеп","окт","ное","дек"]},le={dateTime:"%A %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],shortDays:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],shortMonths:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"]},ce={dateTime:"%A, %e ב%B %Y %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],shortDays:["א׳","ב׳","ג׳","ד׳","ה׳","ו׳","ש׳"],months:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],shortMonths:["ינו׳","פבר׳","מרץ","אפר׳","מאי","יוני","יולי","אוג׳","ספט׳","אוק׳","נוב׳","דצמ׳"]},de={dateTime:"%A, le %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."]},fe={dateTime:"%a %e %b %Y %X",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["",""],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim","lun","mar","mer","jeu","ven","sam"],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["jan","fév","mar","avr","mai","jui","jul","aoû","sep","oct","nov","déc"]},he={dateTime:"%A, %-d. %Bta %Y klo %X",date:"%-d.%-m.%Y",time:"%H:%M:%S",periods:["a.m.","p.m."],days:["sunnuntai","maanantai","tiistai","keskiviikko","torstai","perjantai","lauantai"],shortDays:["Su","Ma","Ti","Ke","To","Pe","La"],months:["tammikuu","helmikuu","maaliskuu","huhtikuu","toukokuu","kesäkuu","heinäkuu","elokuu","syyskuu","lokakuu","marraskuu","joulukuu"],shortMonths:["Tammi","Helmi","Maalis","Huhti","Touko","Kesä","Heinä","Elo","Syys","Loka","Marras","Joulu"]},pe={dateTime:"%A, %e de %B de %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],shortDays:["dom","lun","mar","mié","jue","vie","sáb"],months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],shortMonths:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"]},ge={dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},me={dateTime:"%a %e %b %X %Y",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},ve={dateTime:"%a %b %e %X %Y",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},ye={dateTime:"%A, der %e. %B %Y, %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]},_e={dateTime:"%A, %e de %B de %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["diumenge","dilluns","dimarts","dimecres","dijous","divendres","dissabte"],shortDays:["dg.","dl.","dt.","dc.","dj.","dv.","ds."],months:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],shortMonths:["gen.","febr.","març","abr.","maig","juny","jul.","ag.","set.","oct.","nov.","des."]},be=new Date,xe=new Date,we=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),ke=n(0),Se=n(1),Me=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()}),Te=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5}),Ae=r(0),Ee=r(1),Le=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),Ce={"-":"",_:" ",0:"0"},De=/^\s*\d+/,Ne=/^%/,Pe=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Ie="%Y-%m-%dT%H:%M:%S.%LZ";te.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},te.toString=function(){return Ie};var Oe=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?te:ge.utcFormat(Ie),Ue=Oe,ze=(new Map).set("ca-ES",_e).set("de-DE",ye).set("en-CA",ve).set("en-GB",me).set("en-US",ge).set("es-ES",pe).set("fi-FI",he).set("fr-CA",fe).set("fr-FR",de).set("he-IL",ce).set("it-IT",le).set("mk-MK",ue).set("nl-NL",oe).set("pl-PL",se).set("pt-BR",ae).set("ru-RU",ie).set("zh-CN",re),je=o(ge);e.format=je.format,e.utcFormat=je.utcFormat,e.localeFormat=ne,e.isoFormat=Ue})},{}],6:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.time={})}(this,function(e){"use strict";function t(e,n,r){function s(t){return e(t=new Date(+t)),t}return s.floor=s,s.round=function(t){var r=new Date(+t),i=new Date(t-1);return e(r),e(i),n(i,1),i-t>t-r?r:i},s.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},s.offset=function(e,t){return n(e=new Date(+e),null==t?1:Math.floor(t)),e},s.range=function(t,r,i){var a=[];if(t=new Date(t-1),r=new Date(+r),i=null==i?1:Math.floor(i),!(r>t&&i>0))return a;for(n(t,1),e(t),r>t&&a.push(new Date(+t));n(t,i),e(t),r>t;)a.push(new Date(+t));return a},s.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(s.count=function(t,n){return a.setTime(+t),i.setTime(+n),e(a),e(i),Math.floor(r(a,i))}),s}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,a=new Date,s=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3});e.seconds=s.range;var o=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4});e.minutes=o.range;var u=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5});e.hours=u.range;var l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5});e.days=l.range,e.sunday=n(0),e.sundays=e.sunday.range,e.monday=n(1),e.mondays=e.monday.range,e.tuesday=n(2),e.tuesdays=e.tuesday.range,e.wednesday=n(3),e.wednesdays=e.wednesday.range,e.thursday=n(4),e.thursdays=e.thursday.range,e.friday=n(5),e.fridays=e.friday.range,e.saturday=n(6),e.saturdays=e.saturday.range;var c=e.sunday;e.weeks=c.range;var d=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())});e.months=d.range;var f=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()});e.years=f.range;var h=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3});e.utcSeconds=h.range;var p=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4});e.utcMinutes=p.range;var g=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5});e.utcHours=g.range;var m=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5});e.utcDays=m.range,e.utcSunday=r(0),e.utcSundays=e.utcSunday.range,e.utcMonday=r(1),e.utcMondays=e.utcMonday.range,e.utcTuesday=r(2),e.utcTuesdays=e.utcTuesday.range,e.utcWednesday=r(3),e.utcWednesdays=e.utcWednesday.range,e.utcThursday=r(4),e.utcThursdays=e.utcThursday.range,e.utcFriday=r(5),e.utcFridays=e.utcFriday.range,e.utcSaturday=r(6),e.utcSaturdays=e.utcSaturday.range;var v=e.utcSunday;e.utcWeeks=v.range;var y=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())});e.utcMonths=y.range;var _=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()});e.utcYears=_.range,e.interval=t,e.second=s,e.minute=o,e.hour=u,e.day=l,e.week=c,e.month=d,e.year=f,e.utcSecond=h,e.utcMinute=p,e.utcHour=g,e.utcDay=m,e.utcWeek=v,e.utcMonth=y,e.utcYear=_})},{}],7:[function(e,t,n){function r(){this._cells={},this._aggr=[],this._stream=!1}function i(e){if(a.isArray(e))return e;if(null==e)return[];var t,n,r=[];for(t in e)n=a.array(e[t]),r.push({name:t,ops:n});return r}var a=e("../util"),s=e("./measures"),o=e("./collector"),u=r.Flags={ADD_CELL:1,MOD_CELL:2},l=r.prototype;l.stream=function(e){return null==e?this._stream:(this._stream=!!e,this._aggr=[],this)},l.key=function(e){return null==e?this._key:(this._key=a.$(e),this)},l.groupby=function(e){return this._dims=a.array(e).map(function(e,t){if(e=a.isString(e)?{name:e,get:a.$(e)}:a.isFunction(e)?{name:a.name(e)||e.name||"_"+t,get:e}:e.name&&a.isFunction(e.get)?e:null,null==e)throw"Invalid groupby argument: "+e;return e}),this.clear()},l.summarize=function(e){e=i(e),this._count=!0;var t,n,r,o,u,l,c,d=this._aggr=[];for(r=0;r<e.length;++r){for(o=0,t=[],n=e[r];o<n.ops.length;++o)u=n.ops[o],"count"!==u&&(this._count=!1),l=n.as&&n.as[o]||u+("*"===n.name?"":"_"+n.name),t.push(s[u](l));c=n.get&&a.$(n.get)||("*"===n.name?a.identity:a.$(n.name)),d.push({name:n.name,measures:s.create(t,this._stream,c,this._assign)})}return this.clear()},l.count=function(){return this.summarize({"*":"count"})},l._assign=function(e,t,n){e[t]=n},l.clear=function(){return this._cells={},this},l._cellkey=function(e){var t,n=this._dims,r=n.length,i=String(n[0].get(e));for(t=1;r>t;++t)i+="|"+n[t].get(e);return i},l._cell=function(e){var t=this._dims.length?this._cellkey(e):"";return this._cells[t]||(this._cells[t]=this._newcell(e,t))},l._newcell=function(e,t){var n,r={num:0,tuple:this._newtuple(e,t),flag:u.ADD_CELL,aggs:{}},i=this._aggr;for(n=0;n<i.length;++n)r.aggs[i[n].name]=new i[n].measures(r,r.tuple);return r.collect&&(r.data=new o(this._key)),r},l._newtuple=function(e){var t,n,r=this._dims,i={};for(t=0,n=r.length;n>t;++t)i[r[t].name]=r[t].get(e);return this._ingest(i)},l._ingest=a.identity,l._add=function(e){var t,n=this._cell(e),r=this._aggr;if(n.num+=1,!this._count)for(n.collect&&n.data.add(e),t=0;t<r.length;++t)n.aggs[r[t].name].add(e);n.flag|=u.MOD_CELL,this._on_add&&this._on_add(e,n)},l._rem=function(e){var t,n=this._cell(e),r=this._aggr;if(n.num-=1,!this._count)for(n.collect&&n.data.rem(e),t=0;t<r.length;++t)n.aggs[r[t].name].rem(e);n.flag|=u.MOD_CELL,this._on_rem&&this._on_rem(e,n)},l._mod=function(e,t){
var n,r=this._cell(t),i=this._cell(e),s=this._aggr;for(r!==i?(r.num-=1,i.num+=1,r.collect&&r.data.rem(t),i.collect&&i.data.add(e)):r.collect&&!a.isObject(e)&&(r.data.rem(t),r.data.add(e)),n=0;n<s.length;++n)r.aggs[s[n].name].rem(t),i.aggs[s[n].name].add(e);r.flag|=u.MOD_CELL,i.flag|=u.MOD_CELL,this._on_mod&&this._on_mod(e,t,r,i)},l.result=function(){var e,t,n,r=[],i=this._aggr;for(n in this._cells){if(e=this._cells[n],e.num>0){for(e.collect&&e.data.values(),t=0;t<i.length;++t)e.aggs[i[t].name].set();r.push(e.tuple)}else delete this._cells[n];e.flag=0}return this._rems=!1,r},l.changes=function(e){var t,n,r,i,a=e||{add:[],rem:[],mod:[]},s=this._aggr;for(i in this._cells){for(t=this._cells[i],n=t.flag,t.collect&&t.data.values(),r=0;r<s.length;++r)t.aggs[s[r].name].set();t.num<=0?(a.rem.push(t.tuple),delete this._cells[i],this._on_drop&&this._on_drop(t)):(this._on_keep&&this._on_keep(t),n&u.ADD_CELL?a.add.push(t.tuple):n&u.MOD_CELL&&a.mod.push(t.tuple)),t.flag=0}return this._rems=!1,a},l.execute=function(e){return this.clear().insert(e).result()},l.insert=function(e){this._consolidate();for(var t=0;t<e.length;++t)this._add(e[t]);return this},l.remove=function(e){if(!this._stream)throw"Aggregator not configured for streaming removes. Call stream(true) prior to calling summarize.";for(var t=0;t<e.length;++t)this._rem(e[t]);return this._rems=!0,this},l._consolidate=function(){if(this._rems){for(var e in this._cells)this._cells[e].collect&&this._cells[e].data.values();this._rems=!1}},t.exports=r},{"../util":29,"./collector":8,"./measures":10}],8:[function(e,t,n){function r(e){this._add=[],this._rem=[],this._key=e||null,this._last=null}var i=e("../util"),a=e("../stats"),s="__dl_rem__",o=r.prototype;o.add=function(e){this._add.push(e)},o.rem=function(e){this._rem.push(e)},o.values=function(){if(this._get=null,0===this._rem.length)return this._add;var e,t,n,r,o=this._add,u=this._rem,l=this._key,c=Array(o.length-u.length);if(i.isObject(u[0]))if(l)for(r=i.toMap(u,l),e=0,t=0,n=o.length;n>e;++e)r.hasOwnProperty(l(o[e]))||(c[t++]=o[e]);else{for(e=0,n=u.length;n>e;++e)u[e][s]=1;for(e=0,t=0,n=o.length;n>e;++e)o[e][s]||(c[t++]=o[e]);for(e=0,n=u.length;n>e;++e)delete u[e][s]}else for(r=a.count.map(u),e=0,t=0,n=o.length;n>e;++e)r[o[e]]>0?r[o[e]]-=1:c[t++]=o[e];return this._rem=[],this._add=c},o.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=a.extent.index(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},o.argmin=function(e){return this.extent(e)[0]},o.argmax=function(e){return this.extent(e)[1]},o.min=function(e){var t=this.extent(e)[0];return t?e(t):+(1/0)},o.max=function(e){var t=this.extent(e)[1];return t?e(t):-(1/0)},o.quartile=function(e){return this._get===e&&this._q||(this._q=a.quartile(this.values(),e),this._get=e),this._q},o.q1=function(e){return this.quartile(e)[0]},o.q2=function(e){return this.quartile(e)[1]},o.q3=function(e){return this.quartile(e)[2]},t.exports=r},{"../stats":26,"../util":29}],9:[function(e,t,n){var r=e("../util"),i=e("./aggregator");t.exports=function(){var e=[].reduce.call(arguments,function(e,t){return e.concat(r.array(t))},[]);return(new i).groupby(e).summarize({"*":"values"})}},{"../util":29,"./aggregator":7}],10:[function(e,t,n){function r(e){return function(t){var n=s.extend({init:"",add:"",rem:"",idx:0},e);return n.out=t||e.name,n}}function i(e,t){function n(e,r){function i(t){e[t]||n(e,e[t]=o[t]())}return r.req&&r.req.forEach(i),t&&r.str&&r.str.forEach(i),e}var r=e.reduce(n,e.reduce(function(e,t){return e[t.name]=t,e},{}));return s.vals(r).sort(function(e,t){return e.idx-t.idx})}function a(t,n,r,a){var o=i(t,n),u="this.cell = cell; this.tuple = t; this.valid = 0; this.missing = 0;",l="if (v==null) this.missing++; if (!this.isValid(v)) return; ++this.valid;",c="if (v==null) this.missing--; if (!this.isValid(v)) return; --this.valid;",d="var t = this.tuple; var cell = this.cell;";return o.forEach(function(e){e.idx<0?(u=e.init+u,l=e.add+l,c=e.rem+c):(u+=e.init,l+=e.add,c+=e.rem)}),t.slice().sort(function(e,t){return e.idx-t.idx}).forEach(function(e){d+="this.assign(t,'"+e.out+"',"+e.set+");"}),d+="return t;",u=Function("cell","t",u),u.prototype.assign=a,u.prototype.add=Function("t","var v = this.get(t);"+l),u.prototype.rem=Function("t","var v = this.get(t);"+c),u.prototype.set=Function(d),u.prototype.get=r,u.prototype.distinct=e("../stats").count.distinct,u.prototype.isValid=s.isValid,u.fields=t.map(s.$("out")),u}var s=e("../util"),o={values:r({name:"values",init:"cell.collect = true;",set:"cell.data.values()",idx:-1}),count:r({name:"count",set:"cell.num"}),missing:r({name:"missing",set:"this.missing"}),valid:r({name:"valid",set:"this.valid"}),sum:r({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),mean:r({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.mean"}),average:r({name:"average",set:"this.mean",req:["mean"],idx:1}),variance:r({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : 0",req:["mean"],idx:1}),variancep:r({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : 0",req:["variance"],idx:2}),stdev:r({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : 0",req:["variance"],idx:2}),stdevp:r({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : 0",req:["variance"],idx:2}),median:r({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:r({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:r({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),distinct:r({name:"distinct",set:"this.distinct(cell.data.values(), this.get)",req:["values"],idx:3}),argmin:r({name:"argmin",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = null;",set:"this.argmin = this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:r({name:"argmax",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = null;",set:"this.argmax = this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:r({name:"min",init:"this.min = +Infinity;",add:"if (v < this.min) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:r({name:"max",init:"this.max = -Infinity;",add:"if (v > this.max) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4}),modeskew:r({name:"modeskew",set:"this.dev===0 ? 0 : (this.mean - cell.data.q2(this.get)) / Math.sqrt(this.dev/(this.valid-1))",req:["mean","stdev","median"],idx:5})};o.create=a,t.exports=o},{"../stats":26,"../util":29}],11:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,o,u,l,c,d=e.maxbins||15,f=e.base||10,h=Math.log(f),p=e.div||[5,2],g=e.min,m=e.max,v=m-g;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,v/d,0,e.steps.length))];else{n=Math.ceil(Math.log(d)/h),r=e.minstep||0,t=Math.max(r,Math.pow(f,Math.round(Math.log(v)/h)-n));do t*=f;while(Math.ceil(v/t)>d);for(l=0;l<p.length;++l)u=t/p[l],u>=r&&d>=v/u&&(t=u)}return u=Math.log(t),o=u>=0?0:~~(-u/h)+1,c=Math.pow(f,-o-1),g=Math.min(g,Math.floor(g/t+c)*t),m=Math.ceil(m/t)*t,{start:g,stop:m,step:t,unit:{precision:o},value:a,index:s}}function i(e,t,n,r){for(;r>n;){var i=n+r>>>1;l.cmp(e[i],t)<0?n=i+1:r=i}return n}function a(e){return this.step*Math.floor(e/this.step+d)}function s(e){return Math.floor((e-this.start)/this.step+d)}function o(e){return this.unit.date(a.call(this,e))}function u(e){return s.call(this,this.unit.unit(e))}var l=e("../util"),c=e("../time"),d=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?c.utc:c,n=e.min,i=e.max,a=e.maxbins||20,s=e.minbins||4,l=+i-+n,d=e.unit?t[e.unit]:t.find(l,s,a),f=r({min:null!=d.min?d.min:d.unit(n),max:null!=d.max?d.max:d.unit(i),maxbins:a,minstep:d.minstep,steps:d.step});return f.unit=d,f.index=u,e.raw||(f.value=o),f},t.exports=r},{"../time":28,"../util":29}],12:[function(e,t,n){function r(e,t,n){n=s(e,t,n);var r=a(n);return r?f.$func("bin",r.unit.unit?function(e){return r.value(r.unit.unit(e))}:function(e){return r.value(e)})(n.accessor):n.accessor||f.identity}function i(e,t,n){n=s(e,t,n);var r=a(n);return r?o(e,n.accessor,r):u(e,n.accessor,n&&n.sort)}function a(e){var t=e.type,n=null;return(null==t||p[t])&&("integer"===t&&null==e.minstep&&(e.minstep=1),n="date"===t?l.date(e):l(e)),n}function s(){var e=arguments,t=0,n=f.isArray(e[t])?e[t++]:null,r=f.isFunction(e[t])||f.isString(e[t])?f.$(e[t++]):null,i=f.extend({},e[t]);if(n&&(i.type=i.type||d(n,r),p[i.type])){var a=h.extent(n,r);i=f.extend({min:a[0],max:a[1]},i)}return r&&(i.accessor=r),i}function o(e,t,n){for(var r,i,a=c.range(n.start,n.stop+n.step/2,n.step).map(function(e){return{value:n.value(e),count:0}}),s=0;s<e.length;++s)if(r=t?t(e[s]):e[s],f.isValid(r)){if(i=n.index(r),0>i||i>=a.length||!isFinite(i))continue;a[i].count+=1}return a.bins=n,a}function u(e,t,n){var r=h.unique(e,t),i=h.count.map(e,t);return r.map(function(e){return{value:e,count:i[e]}}).sort(f.comparator(n?"-count":"+value"))}var l=e("./bins"),c=e("../generate"),d=e("../import/type"),f=e("../util"),h=e("../stats"),p={integer:1,number:1,date:1};t.exports={$bin:r,histogram:i}},{"../generate":14,"../import/type":23,"../stats":26,"../util":29,"./bins":11}],13:[function(e,t,n){function r(e){var t=d.localeFormat(e);if(null==t)throw Error("Unrecognized locale: "+e);f=t}function i(e){var t=c.localeFormat(e);if(null==t)throw Error("Unrecognized locale: "+e);h=t}function a(e,t){e.length||(e=[0]),null==t&&(t=10);var n=e[0],r=e[e.length-1];n>r&&(s=r,r=n,n=s);var i=r-n||(t=1,n||r||1),a=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10)),s=i/t/a;return s>=p?a*=10:s>=g?a*=5:s>=m&&(a*=2),[Math.ceil(n/a)*a,Math.floor(r/a)*a+a/2,a]}function s(e,t,n){var r=a(e,t);if(null==n)n=",."+d.precisionFixed(r[2])+"f";else switch(n=d.formatSpecifier(n),n.type){case"s":var i=Math.max(Math.abs(r[0]),Math.abs(r[1]));return null==n.precision&&(n.precision=d.precisionPrefix(r[2],i)),f.formatPrefix(n,i);case"":case"e":case"g":case"p":case"r":null==n.precision&&(n.precision=d.precisionRound(r[2],Math.max(Math.abs(r[0]),Math.abs(r[1])))-("e"===n.type));break;case"f":case"%":null==n.precision&&(n.precision=d.precisionFixed(r[2])-2*("%"===n.type))}return f.format(n)}function o(){var e=h.format,t=e(".%L"),n=e(":%S"),r=e("%I:%M"),i=e("%I %p"),a=e("%a %d"),s=e("%b %d"),o=e("%B"),u=e("%Y");return function(e){var c=+e;return(l.second(e)<c?t:l.minute(e)<c?n:l.hour(e)<c?r:l.day(e)<c?i:l.month(e)<c?l.week(e)<c?a:s:l.year(e)<c?o:u)(e)}}function u(){var e=h.utcFormat,t=e(".%L"),n=e(":%S"),r=e("%I:%M"),i=e("%I %p"),a=e("%a %d"),s=e("%b %d"),o=e("%B"),u=e("%Y");return function(e){var c=+e;return(l.utcSecond(e)<c?t:l.utcMinute(e)<c?n:l.utcHour(e)<c?r:l.utcDay(e)<c?i:l.utcMonth(e)<c?l.utcWeek(e)<c?a:s:l.utcYear(e)<c?o:u)(e)}}var l=e("d3-time"),c=e("d3-time-format"),d=e("d3-format"),f=d,h=c;t.exports={numberLocale:r,number:function(e){return f.format(e)},numberPrefix:function(e,t){return f.formatPrefix(e,t)},timeLocale:i,time:function(e){return h.format(e)},utc:function(e){return h.utcFormat(e)},locale:function(e){r(e),i(e)},auto:{number:s,time:function(){return o()},utc:function(){return u()}}};var p=Math.sqrt(50),g=Math.sqrt(10),m=Math.sqrt(2)},{"d3-format":4,"d3-time":6,"d3-time-format":5}],14:[function(e,t,n){var r=t.exports={};r.repeat=function(e,t){var n,r=Array(t);for(n=0;t>n;++n)r[n]=e;return r},r.zeros=function(e){return r.repeat(0,e)},r.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],a=-1;if(0>n)for(;(r=e+n*++a)>t;)i.push(r);else for(;(r=e+n*++a)<t;)i.push(r);return i},r.random={},r.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,i=function(){return e+n*Math.random()};return i.samples=function(e){return r.zeros(e).map(i)},i},r.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,i=function(){return e+Math.floor(n*Math.random())};return i.samples=function(e){return r.zeros(e).map(i)},i},r.random.normal=function(e,t){e=e||0,t=t||1;var n,i=function(){var r,i,a=0,s=0;if(void 0!==n)return a=n,n=void 0,a;do a=2*Math.random()-1,s=2*Math.random()-1,r=a*a+s*s;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+s*i*t,e+a*i*t};return i.samples=function(e){return r.zeros(e).map(i)},i}},{}],15:[function(e,t,n){function r(e,t){if(e){var n=t.header;e=(n?n.join(t.delimiter)+"\n":"")+e}return a.dsv(t.delimiter).parse(e)}var i=e("../../util"),a=e("d3-dsv");r.delimiter=function(e){var t={delimiter:e};return function(e,n){return r(e,n?i.extend(n,t):t)}},t.exports=r},{"../../util":29,"d3-dsv":3}],16:[function(e,t,n){var r=e("./dsv");t.exports={json:e("./json"),topojson:e("./topojson"),treejson:e("./treejson"),dsv:r,csv:r.delimiter(","),tsv:r.delimiter("	")}},{"./dsv":15,"./json":17,"./topojson":18,"./treejson":19}],17:[function(e,t,n){var r=e("../../util");t.exports=function(e,t){var n=r.isObject(e)&&!r.isBuffer(e)?e:JSON.parse(e);return t&&t.property&&(n=r.accessor(t.property)(n)),n}},{"../../util":29}],18:[function(e,t,n){(function(n){var r=e("./json"),i=function(e,t){var n=i.topojson;if(null==n)throw Error("TopoJSON library not loaded.");var a,s=r(e,t);if(t&&t.feature){if(a=s.objects[t.feature])return n.feature(s,a).features;throw Error("Invalid TopoJSON object: "+t.feature)}if(t&&t.mesh){if(a=s.objects[t.mesh])return[n.mesh(s,s.objects[t.mesh])];throw Error("Invalid TopoJSON object: "+t.mesh)}throw Error("Missing TopoJSON feature or mesh parameter.")};i.topojson="undefined"!=typeof window?window.topojson:"undefined"!=typeof n?n.topojson:null,t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./json":17}],19:[function(e,t,n){function r(e,t){function n(e){r.push(e);var i=e[t];if(i)for(var a=0;a<i.length;++a)n(i[a],e)}t=t||"children";var r=[];return n(e,null),r.root=e,r}var i=e("./json");t.exports=function(e,t){return e=i(e,t),r(e,t&&t.children)}},{"./json":17}],20:[function(e,t,n){function r(t){var n=t.url;if(!n&&t.file)return d+t.file;if(t.baseURL&&!c.test(n)&&(l(n,"/")||"/"===t.baseURL[t.baseURL.length-1]||(n="/"+n),n=t.baseURL+n),!i.useXHR&&l(n,"//")&&(n=(t.defaultProtocol||"http")+":"+n),t.domainWhiteList){var r,a;if(i.useXHR){var s=document.createElement("a");s.href=n,""===s.host&&(s.href=s.href),r=s.hostname.toLowerCase(),a=window.location.hostname}else{var o=e("url").parse(n);r=o.hostname,a=null}if(a!==r){var u=t.domainWhiteList.some(function(e){var t=r.length-e.length;return e===r||t>1&&"."===r[t-1]&&r.lastIndexOf(e)===t});if(!u)throw"URL is not whitelisted: "+n}}return n}function i(e,t){var n,r=t||function(e){throw e};try{n=i.sanitizeUrl(e)}catch(a){return void r(a)}return n?i.useXHR?s(n,t):l(n,d)?o(n.slice(d.length),t):n.indexOf("://")<0?o(n,t):u(n,t):void r("Invalid URL: "+e.url)}function a(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function s(e,t){function n(){var e=i.status;!e&&a(i)||e>=200&&300>e||304===e?t(null,i.responseText):t(i,null)}var r=!!t,i=new XMLHttpRequest;return!this.XDomainRequest||"withCredentials"in i||!/^(http(s)?:)?\/\//.test(e)||(i=new XDomainRequest),r&&("onload"in i?i.onload=i.onerror=n:i.onreadystatechange=function(){i.readyState>3&&n()}),i.open("GET",e,r),i.send(),!r&&a(i)?i.responseText:void 0}function o(t,n){var r=e("fs");return n?void r.readFile(t,n):r.readFileSync(t,"utf8")}function u(t,n){if(!n)return e("sync-request")("GET",t).getBody();var r={url:t,encoding:null,gzip:!0};e("request")(r,function(e,t,r){e||200!==t.statusCode?(e=e||"Load failed with response code "+t.statusCode+".",n(e,null)):n(null,r)})}function l(e,t){return null==e?!1:0===e.lastIndexOf(t,0)}var c=/^([A-Za-z]+:)?\/\//,d="file://";i.sanitizeUrl=r,i.useXHR="undefined"!=typeof XMLHttpRequest,t.exports=i},{fs:2,request:2,"sync-request":2,url:2}],21:[function(e,t,n){function r(e,t){var n=t&&t.type||"json";return e=o[n](e,t),t&&t.parse&&i(e,t.parse),e}function i(e,t){var n,r,i,o,u,l,c=e.length;for(t="auto"===t?s.inferAll(e):a.duplicate(t),n=a.keys(t),r=n.map(function(e){return s.parsers[t[e]]}),o=0,l=n.length;c>o;++o)for(i=e[o],u=0;l>u;++u)i[n[u]]=r[u](i[n[u]]);s.annotation(e,t)}var a=e("../util"),s=e("./type"),o=e("./formats");r.formats=o,t.exports=r},{"../util":29,"./formats":16,"./type":23}],22:[function(e,t,n){var r=e("../util"),i=e("./load"),a=e("./read");t.exports=r.keys(a.formats).reduce(function(e,t){return e[t]=function(e,n,s){r.isString(e)&&(e={url:e}),2===arguments.length&&r.isFunction(n)&&(s=n,n=void 0),n=r.extend({parse:"auto"},n),n.type=t;var o=i(e,s?function(e,t){if(e)return void s(e,null);try{t=a(t,n),s(null,t)}catch(r){s(r,null)}}:void 0);return s?void 0:a(o,n)},e},{})},{"../util":29,"./load":20,"./read":21}],23:[function(e,t,n){function r(e,t){return t?void(e[l]=t):e&&e[l]||null}function i(e,t){t=u.$(t);var n,r,i;if(e[l]&&(n=t(e[l]),u.isString(n)))return n;for(r=0,i=e.length;!u.isValid(n)&&i>r;++r)n=t?t(e[r]):e[r];return u.isDate(n)?"date":u.isNumber(n)?"number":u.isBoolean(n)?"boolean":u.isString(n)?"string":null}function a(e,t){return e.length?(t=t||u.keys(e[0]),t.reduce(function(t,n){return t[n]=i(e,n),t},{})):void 0}function s(e,t){t=u.$(t);var n,r,i,a=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<a.length;++r)u.isValid(i)&&!d[a[r]](i)&&(a.splice(r,1),r-=1);if(0===a.length)return"string"}return a[0]}function o(e,t){return t=t||u.keys(e[0]),t.reduce(function(t,n){return t[n]=s(e,n),t},{})}var u=e("../util"),l="__types__",c={"boolean":u["boolean"],integer:u.number,number:u.number,date:u.date,string:function(e){return""===e?null:e}},d={"boolean":function(e){return"true"===e||"false"===e||u.isBoolean(e)},integer:function(e){return d.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!u.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};i.annotation=r,i.all=a,i.infer=s,i.inferAll=o,i.parsers=c,t.exports=i},{"../util":29}],24:[function(e,t,n){var r=e("./util"),i={version:"1.4.6",load:e("./import/load"),read:e("./import/read"),type:e("./import/type"),Aggregator:e("./aggregate/aggregator"),groupby:e("./aggregate/groupby"),bins:e("./bins/bins"),$bin:e("./bins/histogram").$bin,histogram:e("./bins/histogram").histogram,format:e("./format"),print:e("./print"),template:e("./template"),time:e("./time")};r.extend(i,r),r.extend(i,e("./generate")),r.extend(i,e("./stats")),r.extend(i,e("./import/readers")),t.exports=i},{"./aggregate/aggregator":7,"./aggregate/groupby":9,"./bins/bins":11,"./bins/histogram":12,"./format":13,"./generate":14,"./import/load":20,"./import/read":21,"./import/readers":22,"./import/type":23,"./print":25,"./stats":26,"./template":27,"./time":28,"./util":29}],25:[function(e,t,n){function r(e){return["valid:    "+e.valid,"missing:  "+e.missing,"distinct: "+e.distinct,"min:      "+e.min,"max:      "+e.max,"median:   "+e.median,"mean:     "+e.mean,"stdev:    "+e.stdev,"modeskew: "+e.modeskew].join("\n")}function i(e){var t=["valid:    "+e.valid,"missing:  "+e.missing,"distinct: "+e.distinct,"top values: "],n=e.unique,r=a.keys(n).sort(function(e,t){return n[t]-n[e]}).slice(0,6).map(function(e){return" '"+e+"' ("+n[e]+")"});return t.concat(r).join("\n")}var a=e("./util"),s=e("./import/type"),o=e("./stats"),u=e("./template"),l={date:'|time:"%m/%d/%Y %H:%M:%S"',number:'|number:".4f"',integer:'|number:"d"'},c={number:"left",integer:"left"};t.exports.table=function(e,t){t=a.extend({separator:" ",minwidth:8,maxwidth:15},t);var n=t.fields||a.keys(e[0]),r=s.all(e);if(t.start||t.limit){var i=t.start||0,d=t.limit?i+t.limit:e.length;e=e.slice(i,d)}var f=n.map(function(n){var i=l[r[n]]||"",a=u("{{"+n+i+"}}"),s=o.max(e,function(e){return a(e).length});return s=Math.max(Math.min(n.length,t.minwidth),s),t.maxwidth>0?Math.min(s,t.maxwidth):s}),h=n.map(function(e,t){return a.truncate(a.pad(e,f[t],"center"),f[t])}).join(t.separator),p=u(n.map(function(e,t){return"{{"+e+(l[r[e]]||"")+("|pad:"+f[t]+","+(c[r[e]]||"right"))+("|truncate:"+f[t])+"}}"}).join(t.separator));return h+"\n"+e.map(p).join("\n")},t.exports.summary=function(e){e=e?e.__summary__?e:o.summary(e):this;var t,n,a=[];for(t=0,n=e.length;n>t;++t)a.push("-- "+e[t].field+" --"),"string"===e[t].type||e[t].distinct<10?a.push(i(e[t])):a.push(r(e[t])),a.push("");return a.join("\n")}},{"./import/type":23,"./stats":26,"./template":27,"./util":29}],26:[function(e,t,n){var r=e("./util"),i=e("./import/type"),a=e("./generate"),s={};s.unique=function(e,t,n){t=r.$(t),n=n||[];var i,a,s,o={};for(a=0,s=e.length;s>a;++a)i=t?t(e[a]):e[a],i in o||(o[i]=1,n.push(i));return n},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,t){t=r.$(t);var n,i,a,s=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],r.isValid(n)&&(s+=1);return s},s.count.missing=function(e,t){t=r.$(t);var n,i,a,s=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],null==n&&(s+=1);return s},s.count.distinct=function(e,t){t=r.$(t);var n,i,a,s={},o=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],n in s||(s[n]=1,o+=1);return o},s.count.map=function(e,t){t=r.$(t);var n,i,a,s={};for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],s[n]=n in s?s[n]+1:1;return s},s.median=function(e,t){return t&&(e=e.map(r.$(t))),e=e.filter(r.isValid).sort(r.cmp),s.quantile(e,.5)},s.quartile=function(e,t){t&&(e=e.map(r.$(t))),e=e.filter(r.isValid).sort(r.cmp);var n=s.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},s.quantile=function(e,t,n){void 0===n&&(n=t,t=r.identity),t=r.$(t);var i=(e.length-1)*n+1,a=Math.floor(i),s=+t(e[a-1]),o=i-a;return o?s+o*(t(e[a])-s):s},s.sum=function(e,t){t=r.$(t);for(var n,i=0,a=0,s=e.length;s>a;++a)n=t?t(e[a]):e[a],r.isValid(n)&&(i+=n);return i},s.mean=function(e,t){t=r.$(t);var n,i,a,s,o,u=0;for(i=0,s=0,a=e.length;a>i;++i)o=t?t(e[i]):e[i],r.isValid(o)&&(n=o-u,u+=n/++s);return u},s.variance=function(e,t){if(t=r.$(t),!r.isArray(e)||e.length<2)return 0;var n,i,a,s,o=0,u=0;for(i=0,a=0;i<e.length;++i)s=t?t(e[i]):e[i],r.isValid(s)&&(n=s-o,o+=n/++a,u+=n*(s-o));return u/=a-1},s.stdev=function(e,t){return Math.sqrt(s.variance(e,t))},s.modeskew=function(e,t){var n=s.mean(e,t),r=s.median(e,t),i=s.stdev(e,t);return 0===i?0:(n-r)/i},s.min=function(e,t){return s.extent(e,t)[0]},s.max=function(e,t){return s.extent(e,t)[1]},s.extent=function(e,t){t=r.$(t);var n,i,a,s,o=e.length;for(s=0;o>s;++s)if(a=t?t(e[s]):e[s],r.isValid(a)){n=i=a;break}for(;o>s;++s)a=t?t(e[s]):e[s],r.isValid(a)&&(n>a&&(n=a),a>i&&(i=a));return[n,i]},s.extent.index=function(e,t){t=r.$(t);var n,i,a,s,o=-1,u=-1,l=e.length;for(s=0;l>s;++s)if(a=t?t(e[s]):e[s],r.isValid(a)){n=i=a,o=u=s;break}for(;l>s;++s)a=t?t(e[s]):e[s],r.isValid(a)&&(n>a&&(n=a,o=s),a>i&&(i=a,u=s));return[o,u]},s.dot=function(e,t,n){var i,a,s=0;if(n)for(t=r.$(t),n=r.$(n),i=0;i<e.length;++i)a=t(e[i])*n(e[i]),a===a&&(s+=a);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(i=0;i<e.length;++i)a=e[i]*t[i],a===a&&(s+=a)}return s},s.rank=function(e,t){t=r.$(t)||r.identity;var n,i,a,s=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(r.comparator("val")),o=e.length,u=Array(o),l=-1,c={};for(n=0;o>n;++n){if(i=s[n].val,0>l&&c===i)l=n-1;else if(l>-1&&c!==i){for(a=1+(n-1+l)/2;n>l;++l)u[s[l].idx]=a;l=-1}u[s[n].idx]=n+1,c=i}if(l>-1)for(a=1+(o-1+l)/2;o>l;++l)u[s[l].idx]=a;return u},s.cor=function(e,t,n){var i=n;n=i?e.map(r.$(n)):t,t=i?e.map(r.$(t)):e;var a=s.dot(t,n),o=s.mean(t),u=s.mean(n),l=s.stdev(t),c=s.stdev(n),d=e.length;return(a-d*o*u)/((d-1)*l*c)},s.cor.rank=function(e,t,n){var i,a,o,u=n?s.rank(e,r.$(t)):s.rank(e),l=n?s.rank(e,r.$(n)):s.rank(t),c=e.length;for(i=0,a=0;c>i;++i)o=u[i]-l[i],a+=o*o;return 1-6*a/(c*(c*c-1))},s.cor.dist=function(e,t,n){var i,a,o,u,l=n?e.map(r.$(t)):e,c=n?e.map(r.$(n)):t,d=s.dist.mat(l),f=s.dist.mat(c),h=d.length;for(i=0,a=0,o=0,u=0;h>i;++i)a+=d[i]*d[i],o+=f[i]*f[i],u+=d[i]*f[i];return Math.sqrt(u/Math.sqrt(a*o))},s.dist=function(e,t,n,i){var a,s,o=r.isFunction(n)||r.isString(n),u=e,l=o?e:t,c=o?i:n,d=2===c||null==c,f=e.length,h=0;for(o&&(t=r.$(t),n=r.$(n)),s=0;f>s;++s)a=o?t(u[s])-n(l[s]):u[s]-l[s],h+=d?a*a:Math.pow(Math.abs(a),c);return d?Math.sqrt(h):Math.pow(h,1/c)},s.dist.mat=function(e){var t,n,r,i=e.length,s=i*i,o=Array(s),u=a.zeros(i),l=0;for(n=0;i>n;++n)for(o[n*i+n]=0,r=n+1;i>r;++r)o[n*i+r]=t=Math.abs(e[n]-e[r]),o[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;i>n;++n)l+=u[n],u[n]/=i;for(l/=s,n=0;i>n;++n)for(r=n;i>r;++r)o[n*i+r]+=l-u[n]-u[r],o[r*i+n]=o[n*i+r];return o},s.entropy=function(e,t){t=r.$(t);var n,i,a=0,s=0,o=e.length;for(n=0;o>n;++n)a+=t?t(e[n]):e[n];if(0===a)return 0;for(n=0;o>n;++n)i=(t?t(e[n]):e[n])/a,i&&(s+=i*Math.log(i));return-s/Math.LN2},s.mutual=function(e,t,n,i){var a,s,o,u=i?e.map(r.$(t)):e,l=i?e.map(r.$(n)):t,c=i?e.map(r.$(i)):n,d={},f={},h=c.length,p=0,g=0,m=0;for(o=0;h>o;++o)d[u[o]]=0,f[l[o]]=0;for(o=0;h>o;++o)d[u[o]]+=c[o],f[l[o]]+=c[o],p+=c[o];for(s=1/(p*Math.LN2),o=0;h>o;++o)0!==c[o]&&(a=p*c[o]/(d[u[o]]*f[l[o]]),g+=c[o]*s*Math.log(a),m+=c[o]*s*Math.log(c[o]/p));return[g,1+g/m]},s.mutual.info=function(e,t,n,r){return s.mutual(e,t,n,r)[0]},s.mutual.dist=function(e,t,n,r){return s.mutual(e,t,n,r)[1]},s.profile=function(e,t){var n,a,o,u,l,c=0,d=0,f=0,h=0,p=null,g=null,m=0,v=[],y={};for(o=0;o<e.length;++o)u=t?t(e[o]):e[o],y[u]=u in y?y[u]+1:(h+=1,1),null==u?++f:r.isValid(u)&&(l="string"==typeof u?u.length:u,(null===p||p>l)&&(p=l),(null===g||l>g)&&(g=l),n=l-c,c+=n/++d,m+=n*(l-c),v.push(l));return m/=d-1,a=Math.sqrt(m),v.sort(r.cmp),{type:i(e,t),unique:y,count:e.length,valid:d,missing:f,distinct:h,min:p,max:g,mean:c,stdev:a,median:u=s.quantile(v,.5),q1:s.quantile(v,.25),q3:s.quantile(v,.75),modeskew:0===a?0:(c-u)/a}},s.summary=function(e,t){t=t||r.keys(e[0]);var n=t.map(function(t){var n=s.profile(e,r.$(t));return n.field=t,n});return n.__summary__=!0,n},t.exports=s},{"./generate":14,"./import/type":23,"./util":29}],27:[function(e,t,n){function r(e){var t=i(e,"d");return t="var __t; return "+t+";",new Function("d",t).bind(c)}function i(e,t,n){t=t||"obj";var r=0,i="'",o=d;return e.replace(o,function(o,u,l){return i+=e.slice(r,l).replace(g,s),r=l+o.length,u&&(i+="'\n+((__t=("+a(u,t,n)+"))==null?'':__t)+\n'"),o}),i+"'"}function a(e,t,n){function i(e){return e=e||"",g?(g=!1,m="String("+m+")"+e):m+=e,m}function a(){return"(typeof "+m+'==="number"?new Date('+m+"):"+m+")"}function s(e,t){_=o(w[0],t,e),g=!1,m="this.formats["+_+"]("+m+")"}function c(e,t){_=o(w[0],t,e),g=!1,m="this.formats["+_+"]("+a()+")"}var d=e.match(f),p=d.shift().trim(),g=!0;n&&(n[p]=1);for(var m=r.property(t,p),v=0;v<d.length;++v){var y,_,b,x=d[v],w=null;switch((y=x.indexOf(":"))>0&&(x=x.slice(0,y),w=d[v].slice(y+1).match(h).map(function(e){return e.trim()})),x=x.trim()){case"length":i(".length");break;case"lower":i(".toLowerCase()");break;case"upper":i(".toUpperCase()");break;case"lower-locale":i(".toLocaleLowerCase()");break;case"upper-locale":i(".toLocaleUpperCase()");break;case"trim":i(".trim()");break;case"left":_=u.number(w[0]),i(".slice(0,"+_+")");break;case"right":_=u.number(w[0]),i(".slice(-"+_+")");break;case"mid":_=u.number(w[0]),b=_+u.number(w[1]),i(".slice(+"+_+","+b+")");break;case"slice":_=u.number(w[0]),i(".slice("+_+(w.length>1?","+u.number(w[1]):"")+")");break;case"truncate":_=u.number(w[0]),b=w[1],b="left"!==b&&"middle"!==b&&"center"!==b?"right":b,m="this.truncate("+i()+","+_+",'"+b+"')";break;case"pad":_=u.number(w[0]),b=w[1],b="left"!==b&&"middle"!==b&&"center"!==b?"right":b,m="this.pad("+i()+","+_+",'"+b+"')";break;case"number":s(l.number,"number");break;case"time":c(l.time,"time");break;case"time-utc":c(l.utc,"time-utc");break;default:throw Error("Unrecognized template filter: "+x)}}return m}function s(e){return"\\"+p[e]}function o(e,t,n){if(!("'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]))throw Error("Format pattern must be quoted: "+e);if(e=e.slice(1,-1),t=t+":"+e,!c.format_map[t]){var r=n(e),i=c.formats.length;c.formats.push(r),c.format_map[t]=i}return c.format_map[t]}var u=e("./util"),l=e("./format"),c={formats:[],format_map:{},truncate:u.truncate,pad:u.pad};r.source=i,r.context=c,t.exports=r,r.clearFormatCache=function(){c.formats=[],c.format_map={}},r.property=function(e,t){var n=u.field(t).map(u.str).join("][");return e+"["+n+"]"};var d=/\{\{(.+?)\}\}|$/g,f=/(?:"[^"]*"|\'[^\']*\'|[^\|"]+|[^\|\']+)+/g,h=/(?:"[^"]*"|\'[^\']*\'|[^,"]+|[^,\']+)+/g,p={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},g=/\\|'|\r|\n|\u2028|\u2029/g},{"./format":13,"./util":29}],28:[function(e,t,n){function r(e){return l.setTime(+e),l}function i(e,t,n,r,i,a){var s={type:e,date:t,unit:n};return r?s.step=r:s.minstep=1,null!=i&&(s.min=i),null!=a&&(s.max=a),s}function a(e,t,n,r,a,s){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,a,s)}function s(e,t,n,r){var i,a,s,o=p[0];for(i=1,a=p.length;a>i;++i)if(o=p[i],t>o[0]){if(s=t/o[0],s>r)return e[p[i-1][1]];if(s>=n)return e[o[1]]}return e[p[a-1][1]]}function o(e){var t,n,r={};for(t=0,n=e.length;n>t;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return s(e,t,n,r)},r}var u=e("d3-time"),l=new Date,c=new Date(0,0,1).setFullYear(0),d=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),f=[a("second",u.second,c),a("minute",u.minute,c),a("hour",u.hour,c),a("day",u.day,c,[1,7]),a("month",u.month,c,[1,3,6]),a("year",u.year,c),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],h=[a("second",u.utcSecond,d),a("minute",u.utcMinute,d),a("hour",u.utcHour,d),a("day",u.utcDay,d,[1,7]),a("month",u.utcMonth,d,[1,3,6]),a("year",u.utcYear,d),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],p=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=o(f),t.exports.utc=o(h)},{"d3-time":6}],29:[function(e,t,n){function r(e){return e.replace(f,"$1\\'")}function i(e,t){var n,r="";for(n=0;e>n;++n)r+=t;return r}function a(e,t,n){var r=0,i=e.split(p);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():i.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():i[0].slice(0,t)}var s=e("buffer"),o=e("./time"),u=o.utc,l=t.exports={},c="__name__";l.namedfunc=function(e,t){return t[c]=e,t},l.name=function(e){return null==e?null:e[c]},l.identity=function(e){return e},l["true"]=l.namedfunc("true",function(){return!0}),l["false"]=l.namedfunc("false",function(){return!1}),l.duplicate=function(e){return JSON.parse(JSON.stringify(e))},l.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t);
},l.extend=function(e){for(var t,n,r=1,i=arguments.length;i>r;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},l.length=function(e){return null!=e&&null!=e.length?e.length:null},l.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},l.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},l.toMap=function(e,t){return(t=l.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},l.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;t>r;++r)n+="|"+String(e[r]);return n};var d=Object.prototype.toString;l.isObject=function(e){return e===Object(e)},l.isFunction=function(e){return"[object Function]"===d.call(e)},l.isString=function(e){return"string"==typeof value||"[object String]"===d.call(e)},l.isArray=Array.isArray||function(e){return"[object Array]"===d.call(e)},l.isNumber=function(e){return"number"==typeof e||"[object Number]"===d.call(e)},l.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==d.call(e)},l.isDate=function(e){return"[object Date]"===d.call(e)},l.isValid=function(e){return null!=e&&e===e},l.isBuffer=s.Buffer&&s.Buffer.isBuffer||l["false"],l.number=function(e){return null==e||""===e?null:+e},l["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},l.date=function(e){return null==e||""===e?null:Date.parse(e)},l.array=function(e){return null!=e?l.isArray(e)?e:[e]:[]},l.str=function(e){return l.isArray(e)?"["+e.map(l.str)+"]":l.isObject(e)?JSON.stringify(e):l.isString(e)?"'"+r(e)+"'":e};var f=/(^|[^\\])'/g,h=/\[(.*?)\]|[^.\[]+/g;l.field=function(e){return String(e).match(h).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},l.accessor=function(e){var t;return null==e||l.isFunction(e)?e:l.namedfunc(e,(t=l.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]})},l.$=l.accessor,l.mutator=function(e){var t;return l.isString(e)&&(t=l.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},l.$func=function(e,t){return function(n){n=l.$(n)||l.identity;var r=e+(l.name(n)?"_"+l.name(n):"");return l.namedfunc(r,function(e){return t(n(e))})}},l.$valid=l.$func("valid",l.isValid),l.$length=l.$func("length",l.length),l.$in=function(e,t){e=l.$(e);var n=l.isArray(t)?l.toMap(t):t;return function(t){return!!n[e(t)]}},l.$year=l.$func("year",o.year.unit),l.$month=l.$func("month",o.months.unit),l.$date=l.$func("date",o.dates.unit),l.$day=l.$func("day",o.weekdays.unit),l.$hour=l.$func("hour",o.hours.unit),l.$minute=l.$func("minute",o.minutes.unit),l.$second=l.$func("second",o.seconds.unit),l.$utcYear=l.$func("utcYear",u.year.unit),l.$utcMonth=l.$func("utcMonth",u.months.unit),l.$utcDate=l.$func("utcDate",u.dates.unit),l.$utcDay=l.$func("utcDay",u.weekdays.unit),l.$utcHour=l.$func("utcHour",u.hours.unit),l.$utcMinute=l.$func("utcMinute",u.minutes.unit),l.$utcSecond=l.$func("utcSecond",u.seconds.unit),l.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=l.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),l.accessor(e)}),function(n,r){var i,a,s,o,u;for(i=0,a=e.length;a>i;++i){if(s=e[i],o=s(n),u=s(r),u>o)return-1*t[i];if(o>u)return t[i]}return 0}},l.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e?-1:null===t?1:NaN},l.numcmp=function(e,t){return e-t},l.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var a=t(e),s=t(i);return s>a?-1:a>s?1:r[n(e)]-r[n(i)]}),e},l.pad=function(e,t,n,r){r=r||" ";var a=t-e.length;if(0>=a)return e;switch(n){case"left":return i(a,r)+e;case"middle":case"center":return i(Math.floor(a/2),r)+e+i(Math.ceil(a/2),r);default:return e+i(a,r)}},l.truncate=function(e,t,n,r,i){var s=e.length;if(t>=s)return e;i=void 0!==i?String(i):"…";var o=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,o,1):e.slice(s-o));case"middle":case"center":var u=Math.ceil(o/2),l=Math.floor(o/2);return(r?a(e,u):e.slice(0,u))+i+(r?a(e,l,1):e.slice(s-l));default:return(r?a(e,o):e.slice(0,o))+i}};var p=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/},{"./time":28,buffer:2}],30:[function(e,t,n){function r(e,t){var n={};return i(e,n),n.add=[],n.mod=[],n.rem=[],n.reflow=t,n}function i(e,t){t.stamp=e?e.stamp:0,t.sort=e?e.sort:null,t.facet=e?e.facet:null,t.trans=e?e.trans:null,t.dirty=e?e.dirty:[],t.request=e?e.request:null;for(var n,r=0,i=a.length;i>r;++r)t[n=a[r]]=e?e[n]:{}}var a=e("./Dependencies").ALL;t.exports={create:r,copy:i}},{"./Dependencies":33}],31:[function(e,t,n){function r(e){s.init.call(this,e),this._data=[],this.router(!0).collector(!0)}var i=e("vega-logging"),a=e("./Tuple"),s=e("./Node").prototype,o=r.prototype=Object.create(s);o.constructor=r,o.data=function(){return this._data},o.evaluate=function(e){return i.debug(e,["collecting"]),e.rem.length&&(this._data=a.idFilter(this._data,e.rem)),e.add.length&&(this._data=this._data.length?this._data.concat(e.add):e.add),e.sort&&this._data.sort(e.sort),e.reflow&&(e.mod=e.mod.concat(a.idFilter(this._data,e.add,e.mod,e.rem)),e.reflow=!1),e},t.exports=r},{"./Node":36,"./Tuple":38,"vega-logging":45}],32:[function(e,t,n){function r(e,t,n){this._graph=e,this._name=t,this._data=[],this._source=null,this._facet=n,this._input=u.create(),this._output=null,this._inputNode=null,this._outputNode=null,this._pipeline=null,this._collector=null,this._mutates=!1}function i(e){var t=new d(e._graph).router(!0).collector(!0);return t.data=function(){return e._data},t.evaluate=function(t){o.debug(t,["input",e._name]);var n,r=e._input,i=u.create(t);for(n in r.fields)i.fields[n]=1;return r.rem.length&&(e._data=c.idFilter(e._data,r.rem)),r.add.length&&(e._data=e._data.concat(r.add)),t.reflow&&(r.mod=r.mod.concat(c.idFilter(e._data,r.add,r.mod,r.rem))),e._input=u.create(),i.add=r.add,i.mod=r.mod,i.rem=r.rem,i.facet=e._facet,i},t}function a(e){var t=new d(e._graph).router(!0).reflows(!0).collector(!0);return t.data=function(){return e._collector?e._collector.data():e._data},t.evaluate=function(t){o.debug(t,["output",e._name]);var n=u.create(t,!0);return e._facet&&(e._facet.values=e.values(),t.facet=null),e._output=t,n.data[e._name]=1,n},t}function s(e){var t=new d(e._graph).router(!0);return t.evaluate=function(t){if(e.mutates()){var n=e._srcMap||(e._srcMap={}),r=u.create(t);return r.add=t.add.map(function(e){return n[e._id]=c.derive(e)}),r.mod=t.mod.map(function(e){return c.rederive(e,n[e._id])}),r.rem=t.rem.map(function(e){var t=n[e._id];return n[e._id]=null,t}),e._input=r}return e._input=t},t}var o=e("vega-logging"),u=e("./ChangeSet"),l=e("./Collector"),c=e("./Tuple"),d=e("./Node"),f=r.prototype;f.name=function(e){return arguments.length?(this._name=e,this):this._name},f.source=function(e){return arguments.length?this._source=this._graph.data(e):this._source},f.insert=function(e){return this._input.add=this._input.add.concat(e.map(c.ingest)),this},f.remove=function(e){var t=this._data.filter(e);return this._input.rem=this._input.rem.concat(t),this},f.update=function(e,t,n){var r=this._input.mod,i=c.idMap(r);return this._input.fields[t]=1,this._data.filter(e).forEach(function(e){var a=e[t],s=n(e);a!==s&&(c.set(e,t,s),1!==i[e._id]&&(r.push(e),i[e._id]=1))}),this},f.values=function(e){return arguments.length?(this._input.rem=this._data.slice(),e&&this.insert(e),this):this._collector.data()},f.mutates=function(e){return arguments.length?(this._mutates=this._mutates||e,this):this._mutates},f.last=function(){return this._output},f.fire=function(e){return e&&(this._input=e),this._graph.propagate(this._input,this._pipeline[0]),this},f.pipeline=function(e){if(!arguments.length)return this._pipeline;var t,n=this._graph;return e.unshift(this._inputNode=i(this)),t=n.preprocess(e),t.router&&e.push(t.collector=new l(n)),e.push(this._outputNode=a(this)),this._collector=t.collector,this._mutates=!!t.mutates,n.connect(this._pipeline=e),this},f.synchronize=function(){return this._graph.synchronize(this._pipeline),this},f.listener=function(){return s(this).addListener(this._inputNode)},f.addListener=function(e){return e instanceof r?this._collector.addListener(e.listener()):this._outputNode.addListener(e),this},f.removeListener=function(e){this._outputNode.removeListener(e)},f.listeners=function(e){return(e?this._collector:this._outputNode).listeners()},t.exports=r},{"./ChangeSet":30,"./Collector":31,"./Node":36,"./Tuple":38,"vega-logging":45}],33:[function(e,t,n){var r=t.exports={ALL:["data","fields","scales","signals"]};r.ALL.forEach(function(e){r[e.toUpperCase()]=e})},{}],34:[function(e,t,n){function r(){}var i=e("datalib"),a=e("./Heap"),s=e("./ChangeSet"),o=e("./DataSource"),u=e("./Collector"),l=e("./Tuple"),c=e("./Signal"),d=e("./Dependencies"),f=r.prototype;f.init=function(){this._stamp=0,this._rank=0,this._data={},this._signals={},this.doNotPropagate={}},f.rank=function(){return++this._rank},f.values=function(e,t,n){var r,a,s=e===d.SIGNALS?this._signals:this._data,o=void 0!==t?t:i.keys(s);if(Array.isArray(o)){for(r=n||{},a=0;a<o.length;++a)r[o[a]]=s[o[a]].values();return r}return s[o].values()},f.dataValues=function(e){return this.values(d.DATA,e)},f.signalValues=function(e){return this.values(d.SIGNALS,e)},f.data=function(e,t,n){var r=this._data;if(arguments.length)return 1===arguments.length?r[e]:r[e]=new o(this,e,n).pipeline(t);var i,a=[];for(i in r)a.push(r[i]);return a},f.signal=function(e,t){if(1===arguments.length){var n=this;return Array.isArray(e)?e.map(function(e){return n._signals[e]}):this._signals[e]}return this._signals[e]=new c(this,e,t)},f.signalRef=function(e){Array.isArray(e)||(e=i.field(e));var t=this.signal(e[0]).value();if(e.length>1)for(var n=1,r=e.length;r>n;++n)t=t[e[n]];return t},f.propagate=function(e,t,n){var r,i,o,u,l,c,d,f={},h=new a(function(e,t){return e._qrank-t._qrank});if(e.stamp)throw Error("Pulse already has a non-zero stamp.");for(e.stamp=n||++this._stamp,f[t._id]=e,h.push(t.qrank(!0));h.size()>0;)if(t=h.peek(),e=f[t._id],t.rank()!==t.qrank())h.replace(t.qrank(!0));else if(h.pop(),f[t._id]=null,r=t._listeners,e=this.evaluate(e,t),e!==this.doNotPropagate)for(!e.reflow&&t.reflows()&&(e=s.create(e,!0)),c=0,d=r.length;d>c;++c)if(i=r[c],void 0!==(o=f[i._id])){if(null===o)throw Error("Already propagated to node.");if(u=e.add.length||e.mod.length||e.rem.length,l=o.add.length||o.mod.length||o.rem.length,u&&l)throw Error("Multiple changeset pulses to same node");f[i._id]=u?e:o,f[i._id].reflow=e.reflow||o.reflow}else h.push(i.qrank(!0)),f[i._id]=e},f.preprocess=function(e){for(var t,n,r,i,a=this,s=0,o=0;o<e.length;++o)t=e[o],t.batch()&&!t._collector&&(n||!r?(t=new u(a),e.splice(o,0,t),n=!1):t._collector=r),(i=t.collector())&&(r=t),n=n||t.router()&&!i,s=s||t.mutates(),t.produces()&&(e.splice(o+1,0,new u(a)),n=!1);return{router:n,collector:r,mutates:s}},f.connect=function(e){var t,n,r,i,a,s,o,u;for(a=0,s=e.length;s>a;++a){for(n=e[a],n.collector()&&(t=n),r=n.dependency(d.DATA),o=0,u=r.length;u>o;++o)this.data(r[o]).addListener(t);for(i=n.dependency(d.SIGNALS),o=0,u=i.length;u>o;++o)this.signal(i[o]).addListener(t);a>0&&e[a-1].addListener(n)}return e},f.disconnect=function(e){var t,n,r,i,a,s,o,u;for(a=0,s=e.length;s>a;++a){for(n=e[a],n.collector()&&(t=n),r=n.dependency(d.DATA),o=0,u=r.length;u>o;++o)this.data(r[o]).removeListener(t);for(i=n.dependency(d.SIGNALS),o=0,u=i.length;u>o;++o)this.signal(i[o]).removeListener(t);n.disconnect()}return e},f.synchronize=function(e){var t,n,r,i,a,s,o,u,c={};for(r=0,i=e.length;i>r;++r)if(t=e[r],t.collector())for(a=0,n=t.data(),s=n.length;s>a;++a)u=(o=n[a])._id,c[u]||(l.prev_update(o),c[u]=1);return this},f.reevaluate=function(e,t){var n=e.reflow&&t.last()>=e.stamp,r=t.router()||e.add.length||e.rem.length;return r||!n||t.reevaluate(e)},f.evaluate=function(e,t){return this.reevaluate(e,t)?(e=t.evaluate(e),t.last(e.stamp),e):e},t.exports=r},{"./ChangeSet":30,"./Collector":31,"./DataSource":32,"./Dependencies":33,"./Heap":35,"./Signal":37,"./Tuple":38,datalib:24}],35:[function(e,t,n){function r(e){this.cmp=e,this.nodes=[]}function i(e,t,n,r){var i,a,s;for(i=e[n];n>t&&(s=n-1>>1,a=e[s],r(i,a)<0);)e[n]=a,n=s;return e[n]=i}function a(e,t,n){for(var r,a=t,s=e.length,o=e[t],u=2*t+1;s>u;)r=u+1,s>r&&n(e[u],e[r])>=0&&(u=r),e[t]=e[u],t=u,u=2*t+1;return e[t]=o,i(e,a,t,n)}var s=r.prototype;s.size=function(){return this.nodes.length},s.clear=function(){return this.nodes=[],this},s.peek=function(){return this.nodes[0]},s.push=function(e){var t=this.nodes;return t.push(e),i(t,0,t.length-1,this.cmp)},s.pop=function(){var e,t=this.nodes,n=t.pop();return t.length?(e=t[0],t[0]=n,a(t,0,this.cmp)):e=n,e},s.replace=function(e){var t=this.nodes,n=t[0];return t[0]=e,a(t,0,this.cmp),n},s.pushpop=function(e){var t=this.nodes,n=t[0];return t.length&&this.cmp(n,e)<0&&(t[0]=e,e=n,a(t,0,this.cmp)),e},t.exports=r},{}],36:[function(e,t,n){function r(e){e&&this.init(e)}var i=e("./Dependencies").ALL,a=0,s=r.Flags={Router:1,Collector:2,Produces:4,Mutates:8,Reflows:16,Batch:32},o=r.prototype;o.init=function(e){this._id=++a,this._graph=e,this._rank=e.rank(),this._qrank=null,this._stamp=0,this._listeners=[],this._listeners._ids={},this._deps={};for(var t=0,n=i.length;n>t;++t)this._deps[i[t]]=[];return this._flags=0,this},o.rank=function(){return this._rank},o.qrank=function(){return arguments.length?(this._qrank=this._rank,this):this._qrank},o.last=function(e){return arguments.length?(this._stamp=e,this):this._stamp},o._setf=function(e,t){return t?this._flags|=e:this._flags&=~e,this},o.router=function(e){return arguments.length?this._setf(s.Router,e):this._flags&s.Router},o.collector=function(e){return arguments.length?this._setf(s.Collector,e):this._flags&s.Collector},o.produces=function(e){return arguments.length?this._setf(s.Produces,e):this._flags&s.Produces},o.mutates=function(e){return arguments.length?this._setf(s.Mutates,e):this._flags&s.Mutates},o.reflows=function(e){return arguments.length?this._setf(s.Reflows,e):this._flags&s.Reflows},o.batch=function(e){return arguments.length?this._setf(s.Batch,e):this._flags&s.Batch},o.dependency=function(e,t){var n=this._deps[e],r=n._names||(n._names={});if(1===arguments.length)return n;if(null===t)n.splice(0,n.length),n._names={};else if(Array.isArray(t))for(var i,a=0,s=t.length;s>a;++a)i=t[a],r[i]||(n.push(i),r[i]=1);else{if(r[t])return this;n.push(t),r[t]=1}return this},o.listeners=function(){return this._listeners},o.addListener=function(e){if(!(e instanceof r))throw Error("Listener is not a Node");if(this._listeners._ids[e._id])return this;if(this._listeners.push(e),this._listeners._ids[e._id]=1,this._rank>e._rank)for(var t,n=[e],i=this._graph;n.length;)t=n.shift(),t._rank=i.rank(),n.push.apply(n,t.listeners());return this},o.removeListener=function(e){if(!this._listeners._ids[e._id])return!1;var t=this._listeners.indexOf(e),n=t>=0;return n&&(this._listeners.splice(t,1),this._listeners._ids[e._id]=null),n},o.disconnect=function(){this._listeners=[],this._listeners._ids={}},o.evaluate=function(e){return e},o.reevaluate=function(e){var t,n,r,a,s,o;for(r=0,a=i.length;a>r;++r)for(t=i[r],n=this._deps[t],s=0,o=n.length;o>s;++s)if(e[t][n[s]])return!0;return!1},r.reset=function(){a=0},t.exports=r},{"./Dependencies":33}],37:[function(e,t,n){function r(e,t,n){return s.init.call(this,e),this._name=t,this._value=n,this._verbose=!1,this._handlers=[],this}var i=e("./ChangeSet"),a=e("./Node"),s=a.prototype,o=r.prototype=Object.create(s);o.constructor=r,o.name=function(){return this._name},o.value=function(e){return arguments.length?(this._value=e,this):this._value},o.values=o.value,o.verbose=function(e){return arguments.length?(this._verbose=!!e,this):this._verbose},o.evaluate=function(e){return e.signals[this._name]?e:this._graph.doNotPropagate},o.fire=function(e){e||(e=i.create(null,!0)),e.signals[this._name]=1,this._graph.propagate(e,this)},o.on=function(e){var t=this,n=new a(this._graph);return n.evaluate=function(n){return e(t.name(),t.value()),n},this._handlers.push({handler:e,node:n}),this.addListener(n)},o.off=function(e){var t,n,r=this._handlers;for(t=r.length;--t>=0;)e&&r[t].handler!==e||(n=r.splice(t,1)[0],this.removeListener(n.node));return this},t.exports=r},{"./ChangeSet":30,"./Node":36}],38:[function(e,t,n){function r(e){return e=e===Object(e)?e:{data:e},e._id=++s,e._prev&&(e._prev=null),e}function i(e,t){t=t||{};for(var n=0,r=e.length;r>n;++n)t[e[n]._id]=1;return t}function a(e,t){t=t||{};for(var n in e)"_prev"!==n&&"_id"!==n&&(t[n]=e[n]);return t}var s=0;t.exports={ingest:r,idMap:i,derive:function(e){return r(a(e))},rederive:function(e,t){return a(e,t)},set:function(e,t,n){return e[t]===n?0:(e[t]=n,1)},prev:function(e){return e._prev||e},prev_init:function(e){e._prev||(e._prev={_id:e._id})},prev_update:function(e){var t,n,r=e._prev;if(r)for(t in e)"_prev"!==t&&"_id"!==t&&(r[t]=(n=e[t])instanceof Object&&n._prev?n._prev:n)},reset:function(){s=0},idFilter:function(e){for(var t={},n=arguments.length;--n>0;)i(arguments[n],t);return e.filter(function(e){return!t[e._id]})}}},{}],39:[function(e,t,n){t.exports={ChangeSet:e("./ChangeSet"),Collector:e("./Collector"),DataSource:e("./DataSource"),Dependencies:e("./Dependencies"),Graph:e("./Graph"),Node:e("./Node"),Signal:e("./Signal"),Tuple:e("./Tuple"),debug:e("vega-logging").debug}},{"./ChangeSet":30,"./Collector":31,"./DataSource":32,"./Dependencies":33,"./Graph":34,"./Node":36,"./Signal":37,"./Tuple":38,"vega-logging":45}],40:[function(e,t,n){function r(e){var t,n,r={};for(t=0,n=e.length;n>t;++t)r[e[t]]=1;return r}function i(e){var t,n=[];for(t in e)n.push(t);return n}t.exports=function(t){function n(e){var t={code:s(e),globals:i(p),fields:i(g)};return p={},g={},t}function a(e){return h+'["'+e+'"]'}function s(e){if("string"==typeof e)return e;var t=m[e.type];if(null==t)throw new Error("Unsupported type: "+e.type);return t(e)}t=t||{};var o=t.constants||e("./constants"),u=(t.functions||e("./functions"))(s),l=t.idWhiteList?r(t.idWhiteList):null,c=t.idBlackList?r(t.idBlackList):null,d=0,f=t.fieldVar||"datum",h=t.globalVar||"signals",p={},g={},m={Literal:function(e){return e.raw},Identifier:function(e){var t=e.name;if(d>0)return t;if(o.hasOwnProperty(t))return o[t];if(l)return l.hasOwnProperty(t)?t:(p[t]=1,a(t));if(c&&c.hasOwnProperty(t))throw new Error("Illegal identifier: "+t);return t},Program:function(e){return e.body.map(s).join("\n")},MemberExpression:function(e){var t=!e.computed,n=s(e.object);t&&(d+=1);var r=s(e.property);return n===f&&(g[r]=1),t&&(d-=1),n+(t?"."+r:"["+r+"]")},CallExpression:function(e){if("Identifier"!==e.callee.type)throw new Error("Illegal callee type: "+e.callee.type);var t=e.callee.name,n=e.arguments,r=u.hasOwnProperty(t)&&u[t];if(!r)throw new Error("Unrecognized function: "+t);return r instanceof Function?r(n):r+"("+n.map(s).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(s).join(",")+"]"},BinaryExpression:function(e){return"("+s(e.left)+e.operator+s(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+s(e.argument)+")"},ConditionalExpression:function(e){return"("+s(e.test)+"?"+s(e.consequent)+":"+s(e.alternate)+")"},LogicalExpression:function(e){return"("+s(e.left)+e.operator+s(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(s).join(",")+"}"},Property:function(e){d+=1;var t=s(e.key);return d-=1,t+":"+s(e.value)},ExpressionStatement:function(e){return s(e.expression)}};return n.functions=u,n.constants=o,n}},{"./constants":41,"./functions":42}],41:[function(e,t,n){t.exports={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"}},{}],42:[function(e,t,n){t.exports=function(e){function t(t,n,r,i){var a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(0>i?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}function n(e,n,r){return function(i){return t(e,i,n,r)}}var r="new Date",i="String",a="RegExp";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){if(t.length<3)throw new Error("Missing arguments to clamp function.");if(t.length>3)throw new Error("Too many arguments to clamp function.");var n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),indexof:n("indexOf",null),lastindexof:n("lastIndexOf",null),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),slice:n("slice",i),substring:n("substring",i),regexp:a,test:n("test",a),"if":function(t){if(t.length<3)throw new Error("Missing arguments to if function.");if(t.length>3)throw new Error("Too many arguments to if function.");var n=t.map(e);return n[0]+"?"+n[1]+":"+n[2]}}}},{}],43:[function(e,t,n){var r=e("./parser"),i=e("./codegen"),a=t.exports={parse:function(e,t){return r.parse("("+e+")",t)},code:function(e){return i(e)},compiler:function(e,t){e=e.slice();var n=i(t),r=e.length,s=function(t){var i=n(a.parse(t));return e[r]='"use strict"; return ('+i.code+");",i.fn=Function.apply(null,e),i};return s.codegen=n,s},functions:e("./functions"),constants:e("./constants")}},{"./codegen":40,"./constants":41,"./functions":42,"./parser":44}],44:[function(e,t,n){t.exports=function(){"use strict";function e(e,t){if(!e)throw new Error("ASSERT: "+t)}function t(e){return e>=48&&57>=e}function n(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function r(e){return"01234567".indexOf(e)>=0}function i(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function a(e){return 10===e||13===e||8232===e||8233===e}function s(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||92===e||e>=128&&Se.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function o(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e||92===e||e>=128&&Se.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function u(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function l(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function c(e){if(Te&&l(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function d(){var e,t;for(t=0===Ae;Ce>Ae;)if(e=Me.charCodeAt(Ae),i(e))++Ae;else{if(!a(e))break;++Ae,13===e&&10===Me.charCodeAt(Ae)&&++Ae,++Ee,Le=Ae,t=!0}}function f(e){var t,r,i,a=0;for(r="u"===e?4:2,t=0;r>t;++t){if(!(Ce>Ae&&n(Me[Ae])))return"";i=Me[Ae++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(a)}function h(){var e,t,r,i;for(e=Me[Ae],t=0,"}"===e&&F({},ke.UnexpectedToken,"ILLEGAL");Ce>Ae&&(e=Me[Ae++],n(e));)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&F({},ke.UnexpectedToken,"ILLEGAL"),65535>=t?String.fromCharCode(t):(r=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(r,i))}function p(){var e,t;for(e=Me.charCodeAt(Ae++),t=String.fromCharCode(e),92===e&&(117!==Me.charCodeAt(Ae)&&F({},ke.UnexpectedToken,"ILLEGAL"),++Ae,e=f("u"),e&&"\\"!==e&&s(e.charCodeAt(0))||F({},ke.UnexpectedToken,"ILLEGAL"),t=e);Ce>Ae&&(e=Me.charCodeAt(Ae),o(e));)++Ae,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Me.charCodeAt(Ae)&&F({},ke.UnexpectedToken,"ILLEGAL"),++Ae,e=f("u"),e&&"\\"!==e&&o(e.charCodeAt(0))||F({},ke.UnexpectedToken,"ILLEGAL"),t+=e);return t}function g(){var e,t;for(e=Ae++;Ce>Ae;){if(t=Me.charCodeAt(Ae),92===t)return Ae=e,p();if(!o(t))break;++Ae}return Me.slice(e,Ae)}function m(){var e,t,n;return e=Ae,t=92===Me.charCodeAt(Ae)?p():g(),n=1===t.length?_e.Identifier:c(t)?_e.Keyword:"null"===t?_e.NullLiteral:"true"===t||"false"===t?_e.BooleanLiteral:_e.Identifier,{type:n,value:t,lineNumber:Ee,lineStart:Le,start:e,end:Ae}}function v(){var e,t,n,r,i=Ae,a=Me.charCodeAt(Ae),s=Me[Ae];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Ae,Pe.tokenize&&(40===a?Pe.openParenToken=Pe.tokens.length:123===a&&(Pe.openCurlyToken=Pe.tokens.length)),{type:_e.Punctuator,value:String.fromCharCode(a),lineNumber:Ee,lineStart:Le,start:i,end:Ae};default:if(e=Me.charCodeAt(Ae+1),61===e)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Ae+=2,{type:_e.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(e),lineNumber:Ee,lineStart:Le,start:i,end:Ae};case 33:case 61:return Ae+=2,61===Me.charCodeAt(Ae)&&++Ae,{type:_e.Punctuator,value:Me.slice(i,Ae),lineNumber:Ee,lineStart:Le,start:i,end:Ae}}}return r=Me.substr(Ae,4),">>>="===r?(Ae+=4,{type:_e.Punctuator,value:r,lineNumber:Ee,lineStart:Le,start:i,end:Ae}):(n=r.substr(0,3),">>>"===n||"<<="===n||">>="===n?(Ae+=3,{type:_e.Punctuator,value:n,lineNumber:Ee,lineStart:Le,start:i,end:Ae}):(t=n.substr(0,2),s===t[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?(Ae+=2,{type:_e.Punctuator,value:t,lineNumber:Ee,lineStart:Le,start:i,end:Ae}):"<>=!+-*%&|^/".indexOf(s)>=0?(++Ae,{type:_e.Punctuator,value:s,lineNumber:Ee,lineStart:Le,start:i,end:Ae}):void F({},ke.UnexpectedToken,"ILLEGAL")))}function y(e){for(var t="";Ce>Ae&&n(Me[Ae]);)t+=Me[Ae++];return 0===t.length&&F({},ke.UnexpectedToken,"ILLEGAL"),s(Me.charCodeAt(Ae))&&F({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:Ee,lineStart:Le,start:e,end:Ae}}function _(e){for(var n="0"+Me[Ae++];Ce>Ae&&r(Me[Ae]);)n+=Me[Ae++];return(s(Me.charCodeAt(Ae))||t(Me.charCodeAt(Ae)))&&F({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:Ee,lineStart:Le,start:e,end:Ae}}function b(){var n,i,a;if(a=Me[Ae],e(t(a.charCodeAt(0))||"."===a,"Numeric literal must start with a decimal digit or a decimal point"),i=Ae,n="","."!==a){if(n=Me[Ae++],a=Me[Ae],"0"===n){if("x"===a||"X"===a)return++Ae,y(i);if(r(a))return _(i);a&&t(a.charCodeAt(0))&&F({},ke.UnexpectedToken,"ILLEGAL")}for(;t(Me.charCodeAt(Ae));)n+=Me[Ae++];a=Me[Ae]}if("."===a){for(n+=Me[Ae++];t(Me.charCodeAt(Ae));)n+=Me[Ae++];a=Me[Ae]}if("e"===a||"E"===a)if(n+=Me[Ae++],a=Me[Ae],("+"===a||"-"===a)&&(n+=Me[Ae++]),t(Me.charCodeAt(Ae)))for(;t(Me.charCodeAt(Ae));)n+=Me[Ae++];else F({},ke.UnexpectedToken,"ILLEGAL");return s(Me.charCodeAt(Ae))&&F({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.NumericLiteral,value:parseFloat(n),lineNumber:Ee,lineStart:Le,start:i,end:Ae}}function x(){var t,n,i,s,o,u,l,c,d="",p=!1;for(l=Ee,c=Le,t=Me[Ae],e("'"===t||'"'===t,"String literal must starts with a quote"),n=Ae,++Ae;Ce>Ae;){if(i=Me[Ae++],i===t){t="";break}if("\\"===i)if(i=Me[Ae++],i&&a(i.charCodeAt(0)))++Ee,"\r"===i&&"\n"===Me[Ae]&&++Ae,Le=Ae;else switch(i){case"u":case"x":"{"===Me[Ae]?(++Ae,d+=h()):(u=Ae,o=f(i),o?d+=o:(Ae=u,d+=i));break;case"n":d+="\n";break;case"r":d+="\r";break;case"t":d+="	";break;case"b":d+="\b";break;case"f":d+="\f";break;case"v":d+="";break;default:r(i)?(s="01234567".indexOf(i),0!==s&&(p=!0),Ce>Ae&&r(Me[Ae])&&(p=!0,s=8*s+"01234567".indexOf(Me[Ae++]),"0123".indexOf(i)>=0&&Ce>Ae&&r(Me[Ae])&&(s=8*s+"01234567".indexOf(Me[Ae++]))),d+=String.fromCharCode(s)):d+=i}else{if(a(i.charCodeAt(0)))break;d+=i}}return""!==t&&F({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.StringLiteral,value:d,octal:p,startLineNumber:l,startLineStart:c,lineNumber:Ee,lineStart:Le,start:n,end:Ae}}function w(e,t){var n,r=e;t.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t){return parseInt(t,16)<=1114111?"x":void F({},ke.InvalidRegExp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{n=new RegExp(r)}catch(i){F({},ke.InvalidRegExp)}try{return new RegExp(e,t)}catch(a){return null}}function k(){var t,n,r,i,s;for(t=Me[Ae],e("/"===t,"Regular expression literal must start with a slash"),n=Me[Ae++],r=!1,i=!1;Ce>Ae;)if(t=Me[Ae++],n+=t,"\\"===t)t=Me[Ae++],a(t.charCodeAt(0))&&F({},ke.UnterminatedRegExp),n+=t;else if(a(t.charCodeAt(0)))F({},ke.UnterminatedRegExp);else if(r)"]"===t&&(r=!1);else{if("/"===t){i=!0;break}"["===t&&(r=!0)}return i||F({},ke.UnterminatedRegExp),s=n.substr(1,n.length-2),{value:s,literal:n}}function S(){var e,t,n,r;for(t="",n="";Ce>Ae&&(e=Me[Ae],o(e.charCodeAt(0)));)if(++Ae,"\\"===e&&Ce>Ae)if(e=Me[Ae],"u"===e){if(++Ae,r=Ae,e=f("u"))for(n+=e,t+="\\u";Ae>r;++r)t+=Me[r];else Ae=r,n+="u",t+="\\u";R({},ke.UnexpectedToken,"ILLEGAL")}else t+="\\",R({},ke.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}function M(){var e,t,n,r;return De=null,d(),e=Ae,t=k(),n=S(),r=w(t.value,n.value),Pe.tokenize?{type:_e.RegularExpression,value:r,regex:{pattern:t.value,flags:n.value},lineNumber:Ee,lineStart:Le,start:e,end:Ae}:{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Ae}}function T(){var e,t,n,r;return d(),e=Ae,t={start:{line:Ee,column:Ae-Le}},n=M(),t.end={line:Ee,column:Ae-Le},Pe.tokenize||(Pe.tokens.length>0&&(r=Pe.tokens[Pe.tokens.length-1],r.range[0]===e&&"Punctuator"===r.type&&("/"===r.value||"/="===r.value)&&Pe.tokens.pop()),Pe.tokens.push({type:"RegularExpression",value:n.literal,regex:n.regex,range:[e,Ae],loc:t})),n}function A(e){return e.type===_e.Identifier||e.type===_e.Keyword||e.type===_e.BooleanLiteral||e.type===_e.NullLiteral}function E(){var e,t;if(e=Pe.tokens[Pe.tokens.length-1],!e)return T();if("Punctuator"===e.type){if("]"===e.value)return v();if(")"===e.value)return t=Pe.tokens[Pe.openParenToken-1],!t||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?v():T();if("}"===e.value){if(Pe.tokens[Pe.openCurlyToken-3]&&"Keyword"===Pe.tokens[Pe.openCurlyToken-3].type){if(t=Pe.tokens[Pe.openCurlyToken-4],!t)return v()}else{if(!Pe.tokens[Pe.openCurlyToken-4]||"Keyword"!==Pe.tokens[Pe.openCurlyToken-4].type)return v();if(t=Pe.tokens[Pe.openCurlyToken-5],!t)return T()}return v()}return T()}return"Keyword"===e.type&&"this"!==e.value?T():v()}function L(){var e;return d(),Ae>=Ce?{type:_e.EOF,lineNumber:Ee,lineStart:Le,start:Ae,end:Ae}:(e=Me.charCodeAt(Ae),s(e)?m():40===e||41===e||59===e?v():39===e||34===e?x():46===e?t(Me.charCodeAt(Ae+1))?b():v():t(e)?b():Pe.tokenize&&47===e?E():v())}function C(){var e,t,n,r;return d(),e={start:{line:Ee,column:Ae-Le}},t=L(),e.end={line:Ee,column:Ae-Le},t.type!==_e.EOF&&(n=Me.slice(t.start,t.end),r={type:be[t.type],value:n,range:[t.start,t.end],loc:e},t.regex&&(r.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Pe.tokens.push(r)),t}function D(){var e;return e=De,Ae=e.end,Ee=e.lineNumber,Le=e.lineStart,De="undefined"!=typeof Pe.tokens?C():L(),
Ae=e.end,Ee=e.lineNumber,Le=e.lineStart,e}function N(){var e,t,n;e=Ae,t=Ee,n=Le,De="undefined"!=typeof Pe.tokens?C():L(),Ae=e,Ee=t,Le=n}function P(){this.line=Ee,this.column=Ae-Le}function I(){this.start=new P,this.end=null}function O(e){e.type===_e.StringLiteral?this.start={line:e.startLineNumber,column:e.start-e.startLineStart}:this.start={line:e.lineNumber,column:e.start-e.lineStart},this.end=null}function U(){Ae=De.start,De.type===_e.StringLiteral?(Ee=De.startLineNumber,Le=De.startLineStart):(Ee=De.lineNumber,Le=De.lineStart),Pe.range&&(this.range=[Ae,0]),Pe.loc&&(this.loc=new I)}function z(e){Pe.range&&(this.range=[e.start,0]),Pe.loc&&(this.loc=new O(e))}function j(){var e,t,n,r;return e=Ae,t=Ee,n=Le,d(),r=Ee!==t,Ae=e,Ee=t,Le=n,r}function F(t,n){var r,i=Array.prototype.slice.call(arguments,2),a=n.replace(/%(\d)/g,function(t,n){return e(n<i.length,"Message reference must be in range"),i[n]});throw"number"==typeof t.lineNumber?(r=new Error("Line "+t.lineNumber+": "+a),r.index=t.start,r.lineNumber=t.lineNumber,r.column=t.start-Le+1):(r=new Error("Line "+Ee+": "+a),r.index=Ae,r.lineNumber=Ee,r.column=Ae-Le+1),r.description=a,r}function R(){try{F.apply(null,arguments)}catch(e){if(!Pe.errors)throw e;Pe.errors.push(e)}}function q(e){if(e.type===_e.EOF&&F(e,ke.UnexpectedEOS),e.type===_e.NumericLiteral&&F(e,ke.UnexpectedNumber),e.type===_e.StringLiteral&&F(e,ke.UnexpectedString),e.type===_e.Identifier&&F(e,ke.UnexpectedIdentifier),e.type===_e.Keyword){if(u(e.value))F(e,ke.UnexpectedReserved);else if(Te&&l(e.value))return void R(e,ke.StrictReservedWord);F(e,ke.UnexpectedToken,e.value)}F(e,ke.UnexpectedToken,e.value)}function G(e){var t=D();(t.type!==_e.Punctuator||t.value!==e)&&q(t)}function B(e){if(Pe.errors){var t=De;t.type!==_e.Punctuator&&t.value!==e?R(t,ke.UnexpectedToken,t.value):D()}else G(e)}function $(e){return De.type===_e.Punctuator&&De.value===e}function Y(e){return De.type===_e.Keyword&&De.value===e}function H(){var e;return 59===Me.charCodeAt(Ae)||$(";")?void D():(e=Ee,d(),void(Ee===e&&(De.type===_e.EOF||$("}")||q(De))))}function W(){var e=[],t=new U;for(G("[");!$("]");)$(",")?(D(),e.push(null)):(e.push(le()),$("]")||G(","));return D(),t.finishArrayExpression(e)}function V(){var e,t=new U;return e=D(),e.type===_e.StringLiteral||e.type===_e.NumericLiteral?(Te&&e.octal&&R(e,ke.StrictOctalLiteral),t.finishLiteral(e)):t.finishIdentifier(e.value)}function X(){var e,t,n,r,i=new U;return e=De,e.type===_e.Identifier?(n=V(),G(":"),r=le(),i.finishProperty("init",n,r)):e.type!==_e.EOF&&e.type!==_e.Punctuator?(t=V(),G(":"),r=le(),i.finishProperty("init",t,r)):void q(e)}function J(){var e,t,n,r,i=[],a={},s=String,o=new U;for(G("{");!$("}");)e=X(),t=e.key.type===xe.Identifier?e.key.name:s(e.key.value),r="init"===e.kind?we.Data:"get"===e.kind?we.Get:we.Set,n="$"+t,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===we.Data?Te&&r===we.Data?R({},ke.StrictDuplicateProperty):r!==we.Data&&R({},ke.AccessorDataProperty):r===we.Data?R({},ke.AccessorDataProperty):a[n]&r&&R({},ke.AccessorGetSet),a[n]|=r):a[n]=r,i.push(e),$("}")||B(",");return G("}"),o.finishObjectExpression(i)}function K(){var e;return G("("),++Ne.parenthesisCount,e=ce(),G(")"),e}function Z(){var e,t,n,r;if($("("))return K();if($("["))return W();if($("{"))return J();if(e=De.type,r=new U,e===_e.Identifier||Ie[De.value])n=r.finishIdentifier(D().value);else if(e===_e.StringLiteral||e===_e.NumericLiteral)Te&&De.octal&&R(De,ke.StrictOctalLiteral),n=r.finishLiteral(D());else{if(e===_e.Keyword)throw new Error("Disabled.");e===_e.BooleanLiteral?(t=D(),t.value="true"===t.value,n=r.finishLiteral(t)):e===_e.NullLiteral?(t=D(),t.value=null,n=r.finishLiteral(t)):$("/")||$("/=")?(n="undefined"!=typeof Pe.tokens?r.finishLiteral(T()):r.finishLiteral(M()),N()):q(D())}return n}function Q(){var e=[];if(G("("),!$(")"))for(;Ce>Ae&&(e.push(le()),!$(")"));)B(",");return G(")"),e}function ee(){var e,t=new U;return e=D(),A(e)||q(e),t.finishIdentifier(e.value)}function te(){return G("."),ee()}function ne(){var e;return G("["),e=ce(),G("]"),e}function re(){var e,t,n,r,i=Ne.allowIn;for(r=De,Ne.allowIn=!0,e=Z();;)if($("."))n=te(),e=new z(r).finishMemberExpression(".",e,n);else if($("("))t=Q(),e=new z(r).finishCallExpression(e,t);else{if(!$("["))break;n=ne(),e=new z(r).finishMemberExpression("[",e,n)}return Ne.allowIn=i,e}function ie(){var e=re();if(De.type===_e.Punctuator&&($("++")||$("--"))&&!j())throw new Error("Disabled.");return e}function ae(){var e,t,n;if(De.type!==_e.Punctuator&&De.type!==_e.Keyword)t=ie();else{if($("++")||$("--"))throw new Error("Disabled.");if($("+")||$("-")||$("~")||$("!"))n=De,e=D(),t=ae(),t=new z(n).finishUnaryExpression(e.value,t);else{if(Y("delete")||Y("void")||Y("typeof"))throw new Error("Disabled.");t=ie()}}return t}function se(e,t){var n=0;if(e.type!==_e.Punctuator&&e.type!==_e.Keyword)return 0;switch(e.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=t?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function oe(){var e,t,n,r,i,a,s,o,u,l;if(e=De,u=ae(),r=De,i=se(r,Ne.allowIn),0===i)return u;for(r.prec=i,D(),t=[e,De],s=ae(),a=[u,r,s];(i=se(De,Ne.allowIn))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,u=a.pop(),t.pop(),n=new z(t[t.length-1]).finishBinaryExpression(o,u,s),a.push(n);r=D(),r.prec=i,a.push(r),t.push(De),n=ae(),a.push(n)}for(l=a.length-1,n=a[l],t.pop();l>1;)n=new z(t.pop()).finishBinaryExpression(a[l-1].value,a[l-2],n),l-=2;return n}function ue(){var e,t,n,r,i;return i=De,e=oe(),$("?")&&(D(),t=Ne.allowIn,Ne.allowIn=!0,n=le(),Ne.allowIn=t,G(":"),r=le(),e=new z(i).finishConditionalExpression(e,n,r)),e}function le(){var e,t,n,r;return e=Ne.parenthesisCount,r=De,t=De,n=ue()}function ce(){var e=le();if($(","))throw new Error("Disabled.");return e}function de(e){var t=ce();return H(),e.finishExpressionStatement(t)}function fe(){var e,t,n=De.type;if(n===_e.EOF&&q(De),n===_e.Punctuator&&"{"===De.value)throw new Error("Disabled.");if(t=new U,n===_e.Punctuator)switch(De.value){case";":throw new Error("Disabled.");case"(":return de(t)}else if(n===_e.Keyword)throw new Error("Disabled.");return e=ce(),H(),t.finishExpressionStatement(e)}function he(){if(De.type===_e.Keyword)switch(De.value){case"const":case"let":throw new Error("Disabled.");case"function":throw new Error("Disabled.");default:return fe()}return De.type!==_e.EOF?fe():void 0}function pe(){for(var e,t,n,r,i=[];Ce>Ae&&(t=De,t.type===_e.StringLiteral)&&(e=he(),i.push(e),e.expression.type===xe.Literal);)n=Me.slice(t.start+1,t.end-1),"use strict"===n?(Te=!0,r&&R(r,ke.StrictOctalLiteral)):!r&&t.octal&&(r=t);for(;Ce>Ae&&(e=he(),"undefined"!=typeof e);)i.push(e);return i}function ge(){var e,t;return d(),N(),t=new U,Te=!0,e=pe(),t.finishProgram(e)}function me(){var e,t,n,r=[];for(e=0;e<Pe.tokens.length;++e)t=Pe.tokens[e],n={type:t.type,value:t.value},t.regex&&(n.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Pe.range&&(n.range=t.range),Pe.loc&&(n.loc=t.loc),r.push(n);Pe.tokens=r}function ve(e,t){var n,r;n=String,"string"==typeof e||e instanceof String||(e=n(e)),Me=e,Ae=0,Ee=Me.length>0?1:0,Le=0,Ce=Me.length,De=null,Ne={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Pe={},t=t||{},t.tokens=!0,Pe.tokens=[],Pe.tokenize=!0,Pe.openParenToken=-1,Pe.openCurlyToken=-1,Pe.range="boolean"==typeof t.range&&t.range,Pe.loc="boolean"==typeof t.loc&&t.loc,"boolean"==typeof t.tolerant&&t.tolerant&&(Pe.errors=[]);try{if(N(),De.type===_e.EOF)return Pe.tokens;for(D();De.type!==_e.EOF;)try{D()}catch(i){if(Pe.errors){Pe.errors.push(i);break}throw i}me(),r=Pe.tokens,"undefined"!=typeof Pe.errors&&(r.errors=Pe.errors)}catch(a){throw a}finally{Pe={}}return r}function ye(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),Me=e,Ae=0,Ee=Me.length>0?1:0,Le=0,Ce=Me.length,De=null,Ne={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Pe={},"undefined"!=typeof t&&(Pe.range="boolean"==typeof t.range&&t.range,Pe.loc="boolean"==typeof t.loc&&t.loc,Pe.loc&&null!==t.source&&void 0!==t.source&&(Pe.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(Pe.tokens=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(Pe.errors=[]));try{n=ge(),"undefined"!=typeof Pe.tokens&&(me(),n.tokens=Pe.tokens),"undefined"!=typeof Pe.errors&&(n.errors=Pe.errors)}catch(i){throw i}finally{Pe={}}return n}var _e,be,xe,we,ke,Se,Me,Te,Ae,Ee,Le,Ce,De,Ne,Pe;_e={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},be={},be[_e.BooleanLiteral]="Boolean",be[_e.EOF]="<end>",be[_e.Identifier]="Identifier",be[_e.Keyword]="Keyword",be[_e.NullLiteral]="Null",be[_e.NumericLiteral]="Numeric",be[_e.Punctuator]="Punctuator",be[_e.StringLiteral]="String",be[_e.RegularExpression]="RegularExpression",xe={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",UnaryExpression:"UnaryExpression"},we={Data:1,Get:2,Set:4},ke={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},Se={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},z.prototype=U.prototype={finish:function(){Pe.range&&(this.range[1]=Ae),Pe.loc&&(this.loc.end=new P,Pe.source&&(this.loc.source=Pe.source))},finishArrayExpression:function(e){return this.type=xe.ArrayExpression,this.elements=e,this.finish(),this},finishAssignmentExpression:function(e,t,n){return this.type=xe.AssignmentExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishBinaryExpression:function(e,t,n){return this.type="||"===e||"&&"===e?xe.LogicalExpression:xe.BinaryExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishCallExpression:function(e,t){return this.type=xe.CallExpression,this.callee=e,this.arguments=t,this.finish(),this},finishConditionalExpression:function(e,t,n){return this.type=xe.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n,this.finish(),this},finishExpressionStatement:function(e){return this.type=xe.ExpressionStatement,this.expression=e,this.finish(),this},finishIdentifier:function(e){return this.type=xe.Identifier,this.name=e,this.finish(),this},finishLiteral:function(e){return this.type=xe.Literal,this.value=e.value,this.raw=Me.slice(e.start,e.end),e.regex&&("//"==this.raw&&(this.raw="/(?:)/"),this.regex=e.regex),this.finish(),this},finishMemberExpression:function(e,t,n){return this.type=xe.MemberExpression,this.computed="["===e,this.object=t,this.property=n,this.finish(),this},finishObjectExpression:function(e){return this.type=xe.ObjectExpression,this.properties=e,this.finish(),this},finishProgram:function(e){return this.type=xe.Program,this.body=e,this.finish(),this},finishProperty:function(e,t,n){return this.type=xe.Property,this.key=t,this.value=n,this.kind=e,this.finish(),this},finishUnaryExpression:function(e,t){return this.type=xe.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0,this.finish(),this}};var Ie={"if":1,"this":1};return{tokenize:ve,parse:ye}}()},{}],45:[function(e,t,n){function r(e){e="[Vega Log] "+e,console.log(e)}function i(e){e="[Vega Err] "+e,console.error(e)}function a(e,t){if(a.enable){var n=Function.prototype.bind.call(console.log,console),r={prevTime:Date.now()-s,stamp:e.stamp};e.add&&(r.add=e.add.length,r.mod=e.mod.length,r.rem=e.rem.length,r.reflow=!!e.reflow),n.apply(console,(t.push(JSON.stringify(r)),t)),s=Date.now()}}var s=Date.now();t.exports={log:r,error:i,debug:(a.enable=!1,a)}},{}],46:[function(e,t,n){t.exports={path:e("./path"),render:e("./render"),Item:e("./util/Item"),bound:e("./util/bound"),Bounds:e("./util/Bounds"),Gradient:e("./util/Gradient"),toJSON:e("./util/scene").toJSON,fromJSON:e("./util/scene").fromJSON}},{"./path":48,"./render":68,"./util/Bounds":74,"./util/Gradient":76,"./util/Item":78,"./util/bound":79,"./util/scene":83}],47:[function(e,t,n){function r(e,t,n,r,i,s,u,l,c){var d=o.call(arguments);if(a[d])return a[d];var f=u*(Math.PI/180),h=Math.sin(f),p=Math.cos(f);n=Math.abs(n),r=Math.abs(r);var g=p*(l-e)*.5+h*(c-t)*.5,m=p*(c-t)*.5-h*(l-e)*.5,v=g*g/(n*n)+m*m/(r*r);v>1&&(v=Math.sqrt(v),n*=v,r*=v);var y=p/n,_=h/n,b=-h/r,x=p/r,w=y*l+_*c,k=b*l+x*c,S=y*e+_*t,M=b*e+x*t,T=(S-w)*(S-w)+(M-k)*(M-k),A=1/T-.25;0>A&&(A=0);var E=Math.sqrt(A);s==i&&(E=-E);var L=.5*(w+S)-E*(M-k),C=.5*(k+M)+E*(S-w),D=Math.atan2(k-C,w-L),N=Math.atan2(M-C,S-L),P=N-D;0>P&&1===s?P+=2*Math.PI:P>0&&0===s&&(P-=2*Math.PI);for(var I=Math.ceil(Math.abs(P/(.5*Math.PI+.001))),O=[],U=0;I>U;++U){var z=D+U*P/I,j=D+(U+1)*P/I;O[U]=[L,C,z,j,n,r,h,p]}return a[d]=O}function i(e){var t=o.call(e);if(s[t])return s[t];var n=e[0],r=e[1],i=e[2],a=e[3],u=e[4],l=e[5],c=e[6],d=e[7],f=d*u,h=-c*l,p=c*u,g=d*l,m=Math.cos(i),v=Math.sin(i),y=Math.cos(a),_=Math.sin(a),b=.5*(a-i),x=Math.sin(.5*b),w=8/3*x*x/Math.sin(b),k=n+m-w*v,S=r+v+w*m,M=n+y,T=r+_,A=M+w*_,E=T-w*y;return s[t]=[f*k+h*S,p*k+g*S,f*A+h*E,p*A+g*E,f*M+h*T,p*M+g*T]}var a={},s={},o=[].join;t.exports={segments:r,bezier:i,cache:{segments:a,bezier:s}}},{}],48:[function(e,t,n){t.exports={parse:e("./parse"),render:e("./render")}},{"./parse":49,"./render":50}],49:[function(e,t,n){var r={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];t.exports=function(e){var t,n,a,s,o,u,l,c,d,f,h,p=[];for(t=e.slice().replace(i[0],"###$1").split(i[1]).slice(1),c=0,f=t.length;f>c;++c){for(n=t[c],a=n.slice(1).trim().replace(i[2],"$1###$2").split(i[3]),u=n.charAt(0),s=[u],d=0,h=a.length;h>d;++d)(o=+a[d])===o&&s.push(o);if(l=r[u.toLowerCase()],s.length-1>l)for(d=1,h=s.length;h>d;d+=l)p.push([u].concat(s.slice(d,d+l)));else p.push(s)}return p}},{}],50:[function(e,t,n){function r(e,t,n,r){for(var a=i.segments(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n),s=0;s<a.length;++s){var o=i.bezier(a[s]);e.bezierCurveTo.apply(e,o)}}var i=e("./arc");t.exports=function(e,t,n,i){var a,s,o,u,l,c=null,d=0,f=0,h=0,p=0;null==n&&(n=0),null==i&&(i=0),e.beginPath();for(var g=0,m=t.length;m>g;++g){switch(a=t[g],a[0]){case"l":d+=a[1],f+=a[2],e.lineTo(d+n,f+i);break;case"L":d=a[1],f=a[2],e.lineTo(d+n,f+i);break;case"h":d+=a[1],e.lineTo(d+n,f+i);break;case"H":d=a[1],e.lineTo(d+n,f+i);break;case"v":f+=a[1],e.lineTo(d+n,f+i);break;case"V":f=a[1],e.lineTo(d+n,f+i);break;case"m":d+=a[1],f+=a[2],e.moveTo(d+n,f+i);break;case"M":d=a[1],f=a[2],e.moveTo(d+n,f+i);break;case"c":s=d+a[5],o=f+a[6],h=d+a[3],p=f+a[4],e.bezierCurveTo(d+a[1]+n,f+a[2]+i,h+n,p+i,s+n,o+i),d=s,f=o;break;case"C":d=a[5],f=a[6],h=a[3],p=a[4],e.bezierCurveTo(a[1]+n,a[2]+i,h+n,p+i,d+n,f+i);break;case"s":s=d+a[3],o=f+a[4],h=2*d-h,p=2*f-p,e.bezierCurveTo(h+n,p+i,d+a[1]+n,f+a[2]+i,s+n,o+i),h=d+a[1],p=f+a[2],d=s,f=o;break;case"S":s=a[3],o=a[4],h=2*d-h,p=2*f-p,e.bezierCurveTo(h+n,p+i,a[1]+n,a[2]+i,s+n,o+i),d=s,f=o,h=a[1],p=a[2];break;case"q":s=d+a[3],o=f+a[4],h=d+a[1],p=f+a[2],e.quadraticCurveTo(h+n,p+i,s+n,o+i),d=s,f=o;break;case"Q":s=a[3],o=a[4],e.quadraticCurveTo(a[1]+n,a[2]+i,s+n,o+i),d=s,f=o,h=a[1],p=a[2];break;case"t":s=d+a[1],o=f+a[2],null===c[0].match(/[QqTt]/)?(h=d,p=f):"t"===c[0]?(h=2*d-u,p=2*f-l):"q"===c[0]&&(h=2*d-h,p=2*f-p),u=h,l=p,e.quadraticCurveTo(h+n,p+i,s+n,o+i),d=s,f=o,h=d+a[1],p=f+a[2];break;case"T":s=a[1],o=a[2],h=2*d-h,p=2*f-p,e.quadraticCurveTo(h+n,p+i,s+n,o+i),d=s,f=o;break;case"a":r(e,d+n,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+d+n,a[7]+f+i]),d+=a[6],f+=a[7];break;case"A":r(e,d+n,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+i]),d=a[6],f=a[7];break;case"z":case"Z":e.closePath()}c=a}}},{"./arc":47}],51:[function(e,t,n){function r(){this._active=null,this._handlers={}}var i=r.prototype;i.initialize=function(e,t,n){return this._el=e,this._obj=n||null,this.padding(t)},i.element=function(){return this._el},i.padding=function(e){return this._padding=e||{top:0,left:0,bottom:0,right:0},this},i.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},i.on=function(){},i.off=function(){},i.handlers=function(){var e,t=this._handlers,n=[];for(e in t)n.push.apply(n,t[e]);return n},i.eventName=function(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)},t.exports=r},{}],52:[function(e,t,n){function r(){this._el=null,this._bgcolor=null}var i=r.prototype;i.initialize=function(e,t,n,r){return this._el=e,this.resize(t,n,r)},i.element=function(){return this._el},i.scene=function(){return this._el&&this._el.firstChild},i.background=function(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},i.resize=function(e,t,n){return this._width=e,this._height=t,this._padding=n||{top:0,left:0,bottom:0,right:0},this},i.render=function(){return this},t.exports=r},{}],53:[function(e,t,n){function r(){a.call(this),this._down=null,this._touch=null,this._first=!0}var i=e("../../util/dom"),a=e("../Handler"),s=e("./marks"),o=a.prototype,u=r.prototype=Object.create(o);u.constructor=r,u.initialize=function(e,t,n){var r=this._canvas=i.find(e,"canvas"),a=this;return this.events.forEach(function(e){r.addEventListener(e,function(t){u[e]?u[e].call(a,t):a.fire(e,t)})}),o.initialize.call(this,e,t,n)},u.canvas=function(){return this._canvas},u.context=function(){return this._canvas.getContext("2d")},u.events=["keydown","keypress","keyup","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],u.DOMMouseScroll=function(e){this.fire("mousewheel",e)},u.mousemove=function(e){var t=this._active,n=this.pickEvent(e);n===t?this.fire("mousemove",e):(this.fire("mouseout",e),this._active=n,this.fire("mouseover",e),this.fire("mousemove",e))},u.mouseout=function(e){this.fire("mouseout",e),this._active=null},u.mousedown=function(e){this._down=this._active,this.fire("mousedown",e)},u.click=function(e){this._down===this._active&&(this.fire("click",e),this._down=null)},u.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},u.touchmove=function(e){this.fire("touchmove",e,!0)},u.touchend=function(e){this.fire("touchend",e,!0),this._touch=null},u.fire=function(e,t,n){var r,i,a=n?this._touch:this._active,s=this._handlers[e];if(s)for(t.vegaType=e,r=0,i=s.length;i>r;++r)s[r].handler.call(this._obj,t,a)},u.on=function(e,t){var n=this.eventName(e),r=this._handlers;return(r[n]||(r[n]=[])).push({type:e,handler:t}),this},u.off=function(e,t){var n,r=this.eventName(e),i=this._handlers[r];if(i){for(n=i.length;--n>=0;)i[n].type===e&&(t&&i[n].handler!==t||i.splice(n,1));return this}},u.pickEvent=function(e){var t,n,r=this._canvas.getBoundingClientRect(),i=this._padding;return this.pick(this._scene,t=e.clientX-r.left,n=e.clientY-r.top,t-i.left,n-i.top)},u.pick=function(e,t,n,r,i){var a=this.context(),o=s[e.marktype];return o.pick.call(this,a,e,t,n,r,i)},t.exports=r},{"../../util/dom":81,"../Handler":51,"./marks":60}],54:[function(e,t,n){function r(e){c.call(this),this._loader=new u(e)}function i(e,t){if(!t)return null;var n,r,i,s,u,l=new o;for(n=0,r=t.length;r>n;++n)i=t[n],s=i.mark,u=s.group,i=d[s.marktype].nested?s:i,l.union(a(i.bounds,u)),i["bounds:prev"]&&l.union(a(i["bounds:prev"],u));return l.round(),e.beginPath(),e.rect(l.x1,l.y1,l.width(),l.height()),e.clip(),l}function a(e,t){if(null==t)return e;for(var n=e.clone();null!=t;t=t.mark.group)n.translate(t.x||0,t.y||0);return n}var s=e("../../util/dom"),o=e("../../util/Bounds"),u=e("../../util/ImageLoader"),l=e("../../util/canvas"),c=e("../Renderer"),d=e("./marks");r.RETINA=!0;var f=c.prototype,h=r.prototype=Object.create(f);h.constructor=r,h.initialize=function(e,t,n,r){return this._canvas=l.instance(t,n),e&&(s.clear(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),f.initialize.call(this,e,t,n,r)},h.resize=function(e,t,n){return f.resize.call(this,e,t,n),l.resize(this._canvas,this._width,this._height,this._padding,r.RETINA),this},h.canvas=function(){return this._canvas},h.context=function(){return this._canvas?this._canvas.getContext("2d"):null},h.pendingImages=function(){return this._loader.pending()},h.render=function(e,t){var n,r=this.context(),a=this._padding,s=this._width+a.left+a.right,o=this._height+a.top+a.bottom;return this._scene=e,r.save(),n=i(r,t),this.clear(-a.left,-a.top,s,o),this.draw(r,e,n),r.restore(),this._scene=null,this},h.draw=function(e,t,n){var r=d[t.marktype];r.draw.call(this,e,t,n)},h.clear=function(e,t,n,r){var i=this.context();i.clearRect(e,t,n,r),null!=this._bgcolor&&(i.fillStyle=this._bgcolor,i.fillRect(e,t,n,r))},h.loadImage=function(e){var t=this,n=this._scene;return this._loader.loadImage(e,function(){t.renderAsync(n)})},h.renderAsync=function(e){var t=this;t._async_id&&clearTimeout(t._async_id),t._async_id=setTimeout(function(){t.render(e),delete t._async_id},10)},t.exports=r},{"../../util/Bounds":74,"../../util/ImageLoader":77,"../../util/canvas":80,"../../util/dom":81,"../Renderer":52,"./marks":60}],55:[function(e,t,n){t.exports={Handler:e("./CanvasHandler"),Renderer:e("./CanvasRenderer")}},{"./CanvasHandler":53,"./CanvasRenderer":54}],56:[function(e,t,n){function r(e,t){var n=t.x||0,r=t.y||0,i=t.innerRadius||0,s=t.outerRadius||0,o=(t.startAngle||0)-a,u=(t.endAngle||0)-a;e.beginPath(),0===i?e.moveTo(n,r):e.arc(n,r,i,o,u,0),e.arc(n,r,s,u,o,1),e.closePath()}var i=e("./util"),a=Math.PI/2;t.exports={draw:i.drawAll(r),pick:i.pickPath(r)}},{"./util":67}],57:[function(e,t,n){function r(e,t){var n=t[0],r=n.pathCache||(n.pathCache=s(u(t)));o(e,r)}function i(e,t,n,r,i,a){var s=t.items,o=t.bounds;return!s||!s.length||o&&!o.contains(i,a)?null:(null!=e.pixelratio&&1!==e.pixelratio&&(n*=e.pixelratio,r*=e.pixelratio),l(e,s,n,r)?s[0]:null)}var a=e("./util"),s=e("../../../path/parse"),o=e("../../../path/render"),u=e("../../../util/svg").path.area,l=a.testPath(r);t.exports={draw:a.drawOne(r),pick:i,nested:!0}},{"../../../path/parse":49,"../../../path/render":50,"../../../util/svg":84,"./util":67}],58:[function(e,t,n){function r(e,t,n){if(t.items&&t.items.length){var r,i,a,s,u,l,c,d,f,h,p=t.items,g=this;for(o.draw.call(g,e,t,n),c=0,d=p.length;d>c;++c){for(r=p[c],a=r.axisItems||[],i=r.items||[],s=r.legendItems||[],u=r.x||0,l=r.y||0,e.save(),e.translate(u,l),r.clip&&(e.beginPath(),e.rect(0,0,r.width||0,r.height||0),e.clip()),n&&n.translate(-u,-l),f=0,h=a.length;h>f;++f)"back"===a[f].layer&&g.draw(e,a[f],n);for(f=0,h=i.length;h>f;++f)g.draw(e,i[f],n);for(f=0,h=a.length;h>f;++f)"back"!==a[f].layer&&g.draw(e,a[f],n);for(f=0,h=s.length;h>f;++f)g.draw(e,s[f],n);n&&n.translate(u,l),e.restore()}}}function i(e,t){return t.fill||t.stroke}function a(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a))return null;var s,o,l,c,d,f,h,p=t.items||[];for(f=p.length;--f>=0;){for(o=p[f],c=o.x||0,d=o.y||0,e.save(),e.translate(c,d),h=o.items.length;--h>=0;)if(s=o.items[h],s.interactive!==!1&&(l=this.pick(s,n,r,i-c,a-d)))return e.restore(),l;e.restore()}return t.interactive!==!1?u(e,t,n,r,i,a):null}var s=e("./util"),o=e("./rect"),u=s.pick(i);t.exports={draw:r,pick:a}},{"./rect":63,"./util":67}],59:[function(e,t,n){function r(e,t,n){if(t.items&&t.items.length)for(var r,i=this,a=t.items,s=0,o=a.length;o>s;++s)if(r=a[s],!n||n.intersects(r.bounds)){r.image&&r.image.url===r.url||(r.image=i.loadImage(r.url),r.image.url=r.url);var u,l=r.x||0,c=r.y||0,d=r.width||r.image&&r.image.width||0,f=r.height||r.image&&r.image.height||0;l-="center"===r.align?d/2:"right"===r.align?d:0,c-="middle"===r.baseline?f/2:"bottom"===r.baseline?f:0,r.image.loaded&&(e.globalAlpha=null!=(u=r.opacity)?u:1,e.drawImage(r.image,l,c,d,f))}}var i=e("./util");t.exports={draw:r,pick:i.pick()}},{"./util":67}],60:[function(e,t,n){t.exports={arc:e("./arc"),area:e("./area"),group:e("./group"),image:e("./image"),line:e("./line"),path:e("./path"),rect:e("./rect"),rule:e("./rule"),symbol:e("./symbol"),text:e("./text")}},{"./arc":56,"./area":57,"./group":58,"./image":59,"./line":61,"./path":62,"./rect":63,"./rule":64,"./symbol":65,"./text":66}],61:[function(e,t,n){function r(e,t){var n=t[0],r=n.pathCache||(n.pathCache=s(u(t)));o(e,r)}function i(e,t,n,r,i,a){var s=t.items,o=t.bounds;return!s||!s.length||o&&!o.contains(i,a)?null:(null!=e.pixelratio&&1!==e.pixelratio&&(n*=e.pixelratio,r*=e.pixelratio),l(e,s,n,r)?s[0]:null)}var a=e("./util"),s=e("../../../path/parse"),o=e("../../../path/render"),u=e("../../../util/svg").path.line,l=a.testPath(r,!1);t.exports={draw:a.drawOne(r),pick:i,nested:!0}},{"../../../path/parse":49,"../../../path/render":50,"../../../util/svg":84,"./util":67}],62:[function(e,t,n){function r(e,t){if(null==t.path)return!0;var n=t.pathCache||(t.pathCache=a(t.path));s(e,n,t.x,t.y)}var i=e("./util"),a=e("../../../path/parse"),s=e("../../../path/render");t.exports={draw:i.drawAll(r),pick:i.pickPath(r)}},{"../../../path/parse":49,"../../../path/render":50,"./util":67}],63:[function(e,t,n){function r(e,t,n){if(t.items&&t.items.length)for(var r,a,s,o,u,l,c=t.items,d=0,f=c.length;f>d;++d)r=c[d],(!n||n.intersects(r.bounds))&&(a=null==r.opacity?1:r.opacity,0!==a&&(s=r.x||0,o=r.y||0,u=r.width||0,l=r.height||0,r.fill&&i.fill(e,r,a)&&e.fillRect(s,o,u,l),r.stroke&&i.stroke(e,r,a)&&e.strokeRect(s,o,u,l)))}var i=e("./util");t.exports={draw:r,pick:i.pick()}},{"./util":67}],64:[function(e,t,n){function r(e,t,n){if(t.items&&t.items.length)for(var r,i,a,o,u,l,c=t.items,d=0,f=c.length;f>d;++d)r=c[d],(!n||n.intersects(r.bounds))&&(i=null==r.opacity?1:r.opacity,0!==i&&(a=r.x||0,o=r.y||0,u=null!=r.x2?r.x2:a,l=null!=r.y2?r.y2:o,r.stroke&&s.stroke(e,r,i)&&(e.beginPath(),e.moveTo(a,o),e.lineTo(u,l),e.stroke())))}function i(e,t){var n=t.x||0,r=t.y||0,i=null!=t.x2?t.x2:n,a=null!=t.y2?t.y2:r,s=t.strokeWidth,o=t.strokeCap;e.lineWidth=null!=s?s:1,e.lineCap=null!=o?o:"butt",e.beginPath(),e.moveTo(n,r),e.lineTo(i,a)}function a(e,t,n,r){return e.isPointInStroke?(i(e,t),e.isPointInStroke(n,r)):!1}var s=e("./util");t.exports={draw:r,pick:s.pick(a)}},{"./util":67}],65:[function(e,t,n){function r(e,t){var n,r,i,o,u=null!=t.size?t.size:100,l=t.x,c=t.y;if(e.beginPath(),null==t.shape||"circle"===t.shape)return n=Math.sqrt(u/Math.PI),e.arc(l,c,n,0,2*Math.PI,0),void e.closePath();switch(t.shape){case"cross":n=Math.sqrt(u/5)/2,r=3*n,e.moveTo(l-r,c-n),e.lineTo(l-n,c-n),e.lineTo(l-n,c-r),e.lineTo(l+n,c-r),e.lineTo(l+n,c-n),e.lineTo(l+r,c-n),e.lineTo(l+r,c+n),e.lineTo(l+n,c+n),e.lineTo(l+n,c+r),e.lineTo(l-n,c+r),e.lineTo(l-n,c+n),e.lineTo(l-r,c+n);break;case"diamond":o=Math.sqrt(u/(2*s)),i=o*s,e.moveTo(l,c-o),e.lineTo(l+i,c),e.lineTo(l,c+o),e.lineTo(l-i,c);break;case"square":r=Math.sqrt(u),n=r/2,e.rect(l-n,c-n,r,r);break;case"triangle-down":i=Math.sqrt(u/a),o=i*a/2,e.moveTo(l,c+o),e.lineTo(l+i,c-o),e.lineTo(l-i,c-o);break;case"triangle-up":i=Math.sqrt(u/a),o=i*a/2,e.moveTo(l,c-o),e.lineTo(l+i,c+o),e.lineTo(l-i,c+o)}e.closePath()}var i=e("./util"),a=Math.sqrt(3),s=Math.tan(30*Math.PI/180);t.exports={draw:i.drawAll(r),pick:i.pickPath(r)}},{"./util":67}],66:[function(e,t,n){function r(e,t,n){if(t.items&&t.items.length)for(var r,i,a,s,l,c,d=t.items,f=0,h=d.length;h>f;++f)r=d[f],(!n||n.intersects(r.bounds))&&(i=null==r.opacity?1:r.opacity,0!==i&&(e.font=o.string(r),e.textAlign=r.align||"left",a=r.x||0,s=r.y||0,(l=r.radius)&&(c=(r.theta||0)-Math.PI/2,a+=l*Math.cos(c),s+=l*Math.sin(c)),r.angle&&(e.save(),e.translate(a,s),e.rotate(r.angle*Math.PI/180),a=s=0),a+=r.dx||0,s+=(r.dy||0)+o.offset(r),r.fill&&u.fill(e,r,i)&&e.fillText(r.text,a,s),r.stroke&&u.stroke(e,r,i)&&e.strokeText(r.text,a,s),r.angle&&e.restore()))}function i(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=s(t,l,!0),u=-t.angle*Math.PI/180,c=Math.cos(u),d=Math.sin(u),f=t.x,h=t.y,p=c*i-d*a+(f-f*c+h*d),g=d*i+c*a+(h-f*d-h*c);
return o.contains(p,g)}var a=e("../../../util/Bounds"),s=e("../../../util/bound").text,o=e("../../../util/font"),u=e("./util"),l=new a;t.exports={draw:r,pick:u.pick(i)}},{"../../../util/Bounds":74,"../../../util/bound":79,"../../../util/font":82,"./util":67}],67:[function(e,t,n){function r(e,t,n,r){if(!e(t,r)){var i=null==n.opacity?1:n.opacity;0!==i&&(n.fill&&c(t,n,i)&&t.fill(),n.stroke&&d(t,n,i)&&t.stroke())}}function i(e,t,n,i){var a,s,o;for(a=0,s=n.items.length;s>a;++a)o=n.items[a],(!i||i.intersects(o.bounds))&&r(e,t,o,o)}function a(e){return function(t,n,r){i(e,t,n,r)}}function s(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&r(e,t,n.items[0],n.items)}}function o(e){return e||(e=p),function(t,n,r,i,a,s){if(!n.items.length)return null;var o,u,l;for(null!=t.pixelratio&&1!==t.pixelratio&&(r*=t.pixelratio,i*=t.pixelratio),l=n.items.length;--l>=0;)if(o=n.items[l],u=o.bounds,(!u||u.contains(a,s))&&u&&e(t,o,r,i,a,s))return o;return null}}function u(e,t){return function(n,r,i,a){var s,o,u=Array.isArray(r)?r[0]:r,l=null==t?u.fill:t,c=u.stroke&&n.isPointInStroke;return c&&(s=u.strokeWidth,o=u.strokeCap,n.lineWidth=null!=s?s:1,n.lineCap=null!=o?o:"butt"),e(n,r)?!1:l&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a)}}function l(e){return o(u(e))}function c(e,t,n){return n*=null==t.fillOpacity?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=f(e,t,t.fill),!0):!1}function d(e,t,n){var r,i=null!=(i=t.strokeWidth)?i:1;return 0>=i?!1:(n*=null==t.strokeOpacity?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=f(e,t,t.stroke),e.lineWidth=i,e.lineCap=null!=(r=t.strokeCap)?r:"butt",e.vgLineDash(t.strokeDash||null),e.vgLineDashOffset(t.strokeDashOffset||0),!0):!1)}function f(e,t,n){return n.id?h(e,n,t.bounds):n}function h(e,t,n){var r,i,a=n.width(),s=n.height(),o=n.x1+t.x1*a,u=n.y1+t.y1*s,l=n.x1+t.x2*a,c=n.y1+t.y2*s,d=e.createLinearGradient(o,u,l,c),f=t.stops;for(r=0,i=f.length;i>r;++r)d.addColorStop(f[r].offset,f[r].color);return d}var p=function(){return!0};t.exports={drawOne:s,drawAll:a,pick:o,pickPath:l,testPath:u,stroke:d,fill:c,color:f,gradient:h}},{}],68:[function(e,t,n){t.exports={canvas:e("./canvas"),svg:e("./svg")}},{"./canvas":55,"./svg":72}],69:[function(e,t,n){function r(){a.call(this)}var i=e("../../util/dom"),a=e("../Handler"),s=a.prototype,o=r.prototype=Object.create(s);o.constructor=r,o.initialize=function(e,t,n){return this._svg=i.find(e,"svg"),s.initialize.call(this,e,t,n)},o.svg=function(){return this._svg},o.listener=function(e){var t=this;return function(n){var r=n.target,i=r.__data__;n.vegaType=n.type,i=Array.isArray(i)?i[0]:i,e.call(t._obj,n,i)}},o.on=function(e,t){var n=this.eventName(e),r=this._svg,i=this._handlers,a={type:e,handler:t,listener:this.listener(t)};return(i[n]||(i[n]=[])).push(a),r.addEventListener(n,a.listener),this},o.off=function(e,t){var n,r=this.eventName(e),i=this._svg,a=this._handlers[r];if(a){for(n=a.length;--n>=0;)(a[n].type===e&&!t||a[n].handler===t)&&(i.removeEventListener(r,a[n].listener),a.splice(n,1));return this}},t.exports=r},{"../../util/dom":81,"../Handler":51}],70:[function(e,t,n){function r(e){c.call(this),this._loader=new l(e),this._dirtyID=0}function i(e,t,n){var r,i,a;for(e=f.child(e,n,"linearGradient",p),e.setAttribute("id",t.id),e.setAttribute("x1",t.x1),e.setAttribute("x2",t.x2),e.setAttribute("y1",t.y1),e.setAttribute("y2",t.y2),r=0,i=t.stops.length;i>r;++r)a=f.child(e,r,"stop",p),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);f.clear(e,r)}function a(e,t,n){var r;e=f.child(e,n,"clipPath",p),e.setAttribute("id",t.id),r=f.child(e,0,"rect",p),r.setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",t.width),r.setAttribute("height",t.height)}function s(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function o(e,t,n,r,i){var a=f.child(e,r,t.tag,p,null,i);if(a.__data__=n,a.__values__={fill:"default"},"g"===t.tag){var s=f.child(a,0,"rect",p,"background");s.__data__=n}return n._svg=a}function u(e,t,n){t!==b[e]&&(null!=t?n?_.setAttributeNS(n,e,t):_.setAttribute(e,t):n?_.removeAttributeNS(n,e):_.removeAttribute(e),b[e]=t)}var l=e("../../util/ImageLoader"),c=e("../Renderer"),d=e("../../util/font"),f=e("../../util/dom"),h=e("../../util/svg"),p=h.metadata.xmlns,g=e("./marks"),m=c.prototype,v=r.prototype=Object.create(m);v.constructor=r,v.initialize=function(e,t,n,r){return e&&(this._svg=f.child(e,0,"svg",p,"marks"),f.clear(e,1),this._root=f.child(this._svg,0,"g",p),f.clear(this._svg,1)),this._defs={clip_id:1,gradient:{},clipping:{}},this.background(this._bgcolor),m.initialize.call(this,e,t,n,r)},v.background=function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),m.background.apply(this,arguments)},v.resize=function(e,t,n){if(m.resize.call(this,e,t,n),this._svg){var r=this._width,i=this._height,a=this._padding;this._svg.setAttribute("width",r+a.left+a.right),this._svg.setAttribute("height",i+a.top+a.bottom),this._root.setAttribute("transform","translate("+a.left+","+a.top+")")}return this},v.svg=function(){if(!this._svg)return null;var e={"class":"marks",width:this._width+this._padding.left+this._padding.right,height:this._height+this._padding.top+this._padding.bottom};for(var t in h.metadata)e[t]=h.metadata[t];return f.openTag("svg",e)+this._svg.innerHTML+f.closeTag("svg")},v.imageURL=function(e){return this._loader.imageURL(e)},v.render=function(e,t){return this._dirtyCheck(t)&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,e,-1),f.clear(this._root,1)),this.updateDefs(),this},v.draw=function(e,t,n){this.drawMark(e,t,n,g[t.marktype])},v.updateDefs=function(){var e,t=this._svg,n=this._defs,r=n.el,s=0;for(e in n.gradient)r||(r=n.el=f.child(t,0,"defs",p)),i(r,n.gradient[e],s++);for(e in n.clipping)r||(r=n.el=f.child(t,0,"defs",p)),a(r,n.clipping[e],s++);r&&(0===s?(t.removeChild(r),n.el=null):f.clear(r,s))},v._resetDefs=function(){var e=this._defs;e.clip_id=1,e.gradient={},e.clipping={}},v.isDirty=function(e){return this._dirtyAll||e.dirty===this._dirtyID},v._dirtyCheck=function(e){if(this._dirtyAll=!0,!e)return!0;var t,n,r,i,a,o,u,l=++this._dirtyID;for(a=0,o=e.length;o>a;++a)t=e[a],n=t.mark,n.marktype!==r&&(r=n.marktype,i=g[r]),"exit"!==t.status?(t=i.nest?n.items[0]:t,t._update!==l&&(t._svg?this._update(i,t._svg,t):(this._dirtyAll=!1,s(t,l)),t._update=l)):t._svg&&(i.nest&&t.mark.items.length?(this._update(i,t._svg,t.mark.items[0]),u=t.mark.items[0],u._svg=t._svg,u._update=l):f.remove(t._svg),t._svg=null);return!this._dirtyAll},v.drawMark=function(e,t,n,r){if(this.isDirty(t)){var i,a,s,u,l,c,d=r.nest?t.items&&t.items.length?[t.items[0]]:[]:t.items||[],h=t.interactive===!1?"none":null,g="g"===r.tag,m=f.cssClass(t);for(i=f.child(e,n+1,"g",p,m),i.setAttribute("class",m),t._svg=i,!g&&h&&i.style.setProperty("pointer-events",h),a=0,s=d.length;s>a;++a)this.isDirty(l=d[a])&&(c=!(this._dirtyAll||l._svg),u=c?o(i,r,l,a,!0):i.childNodes[a]||o(i,r,l,a),this._update(r,u,l),g&&(c&&(this._dirtyAll=!0),this._recurse(u,l),c&&(this._dirtyAll=!1)));return f.clear(i,a),i}},v._recurse=function(e,t){var n,r,i=t.items||[],a=t.legendItems||[],s=t.axisItems||[],o=0;for(n=0,r=s.length;r>n;++n)"back"===s[n].layer&&this.drawMark(e,s[n],o++,g.group);for(n=0,r=i.length;r>n;++n)this.draw(e,i[n],o++);for(n=0,r=s.length;r>n;++n)"back"!==s[n].layer&&this.drawMark(e,s[n],o++,g.group);for(n=0,r=a.length;r>n;++n)this.drawMark(e,a[n],o++,g.group);f.clear(e,1+o)};var y="undefined"!=typeof window?window.location.href:"",_=null,b=null,x={group:function(e,t,n){_=t.childNodes[0],b=t.__values__,e.background(u,n,this);var r=n.mark.interactive===!1?"none":null;r!==b.events&&(_.style.setProperty("pointer-events",r),b.events=r)},text:function(e,t,n){n.text!==b.text&&(t.textContent=n.text||"",b.text=n.text);var r=d.string(n);r!==b.font&&(t.style.setProperty("font",r),b.font=r)}};v._update=function(e,t,n){_=t,b=t.__values__,e.attr(u,n,this);var r=x[e.type];r&&r(e,t,n),this.style(_,n)},v.style=function(e,t){if(null!=t){var n,r,i,a,s;for(n=0,r=h.styleProperties.length;r>n;++n)i=h.styleProperties[n],s=t[i],s!==b[i]&&(a=h.styles[i],null==s?"fill"===a?e.style.setProperty(a,"none"):e.style.removeProperty(a):(s.id&&(this._defs.gradient[s.id]=s,s="url("+y+"#"+s.id+")"),e.style.setProperty(a,s+"")),b[i]=s)}},t.exports=r},{"../../util/ImageLoader":77,"../../util/dom":81,"../../util/font":82,"../../util/svg":84,"../Renderer":52,"./marks":73}],71:[function(e,t,n){function r(e){o.call(this),this._loader=new u(e),this._text={head:"",root:"",foot:"",defs:"",body:""},this._defs={clip_id:1,gradient:{},clipping:{}}}function i(e,t,n,r){v[r||e]=t}function a(e,t,n,r){if(null==e)return"";var i,a,s,o,u,d="";for("bgrect"===n&&t.interactive===!1&&(d+="pointer-events: none;"),"text"===n&&(d+="font: "+c.string(e)+";"),i=0,a=l.styleProperties.length;a>i;++i)s=l.styleProperties[i],o=l.styles[s],u=e[s],null==u?"fill"===o&&(d+=(d.length?" ":"")+"fill: none;"):(u.id&&(r.gradient[u.id]=u,u="url(#"+u.id+")"),d+=(d.length?" ":"")+o+": "+u+";");return d?'style="'+d+'"':null}function s(e){return e=null==e?"":String(e),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var o=e("../Renderer"),u=e("../../util/ImageLoader"),l=e("../../util/svg"),c=e("../../util/font"),d=e("../../util/dom"),f=d.openTag,h=d.closeTag,p=e("./marks"),g=o.prototype,m=r.prototype=Object.create(g);m.constructor=r,m.resize=function(e,t,n){g.resize.call(this,e,t,n);var r=this._padding,i=this._text,a={"class":"marks",width:this._width+r.left+r.right,height:this._height+r.top+r.bottom};for(var s in l.metadata)a[s]=l.metadata[s];return i.head=f("svg",a),i.root=f("g",{transform:"translate("+r.left+","+r.top+")"}),i.foot=h("g")+h("svg"),this},m.svg=function(){var e=this._text;return e.head+e.defs+e.root+e.body+e.foot},m.render=function(e){return this._text.body=this.mark(e),this._text.defs=this.buildDefs(),this},m.reset=function(){return this._defs.clip_id=0,this},m.buildDefs=function(){var e,t,n,r,i=this._defs,a="";for(t in i.gradient){for(n=i.gradient[t],r=n.stops,a+=f("linearGradient",{id:t,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),e=0;e<r.length;++e)a+=f("stop",{offset:r[e].offset,"stop-color":r[e].color})+h("stop");a+=h("linearGradient")}for(t in i.clipping)n=i.clipping[t],a+=f("clipPath",{id:t}),a+=f("rect",{x:0,y:0,width:n.width,height:n.height})+h("rect"),a+=h("clipPath");return a.length>0?f("defs")+a+h("defs"):""},m.imageURL=function(e){return this._loader.imageURL(e)};var v;m.attributes=function(e,t){return v={},e(i,t,this),v},m.mark=function(e){var t,n,r,i=p[e.marktype],o=i.tag,u=i.attr,l=i.nest||!1,c=l?e.items&&e.items.length?[e.items[0]]:[]:e.items||[],g=this._defs,m="";for("g"!==o&&e.interactive===!1&&(t='style="pointer-events: none;"'),m+=f("g",{"class":d.cssClass(e)},t),n=0;n<c.length;++n)r=c[n],t="g"!==o?a(r,e,o,g):null,m+=f(o,this.attributes(u,r),t),"text"===o?m+=s(r.text):"g"===o&&(m+=f("rect",this.attributes(i.background,r),a(r,e,"bgrect",g))+h("rect"),m+=this.markGroup(r)),m+=h(o);return m+h("g")},m.markGroup=function(e){var t,n,r="",i=e.axisItems||[],a=e.items||[],s=e.legendItems||[];for(t=0,n=i.length;n>t;++t)"back"===i[t].layer&&(r+=this.mark(i[t]));for(t=0,n=a.length;n>t;++t)r+=this.mark(a[t]);for(t=0,n=i.length;n>t;++t)"back"!==i[t].layer&&(r+=this.mark(i[t]));for(t=0,n=s.length;n>t;++t)r+=this.mark(s[t]);return r},t.exports=r},{"../../util/ImageLoader":77,"../../util/dom":81,"../../util/font":82,"../../util/svg":84,"../Renderer":52,"./marks":73}],72:[function(e,t,n){t.exports={Handler:e("./SVGHandler"),Renderer:e("./SVGRenderer"),string:{Renderer:e("./SVGStringRenderer")}}},{"./SVGHandler":69,"./SVGRenderer":70,"./SVGStringRenderer":71}],73:[function(e,t,n){function r(e){return i(e.x||0,e.y||0)}function i(e,t){return"translate("+e+","+t+")"}var a=e("../../util/font"),s=e("../../util/svg"),o=s.textAlign,u=s.path;t.exports={arc:{tag:"path",type:"arc",attr:function(e,t){e("transform",r(t)),e("d",u.arc(t))}},area:{tag:"path",type:"area",nest:!0,attr:function(e,t){var n=t.mark.items;n.length&&e("d",u.area(n))}},group:{tag:"g",type:"group",attr:function(e,t,n){var i,a,s=null;e("transform",r(t)),t.clip&&(i=n._defs,s=t.clip_id||(t.clip_id="clip"+i.clip_id++),a=i.clipping[s]||(i.clipping[s]={id:s}),a.width=t.width||0,a.height=t.height||0),e("clip-path",s?"url(#"+s+")":null)},background:function(e,t){e("class","background"),e("width",t.width||0),e("height",t.height||0)}},image:{tag:"image",type:"image",attr:function(e,t,n){var r=t.x||0,a=t.y||0,s=t.width||0,o=t.height||0,u=n.imageURL(t.url);r-="center"===t.align?s/2:"right"===t.align?s:0,a-="middle"===t.baseline?o/2:"bottom"===t.baseline?o:0,e("href",u,"http://www.w3.org/1999/xlink","xlink:href"),e("transform",i(r,a)),e("width",s),e("height",o)}},line:{tag:"path",type:"line",nest:!0,attr:function(e,t){var n=t.mark.items;n.length&&e("d",u.line(n))}},path:{tag:"path",type:"path",attr:function(e,t){e("transform",r(t)),e("d",t.path)}},rect:{tag:"rect",type:"rect",nest:!1,attr:function(e,t){e("transform",r(t)),e("width",t.width||0),e("height",t.height||0)}},rule:{tag:"line",type:"rule",attr:function(e,t){e("transform",r(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)}},symbol:{tag:"path",type:"symbol",attr:function(e,t){e("transform",r(t)),e("d",u.symbol(t))}},text:{tag:"text",type:"text",nest:!1,attr:function(e,t){var n,r=t.dx||0,s=(t.dy||0)+a.offset(t),u=t.x||0,l=t.y||0,c=t.angle||0,d=t.radius||0;d&&(n=(t.theta||0)-Math.PI/2,u+=d*Math.cos(n),l+=d*Math.sin(n)),e("text-anchor",o[t.align]||"start"),c?(n=i(u,l)+" rotate("+c+")",(r||s)&&(n+=" "+i(r,s))):n=i(u+r,l+s),e("transform",n)}}}},{"../../util/font":82,"../../util/svg":84}],74:[function(e,t,n){function r(e){this.clear(),e&&this.union(e)}var i=r.prototype;i.clone=function(){return new r(this)},i.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},i.set=function(e,t,n,r){return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this},i.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},i.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},i.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},i.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},i.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,s=n-t*i-n*r,o=this.x1,u=this.x2,l=this.y1,c=this.y2;return this.clear().add(r*o-i*l+a,i*o+r*l+s).add(r*o-i*c+a,i*o+r*c+s).add(r*u-i*l+a,i*u+r*l+s).add(r*u-i*c+a,i*u+r*c+s)},i.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},i.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},i.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},i.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},i.width=function(){return this.x2-this.x1},i.height=function(){return this.y2-this.y1},t.exports=r},{}],75:[function(e,t,n){t.exports=function(e){function t(){}function n(t,n){e.add(t,n)}return{bounds:function(t){return arguments.length?(e=t,this):e},beginPath:t,closePath:t,moveTo:n,lineTo:n,quadraticCurveTo:function(t,n,r,i){e.add(t,n),e.add(r,i)},bezierCurveTo:function(t,n,r,i,a,s){e.add(t,n),e.add(r,i),e.add(a,s)}}}},{}],76:[function(e,t,n){function r(e){this.id="gradient_"+i++,this.type=e||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var i=0,a=r.prototype;a.stop=function(e,t){return this.stops.push({offset:e,color:t}),this},t.exports=r},{}],77:[function(e,t,n){(function(n){function r(e){this._pending=0,this._config=e||r.Config}function i(e,t){var n=s.sanitizeUrl(this.params(e));if(!n)return t&&t(e,null),null;var r=this,i=new Image;return r._pending+=1,i.onload=function(){r._pending-=1,i.loaded=!0,t&&t(null,i)},i.src=n,i}function a(e,t){var r=this,i=new("undefined"!=typeof window?window.canvas:"undefined"!=typeof n?n.canvas:null).Image;return r._pending+=1,s(this.params(e),function(e,n){return r._pending-=1,e?(t&&t(e,null),null):(i.src=n,i.loaded=!0,void(t&&t(null,i)))}),i}var s=e("datalib/src/import/load");r.Config=null;var o=r.prototype;o.pending=function(){return this._pending},o.params=function(e){var t,n={url:e};for(t in this._config)n[t]=this._config[t];return n},o.imageURL=function(e){return s.sanitizeUrl(this.params(e))},o.loadImage=function(e,t){return s.useXHR?i.call(this,e,t):a.call(this,e,t)},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"datalib/src/import/load":20}],78:[function(e,t,n){function r(e){this.mark=e}var i=r.prototype;i.hasPropertySet=function(e){var t=this.mark.def.properties;return t&&null!=t[e]},i.cousin=function(e,t){if(0===e)return this;e=e||-1;var n=this.mark,r=n.group,i=null==t?n.items.indexOf(this):t,a=r.items.indexOf(n)+e;return r.items[a].items[i]},i.sibling=function(e){if(0===e)return this;e=e||-1;var t=this.mark,n=t.items.indexOf(this)+e;return t.items[n]},i.remove=function(){var e=this,t=e.mark.items,n=t.indexOf(e);return n>=0&&(n===t.length-1?t.pop():t.splice(n,1)),e},i.touch=function(){this.pathCache&&(this.pathCache=null)},t.exports=r},{}],79:[function(e,t,n){function r(){return D||(D=b.instance(1,1).getContext("2d"))}function i(e,t){return e.stroke&&0!==e.opacity&&0!==e.stokeOpacity&&t.expand(null!=e.strokeWidth?e.strokeWidth:1),t}function a(e,t,n,r,a){return null==t?n.set(0,0,0,0):(M(N.bounds(n),t,r,a),i(e,n)),n}function s(e,t){var n=e.path?e.pathCache||(e.pathCache=S(e.path)):null;return a(e,n,t,e.x,e.y)}function o(e,t){if(0===e.items.length)return t;var n=e.items,r=n[0],i=r.pathCache||(r.pathCache=S(T(n)));return a(r,i,t)}function u(e,t){if(0===e.items.length)return t;var n=e.items,r=n[0],i=r.pathCache||(r.pathCache=S(A(n)));return a(r,i,t)}function l(e,t){var n,r;return i(e,t.set(n=e.x||0,r=e.y||0,n+e.width||0,r+e.height||0))}function c(e,t){var n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return n-="center"===e.align?i/2:"right"===e.align?i:0,r-="middle"===e.baseline?a/2:"bottom"===e.baseline?a:0,t.set(n,r,n+i,r+a)}function d(e,t){var n,r;return i(e,t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r))}function f(e,t){var n,r,a,s,o,u,l,c,d,f=e.x||0,h=e.y||0,p=e.innerRadius||0,g=e.outerRadius||0,m=(e.startAngle||0)-E,v=(e.endAngle||0)-E,y=1/0,_=-(1/0),b=1/0,x=-(1/0),w=[m,v],k=m-m%E;for(r=0;4>r&&v>k;++r,k+=E)w.push(k);for(r=0,a=w.length;a>r;++r)n=w[r],s=Math.cos(n),u=p*s,c=g*s,o=Math.sin(n),l=p*o,d=g*o,y=Math.min(y,u,c),_=Math.max(_,u,c),b=Math.min(b,l,d),x=Math.max(x,l,d);return i(e,t.set(f+y,h+b,f+_,h+x))}function h(e,t){var n,r,a,s,o=null!=e.size?e.size:100,u=e.x||0,l=e.y||0;switch(e.shape){case"cross":r=3*Math.sqrt(o/5)/2,t.set(u-r,l-r,u+r,l+r);break;case"diamond":s=Math.sqrt(o/(2*C)),a=s*C,t.set(u-a,l-s,u+a,l+s);break;case"square":r=Math.sqrt(o),n=r/2,t.set(u-n,l-n,u+n,l+n);break;case"triangle-down":a=Math.sqrt(o/L),s=a*L/2,t.set(u-a,l-s,u+a,l+s);break;case"triangle-up":a=Math.sqrt(o/L),s=a*L/2,t.set(u-a,l-s,u+a,l+s);break;default:n=Math.sqrt(o/Math.PI),t.set(u-n,l-n,u+n,l+n)}return i(e,t)}function p(e,t,n){var i,a,s=r(),o=w.size(e),u=e.align,l=e.radius||0,c=e.x||0,d=e.y||0,f=e.dx||0,h=(e.dy||0)+w.offset(e)-Math.round(.8*o);return l&&(a=(e.theta||0)-Math.PI/2,c+=l*Math.cos(a),d+=l*Math.sin(a)),s.font=w.string(e),i=s.measureText(null!=e.text?e.text:"").width,"center"===u?f-=i/2:"right"===u&&(f-=i),t.set(f+=c,h+=d,f+i,h+o),e.angle&&!n&&t.rotate(e.angle*Math.PI/180,c,d),t.expand(n?0:1)}function g(e,t,n){var r,a,s=e.axisItems||[],o=e.items||[],u=e.legendItems||[];for(r=0,a=s.length;a>r;++r)t.union(s[r].bounds);for(r=0,a=o.length;a>r;++r)t.union(o[r].bounds);if(n)for(r=0,a=u.length;a>r;++r)t.union(u[r].bounds);return(e.width||e.height)&&i(e,t.add(0,0).add(e.width||0,e.height||0)),t.translate(e.x||0,e.y||0)}function m(e,t,n){var r=e.mark.marktype;t=t||P[r],t.nest&&(e=e.mark);var i=e.bounds,a=e["bounds:prev"]||(e["bounds:prev"]=new _);return i?(a.clear().union(i),i.clear()):e.bounds=new _,t(e,e.bounds,n),i||a.clear().union(e.bounds),e.bounds}function v(e,t,n){var r,i,a,s,o=e.marktype,u=P[o],l=e.items,c=l&&l.length;if(u.nest)return a=c?l[0]:(I.mark=e,I),s=m(a,u,n),t=t&&t.union(s)||s;if(t=t||e.bounds&&e.bounds.clear()||new _,c)for(r=0,i=l.length;i>r;++r)t.union(m(l[r],u,n));return e.bounds=t}var y=e("./BoundsContext"),_=e("./Bounds"),b=e("./canvas"),x=e("./svg"),w=e("./font"),k=e("../path"),S=k.parse,M=k.render,T=x.path.area,A=x.path.line,E=Math.PI/2,L=Math.sqrt(3),C=Math.tan(30*Math.PI/180),D=null,N=y(),P={group:g,symbol:h,image:c,rect:l,rule:d,arc:f,text:p,path:s,area:o,line:u};P.area.nest=!0,P.line.nest=!0;var I={mark:null};t.exports={mark:v,item:m,text:p,group:g}},{"../path":48,"./Bounds":74,"./BoundsContext":75,"./canvas":80,"./font":82,"./svg":84}],80:[function(e,t,n){(function(e){function n(t,n){t=t||1,n=n||1;var r;if("undefined"!=typeof document&&document.createElement)r=document.createElement("canvas"),r.width=t,r.height=n;else{var i="undefined"!=typeof window?window.canvas:"undefined"!=typeof e?e.canvas:null;if(!i.prototype)return null;r=new i(t,n)}return a(r)}function r(e,t,n,r,a){var s=this._ctx=e.getContext("2d"),o=1;return e.width=t+r.left+r.right,e.height=n+r.top+r.bottom,a&&"undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&(s.pixelratio=o=i(e)||1),s.setTransform(o,0,0,o,o*r.left,o*r.top),e}function i(e){var t=e.getContext("2d"),n=window&&window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=e.width,s=e.height;e.width=a*i,e.height=s*i,e.style.width=a+"px",e.style.height=s+"px"}return i}function a(e){var t=e.getContext("2d");if(!t.vgLineDash){var n=function(){},r=[];return t.setLineDash?(t.vgLineDash=function(e){this.setLineDash(e||r)},t.vgLineDashOffset=function(e){this.lineDashOffset=e}):void 0!==t.webkitLineDash?(t.vgLineDash=function(e){this.webkitLineDash=e||r},t.vgLineDashOffset=function(e){this.webkitLineDashOffset=e}):void 0!==t.mozDash?(t.vgLineDash=function(e){this.mozDash=e},t.vgLineDashOffset=n):(t.vgLineDash=n,t.vgLineDashOffset=n),e}}t.exports={instance:n,resize:r,lineDash:a}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],81:[function(e,t,n){function r(e,t,n){return n?e.createElementNS(n,t):e.createElement(t)}function i(e){if(e){var t=e.parentNode;t&&(t.removeChild(e),t.childNodes&&t.childNodes.length||i(t))}}t.exports={find:function(e,t){t=t.toLowerCase();for(var n=0,r=e.childNodes.length;r>n;++n)if(e.childNodes[n].tagName.toLowerCase()===t)return e.childNodes[n]},child:function(e,t,n,i,a,s){var o,u;return o=u=e.childNodes[t],(!o||s||o.tagName.toLowerCase()!==n.toLowerCase()||a&&o.getAttribute("class")!=a)&&(o=r(e.ownerDocument,n,i),e.insertBefore(o,u),a&&o.setAttribute("class",a)),o},clear:function(e,t){for(var n=e.childNodes.length;n>t;)e.removeChild(e.childNodes[--n]);return e},remove:i,cssClass:function(e){return"mark-"+e.marktype+(e.name?" "+e.name:"")},openTag:function(e,t,n){var r,i,a="<"+e;if(t)for(r in t)i=t[r],null!=i&&(a+=" "+r+'="'+i+'"');return n&&(a+=" "+n),a+">"},closeTag:function(e){return"</"+e+">"}}},{}],82:[function(e,t,n){function r(e){return null!=e.fontSize?e.fontSize:11}t.exports={size:r,string:function(e,t){var n=e.font;return t&&n&&(n=String(n).replace(/\"/g,"'")),""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+r(e)+"px "+(n||"sans-serif")},offset:function(e){var t=e.baseline,n=r(e);return Math.round("top"===t?.93*n:"middle"===t?.3*n:"bottom"===t?-.21*n:0)}}},{}],83:[function(e,t,n){function r(e,t){return JSON.stringify(e,u,t)}function i(e){var t="string"==typeof e?JSON.parse(e):e;return a(t)}function a(e){var t,n,r,i,u,l=e.marktype;for(r=0,i=o.length;i>r;++r)if(u=e[o[r]])for(t=0,n=u.length;n>t;++t)u[t][l?"mark":"group"]=e,l&&"group"!==l||a(u[t]);return l&&s.mark(e),e}var s=e("../util/bound"),o=["items","axisItems","legendItems"],u=["marktype","name","interactive","clip","items","axisItems","legendItems","layer","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","interpolate","tension","orient","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"];t.exports={toJSON:r,fromJSON:i}},{"../util/bound":79}],84:[function(e,t,n){(function(e){function n(e){return e.x||0}function r(e){return e.y||0}function i(e){return(e.x||0)+(e.width||0)}function a(e){return(e.y||0)+(e.height||0)}function s(e){return null==e.size?100:e.size}function o(e){return e.shape||"circle"}var u=("undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null).svg,l=u.area().x(n).y1(r).y0(a),c=u.area().y(r).x1(n).x0(i),d=u.line().x(n).y(r);t.exports={metadata:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},path:{arc:u.arc(),symbol:u.symbol().type(o).size(s),area:function(e){var t=e[0];return("horizontal"===t.orient?c:l).interpolate(t.interpolate||"linear").tension(t.tension||.7)(e)},line:function(e){var t=e[0];return d.interpolate(t.interpolate||"linear").tension(t.tension||.7)(e)}},textAlign:{left:"start",center:"middle",right:"end"},textBaseline:{top:"before-edge",bottom:"after-edge",middle:"central"},styles:{fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},styleProperties:["fill","fillOpacity","stroke","strokeWidth","strokeOpacity","strokeCap","strokeDash","strokeDashOffset","opacity"]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],85:[function(e,t,n){function r(e,t,n){o.call(null,e,t,n),this._type="canvas",this._renderers={canvas:a,svg:s}}var i=e("vega-scenegraph").render,a=i.canvas,s=i.svg.string,o=e("./View"),u=r.prototype=new o;u.renderer=function(e){return e&&(this._type=e),o.prototype.renderer.apply(this,arguments)},u.canvas=function(){return"canvas"===this._type?this._renderer.canvas():null},u.canvasAsync=function(e){function t(){0===n.pendingImages()?(r.render(),e(r.canvas())):setTimeout(t,10)}var n=this._renderer,r=this;return"canvas"!==this._type?null:void(n.pendingImages()>0?t():e(this.canvas()))},u.svg=function(){return"svg"===this._type?this._renderer.svg():null},u.initialize=function(){var e=this._width,t=this._height,n=this._bgcolor,r=this._padding,i=this.model().config();return this._viewport&&(e=this._viewport[0]-(r?r.left+r.right:0),t=this._viewport[1]-(r?r.top+r.bottom:0)),this._renderer=(this._renderer||new this._io.Renderer(i.load)).initialize(null,e,t,r).background(n),this},t.exports=r},{"./View":87,"vega-scenegraph":46}],86:[function(e,t,n){function r(e){this._defs={},this._predicates={},this._scene=null,this._node=null,this._builder=null,this._reset={axes:!1,legends:!1},this.config(e),u.init.call(this)}function i(e){var t=this,n={};return a.isArray(e)?(e.forEach(function(e){n[e]=t._predicates[e]}),n):this._predicates[e]}var a=e("datalib"),s=e("vega-dataflow"),o=s.ChangeSet,u=s.Graph.prototype,l=s.Node,c=e("../scene/GroupBuilder"),d=e("../scene/visit"),f=e("./config"),h=r.prototype=Object.create(u);h.constructor=r,h.defs=function(e){return arguments.length?(this._defs=e,this):this._defs},h.config=function(e){if(!arguments.length)return this._config;this._config=Object.create(f);for(var t in e){var n=e[t],r=this._config[t];a.isObject(n)&&a.isObject(r)?a.extend(r,n):this._config[t]=n}return this},h.width=function(e){return this._defs&&(this._defs.width=e),this._defs&&this._defs.marks&&(this._defs.marks.width=e),this._scene&&(this._scene.items[0].width=e,this._scene.items[0]._dirty=!0),this._reset.axes=!0,this},h.height=function(e){return this._defs&&(this._defs.height=e),this._defs&&this._defs.marks&&(this._defs.marks.height=e),this._scene&&(this._scene.items[0].height=e,this._scene.items[0]._dirty=!0),this._reset.axes=!0,this},h.node=function(){return this._node||(this._node=new l(this))},h.data=function(){var e=u.data.apply(this,arguments);return arguments.length>1&&this.node().addListener(e.pipeline()[0]),e},h.predicate=function(e,t){return 1===arguments.length?i.call(this,e):this._predicates[e]=t},h.predicates=function(){return this._predicates},h.scene=function(e){if(!arguments.length)return this._scene;this._builder&&this.node().removeListener(this._builder.disconnect()),this._builder=new c(this,this._defs.marks,this._scene={}),this.node().addListener(this._builder.connect());var t=this._builder.pipeline();return t[t.length-1].addListener(e),this},h.reset=function(){return this._scene&&this._reset.axes&&(d(this._scene,function(e){e.axes&&e.axes.forEach(function(e){e.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(d(this._scene,function(e){e.legends&&e.legends.forEach(function(e){e.reset()})}),this._reset.legends=!1),this},h.addListener=function(e){this.node().addListener(e)},h.removeListener=function(e){this.node().removeListener(e)},h.fire=function(e){e||(e=o.create()),this.propagate(e,this.node())},t.exports=r},{"../scene/GroupBuilder":110,"../scene/visit":115,"./config":88,datalib:24,"vega-dataflow":39}],87:[function(e,t,n){(function(n){function r(e,t,n){this._el=null,this._model=null,this._width=this.__width=t||500,this._height=this.__height=n||300,this._bgcolor=null,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._streamer=null,this._changeset=null,this._repaint=!0,this._renderers=l,this._io=null,this._api={}}function i(e){var t=this,n=this._model.data(e),r=n.name(),i=n.pipeline()[0],a=this._streamer,s={};return this._api[e]?this._api[e]:(s.insert=function(e){return n.insert(o.duplicate(e)),a.addListener(i),t._changeset.data[r]=1,s},s.update=function(){return a.addListener(i),t._changeset.data[r]=1,n.update.apply(n,arguments),s},s.remove=function(){return a.addListener(i),t._changeset.data[r]=1,n.remove.apply(n,arguments),s},s.values=function(){return n.values()},this._api[e]=s)}function a(){var e=this;return e._renderNode=new u.Node(e._model).router(!0),e._renderNode.evaluate=function(t){c.debug(t,["rendering"]);var n=e._model.scene(),r=e._handler;r&&r.scene&&r.scene(n),t.trans?t.trans.start(function(t){e._renderer.render(n,t)}):e._repaint?(e._renderer.render(n),e._repaint=!1):t.dirty.length&&e._renderer.render(n,t.dirty),t.dirty.length&&(t.dirty.forEach(function(e){e._dirty=!1}),n.items[0]._dirty=!1);for(var i in t.data)e._model.data(i).synchronize();return t},e._model.scene(e._renderNode),!0}var s="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,o=e("datalib"),u=e("vega-dataflow"),l=e("vega-scenegraph").render,c=e("vega-logging"),d=u.Dependencies,f=e("../parse/streams"),h=e("../scene/Encoder"),p=e("../scene/Transition"),g=r.prototype;g.model=function(e){return arguments.length?(this._model!==e&&(this._model=e,this._streamer=new u.Node(e),this._streamer._rank=-1,this._changeset=u.ChangeSet.create(),this._handler&&this._handler.model(e)),this):this._model},g.data=function(e){var t=this;return arguments.length?o.isString(e)?i.call(t,e):(o.isObject(e)&&o.keys(e).forEach(function(n){var r=i.call(t,n);e[n](r)}),this):t._model.values()},g.signal=function(e,t){var n=this._model,r=this._changeset,i=this._streamer,a=e;return arguments.length?1==arguments.length&&o.isString(e)?n.values(d.SIGNALS,e):(2==arguments.length&&(a={},a[e]=t),o.keys(a).forEach(function(e){
i.addListener(n.signal(e).value(a[e])),r.signals[e]=1,r.reflow=!0}),this):n.values(d.SIGNALS)},g.width=function(e){return arguments.length?(this.__width!==e&&(this._width=this.__width=e,this.model().width(e),this.initialize(),this._strict&&(this._autopad=1)),this):this.__width},g.height=function(e){return arguments.length?(this.__height!==e&&(this._height=this.__height=e,this.model().height(e),this.initialize(),this._strict&&(this._autopad=1)),this):this.__height},g.background=function(e){return arguments.length?(this._bgcolor!==e&&(this._bgcolor=e,this.initialize()),this):this._bgcolor},g.padding=function(e){return arguments.length?(this._padding!==e&&(o.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this._renderer&&this._renderer.resize(this._width,this._height,e),this._handler&&this._handler.padding(e)),this._repaint=!0,this):this._padding},g.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this.model().scene().bounds,n=this._padding,r=this.model().config(),i=r.autopadInset,a=t.x1<0?Math.ceil(-t.x1)+i:0,s=t.y1<0?Math.ceil(-t.y1)+i:0,o=t.x2>this._width?Math.ceil(+t.x2-this._width)+i:0;return t=t.y2>this._height?Math.ceil(+t.y2-this._height)+i:0,n={left:a,top:s,right:o,bottom:t},this._strict?(this._autopad=0,this._padding=n,this._width=Math.max(0,this.__width-(a+o)),this._height=Math.max(0,this.__height-(s+t)),this._model.width(this._width).height(this._height).reset(),this.initialize().update({props:"enter"}).update({props:"update"})):this.padding(n).update(e),this},g.viewport=function(e){return arguments.length?(this._viewport!==e&&(this._viewport=e,this.initialize()),this):this._viewport},g.renderer=function(e){if(!arguments.length)return this._renderer;if(this._renderers[e])e=this._renderers[e];else{if(o.isString(e))throw new Error("Unknown renderer: "+e);if(!e)throw new Error("No renderer specified")}return this._io!==e&&(this._io=e,this._renderer=null,this.initialize(),this._build&&this.render()),this},g.initialize=function(e){var t,n=this,r=n._width,i=n._height,a=n._padding,o=n._bgcolor,u=this.model().config();return arguments.length&&null!==e||(e=this._el?this._el.parentNode:null)?(s.select(e).select("div.vega").remove(),this._el=e=s.select(e).append("div").attr("class","vega").style("position","relative").node(),n._viewport&&s.select(e).style("width",(n._viewport[0]||r)+"px").style("height",(n._viewport[1]||i)+"px").style("overflow","auto"),l.canvas.Renderer.RETINA=u.render.retina,n._renderer=(n._renderer||new this._io.Renderer(u.load)).initialize(e,r,i,a).background(o),t=n._handler,n._handler=(new this._io.Handler).initialize(e,a,n),t?t.handlers().forEach(function(e){n._handler.on(e.type,e.handler)}):n._detach=f(this),this._repaint=!0,this):this},g.destroy=function(){this._detach&&this._detach()},g.update=function(e){e=e||{};var t=this,n=e.duration?new p(e.duration,e.ease):null,r=t._changeset;if(n&&(r.trans=n),void 0!==e.props){if(o.keys(r.data).length>0)throw Error("New data values are not reflected in the visualization. Please call view.update() before updating a specified property set.");r.reflow=!0,r.request=e.props}var i=t._build;return t._build=t._build||a.call(this),e.items&&i?(h.update(this._model,e.trans,e.props,e.items,r.dirty),t._renderNode.evaluate(r)):t._streamer.listeners().length&&i?(t._model.propagate(r,t._streamer),t._streamer.disconnect()):t._model.fire(r),t._changeset=u.ChangeSet.create(),t.autopad(e)},g.toImageURL=function(e){var t,n=this;switch(e||"png"){case"canvas":case"png":t=l.canvas.Renderer;break;case"svg":t=l.svg.string.Renderer;break;default:throw Error("Unrecognized renderer type: "+e)}var r=l.canvas.Renderer.RETINA;l.canvas.Renderer.RETINA=!1;var i=new t(n._model.config.load).initialize(null,n._width,n._height,n._padding).render(n._model.scene());if(l.canvas.Renderer.RETINA=r,"svg"===e){var a=new Blob([i.svg()],{type:"image/svg+xml"});return window.URL.createObjectURL(a)}return i.canvas().toDataURL("image/png")},g.render=function(e){return this._renderer.render(this._model.scene(),e),this},g.on=function(){return this._handler.on.apply(this._handler,arguments),this},g.onSignal=function(e,t){return this._model.signal(e).on(t),this},g.off=function(){return this._handler.off.apply(this._handler,arguments),this},g.offSignal=function(e,t){return this._model.signal(e).off(t),this},r.factory=function(t){var n=e("./HeadlessView");return function(e){e=e||{};var i=t.defs(),a=(e.el?new r:new n).model(t).renderer(e.renderer||"canvas").width(i.width).height(i.height).background(i.background).padding(i.padding).viewport(i.viewport).initialize(e.el);return e.data&&a.data(e.data),e.hover!==!1&&e.el&&a.on("mouseover",function(e,t){t&&t.hasPropertySet("hover")&&this.update({props:"hover",items:t})}).on("mouseout",function(e,t){t&&t.hasPropertySet("hover")&&this.update({props:"update",items:t})}),a}},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../parse/streams":105,"../scene/Encoder":109,"../scene/Transition":112,"./HeadlessView":85,datalib:24,"vega-dataflow":39,"vega-logging":45,"vega-scenegraph":46}],88:[function(e,t,n){(function(e){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null,r={};r.load={baseURL:"",domainWhiteList:!1},r.autopadInset=5,r.scale={time:n.time.scale,utc:n.time.scale.utc},r.render={retina:!0},r.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#000",gridOpacity:.15,tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},r.legend={orient:"right",offset:20,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},r.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},r.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],89:[function(e,t,n){function r(e,t,n){var r=e.schema;r&&(r.refs&&i.extend(n.refs,r.refs),r.defs&&i.extend(n.defs,r.defs))}var i=e("datalib"),a=e("../parse"),s=e("../scene/Scale"),o=e("./config");t.exports=function(e){var t=null;return e=e||{},e.url?t=i.json(i.extend({url:e.url},o.load)):(t={$schema:"http://json-schema.org/draft-04/schema#",title:"Vega Visualization Specification Language",defs:{},refs:{},$ref:"#/defs/spec"},i.keys(a).forEach(function(n){r(a[n],e,t)}),r(s,e,t)),e.properties&&i.keys(e.properties).forEach(function(n){t.defs.propset.properties[n]={$ref:"#/refs/"+e.properties[n]+"Value"}}),e.propertySets&&i.keys(e.propertySets).forEach(function(e){t.defs.mark.properties.properties.properties[e]={$ref:"#/defs/propset"}}),t}},{"../parse":95,"../scene/Scale":111,"./config":88,datalib:24}],90:[function(e,t,n){function r(e,t,n,r){var a=e.config();(t||[]).forEach(function(t,o){n[o]=n[o]||s(e),i(a,t,o,n[o],r)})}function i(e,t,n,r,i){void 0!==t.scale&&r.scale(i.scale(t.scale)),r.orient(t.orient||o[t.type]),r.offset(t.offset||0),r.layer(t.layer||"front"),r.grid(t.grid||!1),r.title(t.title||null),r.titleOffset(null!=t.titleOffset?t.titleOffset:e.axis.titleOffset),r.tickValues(t.values||null),r.tickFormat(t.format||null),r.tickFormatType(t.formatType||null),r.tickSubdivide(t.subdivide||0),r.tickPadding(t.tickPadding||e.axis.padding);var s=[];if(void 0!==t.tickSize)for(var u=0;3>u;++u)s.push(t.tickSize);else{var l=e.axis.tickSize;s=[l,l,l]}null!=t.tickSizeMajor&&(s[0]=t.tickSizeMajor),null!=t.tickSizeMinor&&(s[1]=t.tickSizeMinor),null!=t.tickSizeEnd&&(s[2]=t.tickSizeEnd),s.length&&r.tickSize.apply(r,s),r.tickCount(t.ticks||e.axis.ticks);var c=t.properties;c&&c.ticks?(r.majorTickProperties(c.majorTicks?a.extend({},c.ticks,c.majorTicks):c.ticks),r.minorTickProperties(c.minorTicks?a.extend({},c.ticks,c.minorTicks):c.ticks)):(r.majorTickProperties(c&&c.majorTicks||{}),r.minorTickProperties(c&&c.minorTicks||{})),r.tickLabelProperties(c&&c.labels||{}),r.titleProperties(c&&c.title||{}),r.gridLineProperties(c&&c.grid||{}),r.domainProperties(c&&c.axis||{})}var a=e("datalib"),s=e("../scene/axis"),o={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};t.exports=r},{"../scene/axis":113,datalib:24}],91:[function(e,t,n){(function(e){function n(e){return null==e?null:r.rgb(e)+""}var r="undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null;t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],92:[function(e,t,n){function r(e,t,n){function s(t){return function(r,s){r?a.error("LOADING FAILED: "+t.url+" "+r):e.data(t.name).values(i.read(s,t.format)),0===--u&&n()}}var o=e.config(),u=0;return(t||[]).forEach(function(t){t.url&&(u+=1,i.load(i.extend({url:t.url},o.load),s(t))),r.datasource(e,t)}),0===u&&setTimeout(n,1),t}var i=e("datalib"),a=e("vega-logging"),s=e("./transforms"),o=e("./modify");r.datasource=function(e,t){var n=(t.transform||[]).map(function(t){return s(e,t)}),r=(t.modify||[]).map(function(n){return o(e,n,t)}),a=e.data(t.name,r.concat(n));return t.values?a.values(i.read(t.values,t.format)):t.source&&(a.source(t.source).addListener(a),e.removeListener(a.pipeline()[0])),a},t.exports=r},{"./modify":99,"./transforms":106,datalib:24,"vega-logging":45}],93:[function(e,t,n){t.exports=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,a){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=a,this.name="SyntaxError"}function n(e){function n(t){function n(t,n,r){var i,a;for(i=n;r>i;i++)a=e.charAt(i),"\n"===a?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return ut!==t&&(ut>t&&(ut=0,lt={line:1,column:1,seenCR:!1}),n(lt,ut,t),ut=t),lt}function r(e){ct>st||(st>ct&&(ct=st,dt=[]),dt.push(e))}function i(r,i,a){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,a,s=new Array(e.length);for(a=0;a<e.length;a++)s[a]=e[a].description;return r=e.length>1?s.slice(0,-1).join(", ")+" or "+s[e.length-1]:s[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var u=n(a),l=a<e.length?e.charAt(a):null;return null!==i&&s(i),new t(null!==r?r:o(i,l),i,l,a,u.line,u.column)}function a(){var e;return e=s()}function s(){var t,n,i,a,u,l;return t=st,n=o(),n!==_?(i=m(),i!==_?(44===e.charCodeAt(st)?(a=k,st++):(a=_,0===ft&&r(S)),a!==_?(u=m(),u!==_?(l=s(),l!==_?(ot=t,n=M(n,l),t=n):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w),t===_&&(t=st,n=o(),n!==_&&(ot=t,n=T(n)),t=n),t}function o(){var t,n,i,a,s,l,c,d,f,h,p,g,v,y;return t=st,91===e.charCodeAt(st)?(n=A,st++):(n=_,0===ft&&r(E)),n!==_?(i=m(),i!==_?(a=u(),a!==_?(s=m(),s!==_?(44===e.charCodeAt(st)?(l=k,st++):(l=_,0===ft&&r(S)),l!==_?(c=m(),c!==_?(d=u(),d!==_?(f=m(),f!==_?(93===e.charCodeAt(st)?(h=L,st++):(h=_,0===ft&&r(C)),h!==_?(p=m(),p!==_?(62===e.charCodeAt(st)?(g=D,st++):(g=_,0===ft&&r(N)),g!==_?(v=m(),v!==_?(y=o(),y!==_?(ot=t,n=P(a,d,y),t=n):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w),t===_&&(t=u()),t}function u(){var e,t,n,r;if(e=st,t=l(),t!==_){if(n=[],r=f(),r!==_)for(;r!==_;)n.push(r),r=f();else n=w;n!==_?(ot=e,t=I(t,n),e=t):(st=e,e=w)}else st=e,e=w;return e===_&&(e=st,t=l(),t!==_&&(ot=e,t=O(t)),e=t),e}function l(){var t,n,i,a,o;return t=st,40===e.charCodeAt(st)?(n=U,st++):(n=_,0===ft&&r(z)),n!==_?(i=s(),i!==_?(41===e.charCodeAt(st)?(a=j,st++):(a=_,0===ft&&r(F)),a!==_?(ot=t,n=R(i),t=n):(st=t,t=w)):(st=t,t=w)):(st=t,t=w),t===_&&(t=st,64===e.charCodeAt(st)?(n=q,st++):(n=_,0===ft&&r(G)),n!==_?(i=h(),i!==_?(58===e.charCodeAt(st)?(a=B,st++):(a=_,0===ft&&r($)),a!==_?(o=d(),o!==_?(ot=t,n=Y(i,o),t=n):(st=t,t=w)):(st=t,t=w)):(st=t,t=w)):(st=t,t=w),t===_&&(t=st,n=c(),n!==_?(58===e.charCodeAt(st)?(i=B,st++):(i=_,0===ft&&r($)),i!==_?(a=d(),a!==_?(ot=t,n=H(n,a),t=n):(st=t,t=w)):(st=t,t=w)):(st=t,t=w),t===_&&(t=st,n=p(),n!==_?(58===e.charCodeAt(st)?(i=B,st++):(i=_,0===ft&&r($)),i!==_?(a=d(),a!==_?(ot=t,n=W(n,a),t=n):(st=t,t=w)):(st=t,t=w)):(st=t,t=w),t===_&&(t=st,n=d(),n!==_&&(ot=t,n=V(n)),t=n,t===_&&(t=st,n=h(),n!==_&&(ot=t,n=X(n)),t=n))))),t}function c(){var t;return e.substr(st,4)===J?(t=J,st+=4):(t=_,0===ft&&r(K)),t===_&&(e.substr(st,6)===Z?(t=Z,st+=6):(t=_,0===ft&&r(Q)),t===_&&(e.substr(st,4)===ee?(t=ee,st+=4):(t=_,0===ft&&r(te)),t===_&&(e.substr(st,3)===ne?(t=ne,st+=3):(t=_,0===ft&&r(re)),t===_&&(e.substr(st,4)===ie?(t=ie,st+=4):(t=_,0===ft&&r(ae)),t===_&&(e.substr(st,4)===se?(t=se,st+=4):(t=_,0===ft&&r(oe)),t===_&&(e.substr(st,4)===ue?(t=ue,st+=4):(t=_,0===ft&&r(le)),t===_&&(e.substr(st,5)===ce?(t=ce,st+=5):(t=_,0===ft&&r(de)),t===_&&(e.substr(st,4)===fe?(t=fe,st+=4):(t=_,0===ft&&r(he)),t===_&&(e.substr(st,5)===pe?(t=pe,st+=5):(t=_,0===ft&&r(ge))))))))))),t}function d(){var t;return e.substr(st,9)===me?(t=me,st+=9):(t=_,0===ft&&r(ve)),t===_&&(e.substr(st,7)===ye?(t=ye,st+=7):(t=_,0===ft&&r(_e)),t===_&&(e.substr(st,5)===be?(t=be,st+=5):(t=_,0===ft&&r(xe)),t===_&&(e.substr(st,8)===we?(t=we,st+=8):(t=_,0===ft&&r(ke)),t===_&&(e.substr(st,5)===Se?(t=Se,st+=5):(t=_,0===ft&&r(Me)),t===_&&(e.substr(st,7)===Te?(t=Te,st+=7):(t=_,0===ft&&r(Ae)),t===_&&(e.substr(st,8)===Ee?(t=Ee,st+=8):(t=_,0===ft&&r(Le)),t===_&&(e.substr(st,5)===Ce?(t=Ce,st+=5):(t=_,0===ft&&r(De)),t===_&&(e.substr(st,10)===Ne?(t=Ne,st+=10):(t=_,0===ft&&r(Pe)),t===_&&(e.substr(st,9)===Ie?(t=Ie,st+=9):(t=_,0===ft&&r(Oe)),t===_&&(e.substr(st,8)===Ue?(t=Ue,st+=8):(t=_,0===ft&&r(ze)),t===_&&(e.substr(st,9)===je?(t=je,st+=9):(t=_,0===ft&&r(Fe)),t===_&&(e.substr(st,10)===Re?(t=Re,st+=10):(t=_,0===ft&&r(qe)),t===_&&(e.substr(st,10)===Ge?(t=Ge,st+=10):(t=_,0===ft&&r(Be)),t===_&&(e.substr(st,9)===$e?(t=$e,st+=9):(t=_,0===ft&&r(Ye)),t===_&&(e.substr(st,8)===He?(t=He,st+=8):(t=_,0===ft&&r(We))))))))))))))))),t}function f(){var t,n,i,a;return t=st,91===e.charCodeAt(st)?(n=A,st++):(n=_,0===ft&&r(E)),n!==_?(i=g(),i!==_?(93===e.charCodeAt(st)?(a=L,st++):(a=_,0===ft&&r(C)),a!==_?(ot=t,n=Ve(i),t=n):(st=t,t=w)):(st=t,t=w)):(st=t,t=w),t}function h(){var t,n,i;if(t=st,n=[],Xe.test(e.charAt(st))?(i=e.charAt(st),st++):(i=_,0===ft&&r(Je)),i!==_)for(;i!==_;)n.push(i),Xe.test(e.charAt(st))?(i=e.charAt(st),st++):(i=_,0===ft&&r(Je));else n=w;return n!==_&&(ot=t,n=Ke(n)),t=n}function p(){var t,n,i;if(t=st,n=[],Ze.test(e.charAt(st))?(i=e.charAt(st),st++):(i=_,0===ft&&r(Qe)),i!==_)for(;i!==_;)n.push(i),Ze.test(e.charAt(st))?(i=e.charAt(st),st++):(i=_,0===ft&&r(Qe));else n=w;return n!==_&&(ot=t,n=et(n)),t=n}function g(){var t,n,i;if(t=st,n=[],tt.test(e.charAt(st))?(i=e.charAt(st),st++):(i=_,0===ft&&r(nt)),i!==_)for(;i!==_;)n.push(i),tt.test(e.charAt(st))?(i=e.charAt(st),st++):(i=_,0===ft&&r(nt));else n=w;return n!==_&&(ot=t,n=rt(n)),t=n}function m(){var t,n;for(t=[],it.test(e.charAt(st))?(n=e.charAt(st),st++):(n=_,0===ft&&r(at));n!==_;)t.push(n),it.test(e.charAt(st))?(n=e.charAt(st),st++):(n=_,0===ft&&r(at));return t}var v,y=arguments.length>1?arguments[1]:{},_={},b={start:a},x=a,w=_,k=",",S={type:"literal",value:",",description:'","'},M=function(e,t){return[e].concat(t)},T=function(e){return[e]},A="[",E={type:"literal",value:"[",description:'"["'},L="]",C={type:"literal",value:"]",description:'"]"'},D=">",N={type:"literal",value:">",description:'">"'},P=function(e,t,n){return{start:e,end:t,middle:n}},I=function(e,t){return e.filters=t,e},O=function(e){return e},U="(",z={type:"literal",value:"(",description:'"("'},j=")",F={type:"literal",value:")",description:'")"'},R=function(e){return{stream:e}},q="@",G={type:"literal",value:"@",description:'"@"'},B=":",$={type:"literal",value:":",description:'":"'},Y=function(e,t){return{event:t,name:e}},H=function(e,t){return{event:t,mark:e}},W=function(e,t){return{event:t,target:e}},V=function(e){return{event:e}},X=function(e){return{signal:e}},J="rect",K={type:"literal",value:"rect",description:'"rect"'},Z="symbol",Q={type:"literal",value:"symbol",description:'"symbol"'},ee="path",te={type:"literal",value:"path",description:'"path"'},ne="arc",re={type:"literal",value:"arc",description:'"arc"'},ie="area",ae={type:"literal",value:"area",description:'"area"'},se="line",oe={type:"literal",value:"line",description:'"line"'},ue="rule",le={type:"literal",value:"rule",description:'"rule"'},ce="image",de={type:"literal",value:"image",description:'"image"'},fe="text",he={type:"literal",value:"text",description:'"text"'},pe="group",ge={type:"literal",value:"group",description:'"group"'},me="mousedown",ve={type:"literal",value:"mousedown",description:'"mousedown"'},ye="mouseup",_e={type:"literal",value:"mouseup",description:'"mouseup"'},be="click",xe={type:"literal",value:"click",description:'"click"'},we="dblclick",ke={type:"literal",value:"dblclick",description:'"dblclick"'},Se="wheel",Me={type:"literal",value:"wheel",description:'"wheel"'},Te="keydown",Ae={type:"literal",value:"keydown",description:'"keydown"'},Ee="keypress",Le={type:"literal",value:"keypress",description:'"keypress"'},Ce="keyup",De={type:"literal",value:"keyup",description:'"keyup"'},Ne="mousewheel",Pe={type:"literal",value:"mousewheel",description:'"mousewheel"'},Ie="mousemove",Oe={type:"literal",value:"mousemove",description:'"mousemove"'},Ue="mouseout",ze={type:"literal",value:"mouseout",description:'"mouseout"'},je="mouseover",Fe={type:"literal",value:"mouseover",description:'"mouseover"'},Re="mouseenter",qe={type:"literal",value:"mouseenter",description:'"mouseenter"'},Ge="touchstart",Be={type:"literal",value:"touchstart",description:'"touchstart"'},$e="touchmove",Ye={type:"literal",value:"touchmove",description:'"touchmove"'},He="touchend",We={type:"literal",value:"touchend",description:'"touchend"'},Ve=function(e){return e},Xe=/^[a-zA-Z0-9_\-]/,Je={type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},Ke=function(e){return e.join("")},Ze=/^[a-zA-Z0-9\-_  #.>+~[\]=|\^$*]/,Qe={type:"class",value:"[a-zA-Z0-9\\-_  #.>+~[\\]=|\\^$*]",description:"[a-zA-Z0-9\\-_  #.>+~[\\]=|\\^$*]"},et=function(e){return e.join("")},tt=/^['"a-zA-Z0-9_().><=! \t-&|~]/,nt={type:"class",value:"['\"a-zA-Z0-9_().><=! \\t-&|~]",description:"['\"a-zA-Z0-9_().><=! \\t-&|~]"},rt=function(e){return e.join("")},it=/^[ \t\r\n]/,at={type:"class",value:"[ \\t\\r\\n]",description:"[ \\t\\r\\n]"},st=0,ot=0,ut=0,lt={line:1,column:1,seenCR:!1},ct=0,dt=[],ft=0;if("startRule"in y){if(!(y.startRule in b))throw new Error("Can't start parsing from rule \""+y.startRule+'".');x=b[y.startRule]}if(v=x(),v!==_&&st===e.length)return v;throw v!==_&&st<e.length&&r({type:"end",description:"end of input"}),i(null,dt,ct)}return e(t,Error),{SyntaxError:t,parse:n}}()},{}],94:[function(e,t,n){var r=e("vega-expression"),i=["datum","event","signals"];t.exports=r.compiler(i,{idWhiteList:i,fieldVar:i[0],globalVar:i[2],functions:function(e){var t=r.functions(e);return t.eventItem=function(){return"event.vg.item"},t.eventGroup="event.vg.getGroup",t.eventX="event.vg.getX",t.eventY="event.vg.getY",t.open="window.open",t}})},{"vega-expression":43}],95:[function(e,t,n){t.exports={axes:e("./axes"),background:e("./background"),data:e("./data"),events:e("./events"),expr:e("./expr"),legends:e("./legends"),mark:e("./mark"),marks:e("./marks"),modify:e("./modify"),padding:e("./padding"),predicates:e("./predicates"),properties:e("./properties"),signals:e("./signals"),spec:e("./spec"),streams:e("./streams"),transforms:e("./transforms")}},{"./axes":90,"./background":91,"./data":92,"./events":93,"./expr":94,"./legends":96,"./mark":97,"./marks":98,"./modify":99,"./padding":100,"./predicates":101,"./properties":102,"./signals":103,"./spec":104,"./streams":105,"./transforms":106}],96:[function(e,t,n){function r(e,t,n,r){(t||[]).forEach(function(t,s){n[s]=n[s]||a(e),i(t,s,n[s],r)})}function i(e,t,n,r){n.size(e.size?r.scale(e.size):null),n.shape(e.shape?r.scale(e.shape):null),n.fill(e.fill?r.scale(e.fill):null),n.stroke(e.stroke?r.scale(e.stroke):null),e.orient&&n.orient(e.orient),null!=e.offset&&n.offset(e.offset),n.title(e.title||null),n.values(e.values||null),n.format(void 0!==e.format?e.format:null);var i=e.properties;n.titleProperties(i&&i.title||{}),n.labelProperties(i&&i.labels||{}),n.legendProperties(i&&i.legend||{}),n.symbolProperties(i&&i.symbols||{}),n.gradientProperties(i&&i.gradient||{})}var a=e("../scene/legend");t.exports=r},{"../scene/legend":114}],97:[function(e,t,n){function r(e,t){var n=t.properties,s=t.marks;return i.keys(n).forEach(function(r){n[r]=a(e,t.type,n[r])}),t.delay&&(t.delay=a(e,t.type,{delay:t.delay})),s&&(t.marks=s.map(function(t){return r(e,t)})),t}var i=e("datalib"),a=e("./properties");t.exports=r},{"./properties":102,datalib:24}],98:[function(e,t,n){function r(e,t,n,r){return{type:"group",width:n,height:r,scales:t.scales||[],axes:t.axes||[],legends:t.legends||[],marks:(t.marks||[]).map(function(t){return i(e,t)})}}var i=e("./mark");t.exports=r},{"./mark":97}],99:[function(e,t,n){function r(e,t,n){var r=t.signal?i.field(t.signal):null,s=r?r[0]:null,h=t.predicate?e.predicate(t.predicate.name||t.predicate):null,p=null===h,g=new o(e).router(t.type===c.CLEAR);return g.evaluate=function(i){if(null!==h){var s=e.values(l.DATA,h.data||d),o=e.values(l.SIGNALS,h.signals||d);p=h.call(h,{},s,o,e._predicates)}if(a.debug(i,[t.type+"ing",p]),!p)return i;var g={},m=r?e.signalRef(t.signal):null,v=e.data(n.name),y=null;if(g[t.field]=m,t.type===c.INSERT)y=u.ingest(g),i.add.push(y),v._data.push(y);else if(t.type===c.REMOVE)f(t.field,m,i.add,i.rem),f(t.field,m,i.mod,i.rem),v._data=v._data.filter(function(e){return e[t.field]!==m});else if(t.type===c.TOGGLE){var _=[],b=[];f(t.field,m,i.rem,_),f(t.field,m,i.add,b),f(t.field,m,i.mod,b),_.length||b.length||_.push(u.ingest(g)),i.add.push.apply(i.add,_),v._data.push.apply(v._data,_),i.rem.push.apply(i.rem,b),v._data=v._data.filter(function(e){return-1===b.indexOf(e)})}else t.type===c.CLEAR&&(i.rem.push.apply(i.rem,i.add),i.rem.push.apply(i.rem,i.mod),i.add=[],i.mod=[],v._data=[]);return i.fields[t.field]=1,i},s&&g.dependency(l.SIGNALS,s),h&&(g.dependency(l.DATA,h.data),g.dependency(l.SIGNALS,h.signals)),g}var i=e("datalib"),a=e("vega-logging"),s=e("vega-dataflow"),o=s.Node,u=s.Tuple,l=s.Dependencies,c={INSERT:"insert",REMOVE:"remove",TOGGLE:"toggle",CLEAR:"clear"},d=[],f=function(e,t,n,r){for(var i=n.length-1;i>=0;--i)n[i][e]==t&&r.push.apply(r,n.splice(i,1))};t.exports=r},{datalib:24,"vega-dataflow":39,"vega-logging":45}],100:[function(e,t,n){function r(e){if(null==e)return"auto";if(i.isString(e))return"strict"===e?"strict":"auto";if(i.isObject(e))return e;var t=i.isNumber(e)?e:20;return{top:t,left:t,right:t,bottom:t}}var i=e("datalib");t.exports=r},{datalib:24}],101:[function(e,t,n){function r(e,t){return(t||[]).forEach(function(t){var n=d[t.type](e,t),r=Function("args","db","signals","predicates",n.code);r.root=function(){return e.scene().items[0]},r.nullScale=f,r.isFunction=c.isFunction,r.signals=n.signals,r.data=n.data,e.predicate(t.name,r)}),t}function i(e,t){var n=c.field(e),r="signals["+n.map(c.str).join("][")+"]";return t[n[0]]=1,r}function a(e,t){function n(e){o[e]=1}function r(e){u[e]=1}var a=[],s=[],o={},u={};return c.array(t).forEach(function(t,u){var l="o"+u,d="";if(void 0!==t.value)d=c.str(t.value);else if(t.arg)d="args["+c.str(t.arg)+"]";else if(t.signal)d=i(t.signal,o);else if(t.predicate){var f=t.predicate,h=f&&(f.name||f),p=e.predicate(h),g="predicates["+c.str(h)+"]";p.signals.forEach(n),p.data.forEach(r),c.isObject(f)&&c.keys(f).forEach(function(e){if("name"!==e){var t=f[e];d+="args["+c.str(e)+"] = ",t.signal?d+=i(t.signal,o):t.arg&&(d+="args["+c.str(t.arg)+"]"),d+=", "}}),d+=g+".call("+g+", args, db, signals, predicates)"}a.push(l),s.push(l+"=("+d+")")}),{code:"var "+a.join(", ")+";\n"+s.join(";\n")+";\n",signals:c.keys(o),data:c.keys(u)}}function s(e,t){var n=a(e,t.operands);return"="===t.type&&(t.type="=="),n.code+="o0 = o0 instanceof Date ? o0.getTime() : o0;\no1 = o1 instanceof Date ? o1.getTime() : o1;\n",{code:n.code+"return "+["o0","o1"].join(t.type)+";",signals:n.signals,data:n.data}}function o(e,t){for(var n=a(e,t.operands),r=[],i=0,s=t.operands.length;r.push("o"+i++)<s;);return"and"===t.type?t.type="&&":"or"===t.type&&(t.type="||"),{code:n.code+"return "+r.join(t.type)+";",signals:n.signals,data:n.data}}function u(e,t){var n=[t.item],r="";t.range&&n.push.apply(n,t.range),t.scale&&(r=l(t.scale,n));var i=a(e,n);if(r=i.code+r+"\n  var ordSet = null;\n",t.data){var s=c.field(t.field).map(c.str);r+="var where = function(d) { return d["+s.join("][")+"] == o0 };\n",r+="return db["+c.str(t.data)+"].filter(where).length > 0;"}else t.range&&(t.scale&&(r+="if (scale.length == 2) {\n  ordSet = scale(o1, o2);\n} else {\n  o1 = scale(o1);\no2 = scale(o2);\n}"),r+="return ordSet !== null ? ordSet.indexOf(o0) !== -1 :\n  o1 < o2 ? o1 <= o0 && o0 <= o2 : o2 <= o0 && o0 <= o1;");return{code:r,signals:i.signals,data:i.data.concat(t.data?[t.data]:[])}}function l(e,t){var n="var scale = ",r=t.length;return c.isString(e)?(t.push({value:e}),n+="this.root().scale(o"+r+")"):e.arg?(t.push(e),n+="o"+r):e.name&&(t.push(c.isString(e.name)?{value:e.name}:e.name),n+="(this.isFunction(o"+r+") ? o"+r+" : ",e.scope?(t.push(e.scope),n+="((o"+(r+1)+".scale || this.root().scale)(o"+r+") || this.nullScale)"):n+="this.root().scale(o"+r+")",n+=")"),e.invert===!0&&(n+=".invert"),n+";\n"}var c=e("datalib"),d={"=":s,"==":s,"!=":s,">":s,">=":s,"<":s,"<=":s,and:o,"&&":o,or:o,"||":o,"in":u},f=function(){return 0};f.invert=f,t.exports=r},{datalib:24}],102:[function(e,t,n){(function(n){function r(e,t,n){function r(e){if(null!=m[e]){var t,n,r=f.array(m[e]);for(t=0,n=r.length;n>t;++t)x[e][r[t]]=1}}function i(e){var t=(e.parent?"parent_":"group_")+e.level;x._nRefs[t]=e}var u,l,c,m,v=e.config(),y="",_=f.keys(n),b={},x={signals:{},scales:{},data:{},fields:{},nested:[],_nRefs:{},reflow:!1};for(y+="var o = trans ? {} : item, d=0, set=this.tpl.set, tmpl=signals||{}, t;\ntmpl.datum  = item.datum;\ntmpl.group  = group;\ntmpl.parent = group.datum;\n",u=0,l=_.length;l>u;++u)m=n[c=_[u]],y+=u>0?"\n  ":"  ",m.rule?(m=s(e,c,m.rule),y+="\n  "+m.code):(m=o(v,c,m),y+="d += set(o, "+f.str(c)+", "+m.val+");"),b[c]=!0,g.forEach(r),x.reflow=x.reflow||m.reflow,m.nested.length&&m.nested.forEach(i);f.keys(x._nRefs).forEach(function(e){x.nested.push(x._nRefs[e])}),x.nested.sort(function(e,t){return e=e.level,t=t.level,t>e?-1:e>t?1:e>=t?0:NaN}),b.x2&&(b.x?(y+="\n  if (o.x > o.x2) { \n    t = o.x;\n    d += set(o, 'x', o.x2);\n    d += set(o, 'x2', t); \n  };",y+="\n  d += set(o, 'width', (o.x2 - o.x));"):y+=b.width?"\n  d += set(o, 'x', (o.x2 - o.width));":"\n  d += set(o, 'x', o.x2);"),b.xc&&(y+=b.width?"\n  d += set(o, 'x', (o.xc - o.width/2));":"\n  d += set(o, 'x', o.xc);"),b.y2&&(b.y?(y+="\n  if (o.y > o.y2) { \n    t = o.y;\n    d += set(o, 'y', o.y2);\n    d += set(o, 'y2', t);\n  };",y+="\n  d += set(o, 'height', (o.y2 - o.y));"):y+=b.height?"\n  d += set(o, 'y', (o.y2 - o.height));":"\n  d += set(o, 'y', o.y2);"),b.yc&&(y+=b.height?"\n  d += set(o, 'y', (o.yc - o.height/2));":"\n  d += set(o, 'y', o.yc);"),a(t,b)&&(y+="\n  d += (item.touch(), 1);"),y+="\n  if (trans) trans.interpolate(item, o);",y+="\n  return d > 0;";try{var w=Function("item","group","trans","db","signals","predicates",y);return w.tpl=p,w.util=f,w.d3=d,f.extend(w,f.template.context),{encode:w,signals:f.keys(x.signals),scales:f.keys(x.scales),data:f.keys(x.data),fields:f.keys(x.fields),nested:x.nested,reflow:x.reflow}}catch(k){h.error(k),h.log(y)}}function i(e,t){return f.isObject(e)||(e={reflow:!1,nested:[]},g.forEach(function(t){e[t]=[]})),f.isObject(t)&&(e.reflow=e.reflow||t.reflow,e.nested.push.apply(e.nested,t.nested),g.forEach(function(n){e[n].push.apply(e[n],t[n])})),e}function a(e,t){return t.path||("area"===e||"line"===e)&&(t.x||t.x2||t.width||t.y||t.y2||t.height||t.tension||t.interpolate)}function s(e,t,n){var r=e.config(),a=i(),s=[],u="";return(n||[]).forEach(function(l,c){var d,h=l.predicate,p=h&&(h.name||h),g=e.predicate(p),m="predicates["+f.str(p)+"]",v=[],y=t+"_arg"+c;f.isObject(h)&&f.keys(h).forEach(function(e){if("name"!==e){var t=o(r,c,h[e]);v.push(f.str(e)+": "+t.val),i(a,t)}}),d=o(r,t,l),i(a,d),p?(a.signals.push.apply(a.signals,g.signals),a.data.push.apply(a.data,g.data),s.push(y+" = {\n    "+v.join(",\n    ")+"\n  }"),u+="if ("+m+".call("+m+","+y+", db, signals, predicates)) {\n    d += set(o, "+f.str(t)+", "+d.val+");",u+=n[c+1]?"\n  } else ":"  }"):u+="{\n    d += set(o, "+f.str(t)+", "+d.val+");\n  }\n"}),u="var "+s.join(",\n      ")+";\n  "+u,a.code=u,a}function o(e,t,n){if(null==n)return null;if("fill"===t||"stroke"===t){if(n.c)return u(e,"hcl",n.h,n.c,n.l);if(n.h||n.s)return u(e,"hsl",n.h,n.s,n.l);if(n.l||n.a)return u(e,"lab",n.l,n.a,n.b);if(n.r||n.g||n.b)return u(e,"rgb",n.r,n.g,n.b)}var r=null,a=null,s=i(),o=null,d=null,h=null,p={};return void 0!==n.template&&(r=f.template.source(n.template,"tmpl",p),f.keys(p).forEach(function(e){var t=f.field(e),n=t.shift();"parent"===n||"group"===n?s.nested.push({parent:"parent"===n,group:"group"===n,level:1}):"datum"===n?s.fields.push(t[0]):s.signals.push(n)})),void 0!==n.value&&(r=f.str(n.value)),void 0!==n.signal&&(o=f.field(n.signal),r="signals["+o.map(f.str).join("][")+"]",s.signals.push(o.shift())),void 0!==n.field&&(n.field=f.isString(n.field)?{datum:n.field}:n.field,d=l(n.field),r=d.val,i(s,d)),void 0!==n.scale&&(h=c(n.scale),a=h.val,i(s,h),s.scales.push(n.scale.name||n.scale),r=null!==r||n.band||n.mult||n.offset?a+(n.band?".rangeBand()":"("+(null!==r?r:"item.datum.data")+")"):a),r="("+(n.mult?f.number(n.mult)+" * ":"")+r+")"+(n.offset?" + "+f.number(n.offset):""),s.val=r,s}function u(e,t,n,r,a){var s=n?o(e,"",n):e.color[t][0],u=r?o(e,"",r):e.color[t][1],l=a?o(e,"",a):e.color[t][2],c=i();[s,u,l].forEach(function(e){f.isArray||i(c,e)});var d="(this.d3."+t+"("+[s.val,u.val,l.val].join(",")+') + "")';return c.val=d,c}function l(e){if(f.isString(e))return{val:f.field(e).map(f.str).join("][")};var t=e.level||1,n=(e.group||e.parent)&&t,r=n?Array(t).join("group.mark."):"",a=l(e.datum||e.group||e.parent||e.signal),s=a.val,o=i(null,a);return e.datum?(s="item.datum["+s+"]",o.fields.push(e.datum)):e.group?(s=r+"group["+s+"]",o.nested.push({level:t,group:!0})):e.parent?(s=r+"group.datum["+s+"]",o.nested.push({level:t,parent:!0})):e.signal&&(s="signals["+s+"]",o.signals.push(f.field(e.signal)[0]),o.reflow=!0),o.val=s,o}function c(e){var t=null,n=null,r=i();return t=f.isString(e)?f.str(e):e.name?f.isString(e.name)?f.str(e.name):(n=l(e.name)).val:(n=l(e)).val,t="(item.mark._scaleRefs["+t+"] = 1, group.scale("+t+"))",
e.invert&&(t+=".invert"),n&&n.nested.forEach(function(e){e.scale=!0}),n?(n.val=t,n):(r.val=t,r)}var d="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,f=e("datalib"),h=e("vega-logging"),p=e("vega-dataflow").Tuple,g=["signals","scales","data","fields"];t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{datalib:24,"vega-dataflow":39,"vega-logging":45}],103:[function(e,t,n){function r(e,t){return(t||[]).forEach(function(t){if(-1!==u.indexOf(t.name))throw Error('Signal name "'+t.name+'" is a reserved keyword ('+u.join(", ")+").");var n=e.signal(t.name,t.init).verbose(t.verbose);t.init&&t.init.expr&&(t.init.expr=o(t.init.expr),n.value(i(e,t.init))),t.expr&&(t.expr=o(t.expr),n.evaluate=function(r){var a=i(e,t);return a!==n.value()||n.verbose()?(n.value(a),r.signals[t.name]=1,r):e.doNotPropagate},n.dependency(s,t.expr.globals),t.expr.globals.forEach(function(t){e.signal(t).addListener(n)}))}),t}function i(e,t){var n=t.expr,i=n.fn(null,null,e.values(s,n.globals));return t.scale?r.scale(e,t,i):i}var a=e("datalib"),s=e("vega-dataflow").Dependencies.SIGNALS,o=e("./expr"),u=["datum","event","signals"].concat(a.keys(o.codegen.functions));r.scale=function(e,t,n,r,i){var u,l=t.scale,c=l.name||l.signal||l,d=l.scope;d&&(d.signal?d=e.signalRef(d.signal):a.isString(d)&&(u=l._expr=l._expr||o(d),d=u.fn(r,i,e.values(s,u.globals)))),d&&d.scale||(d=d&&d.mark?d.mark.group:e.scene().items[0]);var f=d.scale(c);return f?l.invert?f.invert(n):f(n):n},t.exports=r},{"./expr":94,datalib:24,"vega-dataflow":39}],104:[function(e,t,n){function r(t,n){function r(t){t=i.duplicate(t);var r=e("./"),a=t.width||500,s=t.height||500,o=t.viewport||null;d.defs({width:a,height:s,viewport:o,background:r.background(t.background),padding:r.padding(t.padding),signals:r.signals(d,t.signals),predicates:r.predicates(d,t.predicates),marks:r.marks(d,t,a,s),data:r.data(d,t.data,function(){n(l(d))})})}var u=arguments[arguments.length-1],l=arguments.length>2&&i.isFunction(u)?u:o.factory,c=arguments[2]!==l?arguments[2]:{},d=new s(c);if(i.isObject(t))r(t);else if(i.isString(t)){var f=i.extend({url:t},d.config().load);i.load(f,function(e,t){if(e)a.error("LOADING SPECIFICATION FAILED: "+e.statusText);else try{r(JSON.parse(t))}catch(n){a.error("INVALID SPECIFICATION: Must be a valid JSON object. "+n)}})}else a.error("INVALID SPECIFICATION: Must be a valid JSON object or URL.")}var i=e("datalib"),a=e("vega-logging"),s=e("../core/Model"),o=e("../core/View");t.exports=r},{"../core/Model":86,"../core/View":87,"./":95,datalib:24,"vega-logging":45}],105:[function(e,t,n){(function(n){function r(e){function t(t,n){var r,a,s,o=i.mouse((i.event=t,e.renderer().scene())),u=e.padding(),l={};if(n)for(r=n.mark,a="group"===r.marktype?n:r.group,s=n;null!=s;s=s.mark.group)s.mark.def.name&&(l[s.mark.def.name]=s);l.root=e.model().scene().items[0],t.vg=Object.create(f),t.vg.group=a,t.vg.item=n||{},t.vg.name=l,t.vg.x=o[0]-u.left,t.vg.y=o[1]-u.top}function n(e,t,n,r){function i(e){return!e.fn(n,r,m.values(o,e.globals))}var a,l,c,d,f=e.handlers[t],h=e.nodes[t],p=s.ChangeSet.create(null,!0),g=!1;for(l=0,c=f.length;c>l;++l)d=f[l],g=d.filters.some(i),g||(a=d.exp.fn(n,r,m.values(o,d.exp.globals)),d.spec.scale&&(a=u.scale(m,d.spec,a,n,r)),(a!==d.signal.value()||d.signal.verbose())&&(d.signal.value(a),p.signals[d.signal.name()]=1));m.propagate(p,h)}function r(e,t,n,i){t.forEach(function(t){t.event?h(e,t,n,i):t.signal?p(e,t,n,i):t.start?g(e,t,n,i):t.stream&&r(e,t.stream,n,i)})}function h(e,t,n,r){var i=t.event,o=t.name,u=t.mark,l=t.target,d=t.filters||[],f=l?b:_,h=l?l+":"+i:i,p=f.nodes[h]||(f.nodes[h]=new s.Node(m)),g=f.handlers[h]||(f.handlers[h]=[]);o?d.push('!!event.vg.name["'+o+'"]'):u&&d.push("event.vg.item.mark && event.vg.item.mark.marktype==="+a.str(u)),g.push({signal:e,exp:n,spec:r,filters:d.map(function(e){return c(e)})}),p.addListener(e)}function p(e,t,n,r){var i=new s.Node(m);i.evaluate=function(i){if(!i.signals[t.signal])return m.doNotPropagate;var a=n.fn(null,null,m.values(o,n.globals));return r.scale&&(a=u.scale(m,r,a)),(a!==e.value()||e.verbose())&&(e.value(a),i.signals[e.name()]=1,i.reflow=!0),i},i.dependency(s.Dependencies.SIGNALS,t.signal),i.addListener(e),m.signal(t.signal).addListener(i)}function g(e,t,n,i){var a=e.name(),s=a+d,o=c("true"),u=c("false"),l=t.middle,f=l.filters||(l.filters=[]),h=m.signal(s)||m.signal(s,!1);r(h,[t.start],o,{}),r(h,[t.end],u,{}),f.push(h.name()),r(e,[t.middle],n,i)}var m=e.model(),v=m.defs().signals,y={handlers:{},nodes:{}},_=a.duplicate(y),b=a.duplicate(y);return(v||[]).forEach(function(e){var t=m.signal(e.name);e.expr||(e.streams||[]).forEach(function(e){var n=l.parse(e.type),i=c(e.expr);r(t,n,i,e)})}),a.keys(_.handlers).forEach(function(r){e.on(r,function(e,i){e.preventDefault(),t(e,i),n(_,r,i&&i.datum||{},e)})}),a.keys(b.handlers).forEach(function(e){function r(r){t(r),n(b,e,i.select(this).datum(),r)}if("undefined"!=typeof window){for(var a=b.handlers[e],s=e.split(":"),o="window"===s[0]?[window]:window.document.querySelectorAll(s[0]),u=0;u<o.length;++u)o[u].addEventListener(s[1],r);a.elements=o,a.listener=r}}),b.detach=function(){a.keys(b.handlers).forEach(function(e){for(var t=b.handlers[e],n=e.split(":"),r=t.elements||[],i=0;i<r.length;++i)r[i].removeEventListener(n[1],t.listener)})},b.detach}var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("datalib"),s=e("vega-dataflow"),o=s.Dependencies.SIGNALS,u=e("./signals"),l=e("./events"),c=e("./expr"),d="_vgGATEKEEPER",f={getGroup:function(e){return e?this.name[e]:this.group},getXY:function(e){var t={x:this.x,y:this.y};for("string"==typeof e&&(e=this.name[e]);e;e=e.mark&&e.mark.group)t.x-=e.x||0,t.y-=e.y||0;return t},getX:function(e){return this.getXY(e).x},getY:function(e){return this.getXY(e).y}};t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./events":93,"./expr":94,"./signals":103,datalib:24,"vega-dataflow":39}],106:[function(e,t,n){function r(e,t){var n=new a[t.type](e);return t.output&&n.output(t.output),i.keys(t).forEach(function(e){"type"!==e&&"output"!==e&&n.param(e,t[e])}),n}var i=e("datalib"),a=e("../transforms/index");t.exports=r},{"../transforms/index":139,datalib:24}],107:[function(e,t,n){function r(e,t){return this._mark=t,s.prototype.init.call(this,e).router(!0).reflows(!0).mutates(!0)}var i=e("datalib"),a=e("vega-dataflow"),s=a.Node,o=e("vega-logging"),u=e("vega-scenegraph").bound,l=e("./Encoder"),c=r.prototype=new s;c.evaluate=function(e){o.debug(e,["bounds",this._mark.marktype]);var t,n,r,s,c,d,f=this._mark.marktype,h="group"===f,p=this._mark.items,g=i.array(this._mark.def.legends).length>0;if(e.add.length||e.rem.length||!p.length||e.mod.length===p.length||"area"===f||"line"===f?u.mark(this._mark,null,h&&!g):e.mod.forEach(function(e){u.item(e)}),h&&g){for(t=0,n=p.length;n>t;++t)for(c=p[t],c._legendPositions=null,r=0,s=c.legendItems.length;s>r;++r)d=c.legendItems[r],l.update(this._graph,e.trans,"vg_legendPosition",d.items,e.dirty),u.mark(d,null,!1);u.mark(this._mark,null,!0)}return a.ChangeSet.create(e,!0)},t.exports=r},{"./Encoder":109,datalib:24,"vega-dataflow":39,"vega-logging":45,"vega-scenegraph":46}],108:[function(e,t,n){function r(){return arguments.length?this.init.apply(this,arguments):this}function i(){var e,t,n,r,i,a,s=this._def.from,o=s.mark;o?(t=["vg",this._parent_id,o].join("_"),n={name:t,transform:s.transform,modify:s.modify}):(e=this._graph.data(this._from),t=["vg",this._from,this._def.type,e.listeners(!0).length].join("_"),n={name:t,source:this._from,transform:s.transform,modify:s.modify}),this._from=t,this._ds=_.datasource(this._graph,n);var u;o?(r=this.sibling(o),u=new f(this._graph).addListener(this._ds.listener()),u.evaluate=function(){return r._output},r._isSuper?r.addListener(u):r._bounder.addListener(u)):(i=this._ds.source().last(),a=g.create(i),a.add=i.add,a.mod=i.mod,a.rem=i.rem,a.stamp=null,this._graph.propagate(a,this._ds.listener(),i.stamp))}function a(){var e=p.ingest(new c(this._mark));return this._def.width&&p.set(e,"width",this._def.width),this._def.height&&p.set(e,"height",this._def.height),e}function s(e,t,n,r){var i,s,u,l,c,d,f=g.create(e),h=o(this._def.key||(n?"_id":null)),m=this._mark.items||[],v=n?e.rem:m,y=p.idMap(!n||r?t:e.mod),_=[];for(i=0,u=v.length;u>i;++i)l=v[i]===m[i]?m[i]:h?this._map[h(v[i])]:v[i],l.status=b.EXIT;for(i=0,u=t.length;u>i;++i)c=t[i],l=h?this._map[s=h(t[i])]:m[i],d=l?!1:(l=a.call(this),!0),l.status=d?b.ENTER:b.UPDATE,l.datum=c,h&&(p.set(l,"key",s),this._map[s]=l),d?f.add.push(l):y[c._id]&&f.mod.push(l),_.push(l);for(i=0,u=v.length;u>i;++i)l=v[i]===m[i]?m[i]:h?this._map[s=h(v[i])]:v[i],l.status===b.EXIT&&(l._dirty=!0,e.dirty.push(l),_.push(l),f.rem.push(l),h&&(this._map[s]=null));return this._mark.items=_,f}function o(e){if(null==e)return null;var t=u.array(e).map(u.accessor);return function(e){for(var n="",r=0,i=t.length;i>r;++r)r>0&&(n+="|"),n+=String(t[r](e));return n}}var u=e("datalib"),l=e("vega-logging"),c=e("vega-scenegraph").Item,d=e("vega-dataflow"),f=d.Node,h=d.Dependencies,p=d.Tuple,g=d.ChangeSet,m={},v=e("./Encoder"),y=e("./Bounder"),_=e("../parse/data"),b=r.STATUS={ENTER:"enter",UPDATE:"update",EXIT:"exit"},x=1,w=2,k=r.prototype=new f;k.init=function(e,t,n,r,a,s){return f.prototype.init.call(this,e).router(!0).collector(!0),this._def=t,this._mark=n,this._from=(t.from?t.from.data:null)||s,this._ds=u.isString(this._from)?e.data(this._from):null,this._map={},this._status=null,n.def=t,n.marktype=t.type,n.interactive=t.interactive!==!1,n.items=[],u.isValid(t.name)&&(n.name=t.name),this._parent=r,this._parent_id=a,t.from&&(t.from.mark||t.from.transform||t.from.modify)&&i.call(this),this._isSuper="group"!==this._def.type,this._encoder=new v(this._graph,this._mark,this),this._bounder=new y(this._graph,this._mark),this._output=null,this._ds&&this._encoder.dependency(h.DATA,this._from),this.dependency(h.DATA,this._encoder.dependency(h.DATA)),this.dependency(h.SCALES,this._encoder.dependency(h.SCALES)),this.dependency(h.SIGNALS,this._encoder.dependency(h.SIGNALS)),this},k.ds=function(){return this._ds},k.parent=function(){return this._parent},k.encoder=function(){return this._encoder},k.pipeline=function(){return[this]},k.connect=function(){var e=this;return this._graph.connect(this.pipeline()),this._encoder._scales.forEach(function(t){(t=e._parent.scale(t))&&t.addListener(e)}),this._parent&&(this._isSuper?this.addListener(this._parent._collector):this._bounder.addListener(this._parent._collector)),this._status=x,this},k.disconnect=function(){function e(e){for(var n,r=0,i=e.length;i>r;++r)(n=t._parent.scale(e[r]))&&n.removeListener(t)}var t=this;return this._listeners.length?(f.prototype.disconnect.call(this),this._graph.disconnect(this.pipeline()),e(this._encoder._scales),e(u.keys(this._mark._scaleRefs)),this._status=w,this):this},k.sibling=function(e){return this._parent.child(e,this._parent_id)},k.evaluate=function(e){l.debug(e,["building",this._from||this._def.from,this._def.type]);var t,n,r,i,a,o=this,c=this._mark.def,d=c.properties||{},f=d.update||{};if(this._ds){if(t=g.create(e),i=t.data[a=this._ds.name()],delete t.data[a],n=this._encoder.reevaluate(t),t.data[a]=i,n&&(t.mod=this._mark.items.slice()),r=this._ds.last(),!r)throw Error("Builder evaluated before backing DataSource.");r.stamp>this._stamp&&(t=s.call(this,r,this._ds.values(),!0,n))}else i=u.isFunction(this._def.from)?this._def.from():[m],t=s.call(this,e,i);return this._output=t=this._graph.evaluate(t,this._encoder),f.nested&&f.nested.length&&this._status===x&&u.keys(this._mark._scaleRefs).forEach(function(e){var t=o._parent.scale(e);t&&(t.addListener(o),o.dependency(h.SCALES,e),o._encoder.dependency(h.SCALES,e))}),this._isSuper&&(t.mod=t.mod.filter(function(e){return e._dirty}),t=this._graph.evaluate(t,this._bounder)),t},t.exports=r},{"../parse/data":92,"./Bounder":107,"./Encoder":109,datalib:24,"vega-dataflow":39,"vega-logging":45,"vega-scenegraph":46}],109:[function(e,t,n){function r(e,t,n){var r=t.def.properties||{},i=r.enter,a=r.update,s=r.exit;c.prototype.init.call(this,e),this._mark=t,this._builder=n;var o=this._scales=[];return i&&o.push.apply(o,i.scales),a&&(this.dependency(d.DATA,a.data),this.dependency(d.SIGNALS,a.signals),this.dependency(d.FIELDS,a.fields),this.dependency(d.SCALES,a.scales),o.push.apply(o,a.scales)),s&&o.push.apply(o,s.scales),this.mutates(!0)}function i(e,t,n,r){var i,a,s,o=n.add.length;return(i=r.enter)&&(a=i[e]).length&&o&&(s=t.values(e,a,s=s||{})),(i=r.exit)&&(a=i[e]).length&&n.rem.length&&(s=t.values(e,a,s=s||{})),(i=r.update)&&(a=i[e]).length&&(o||n.mod.length)&&(s=t.values(e,a,s=s||{})),s||h}function a(e,t,n,r,i,a,s){var o=e.encode,u=t._dirty,l=o.call(o,t,t.mark.group||t,n,r,i,a);t._dirty=l||u,l&&!u&&s.push(t)}function s(){for(var e,t,n,r=this._mark.def.properties.update.nested,i=this._builder,a=0,s=0,o=r.length;o>s;++s)if(e=r[s],!e.scale){for(;a<e.level;++a)i=i.parent(),t=i.ds();if(n=(e.group?i.encoder():t.last())._stamp,n>this._stamp)return!0}return!1}var o=e("datalib"),u=e("vega-logging"),l=e("vega-dataflow"),c=l.Node,d=l.Dependencies,f=e("vega-scenegraph").bound,h={},p=r.prototype=new c;p.evaluate=function(t){u.debug(t,["encoding",this._mark.def.type]);var n,r,s,o,l=this._graph,c=this._mark.def.properties||{},f=this._mark.items,p=c.enter,g=c.update,m=c.exit,v=t.dirty,y=l.predicates(),_=t.request,b=this._mark.group,x=b&&(b.mark.axis||b.mark.legend),w=h,k=h;if(_&&!x){if((o=c[_])&&t.mod.length)for(w=o.data?l.values(d.DATA,o.data):null,k=o.signals?l.values(d.SIGNALS,o.signals):null,n=0,r=t.mod.length;r>n;++n)s=t.mod[n],a.call(this,o,s,t.trans,w,k,y,v);return t}for(w=i(d.DATA,l,t,c),k=i(d.SIGNALS,l,t,c),n=0,r=t.rem.length;r>n;++n)s=t.rem[n],m&&a.call(this,m,s,t.trans,w,k,y,v),t.trans&&!m?t.trans.interpolate(s,h):t.trans||f.pop();var S=e("./Builder").STATUS.UPDATE;for(n=0,r=t.add.length;r>n;++n)s=t.add[n],p&&a.call(this,p,s,t.trans,w,k,y,v),g&&a.call(this,g,s,t.trans,w,k,y,v),s.status=S;if(g)for(n=0,r=t.mod.length;r>n;++n)s=t.mod[n],a.call(this,g,s,t.trans,w,k,y,v);return t},p.reevaluate=function(e){var t=this._mark.def,n=t.properties||{},r=o.isFunction(t.from)||t.orient||e.request||c.prototype.reevaluate.call(this,e);return r||(n.update?s.call(this):!1)},r.update=function(e,t,n,r,i){r=o.array(r);var s,u,l,c,h,p=e.predicates(),g=e.values(d.DATA),m=e.values(d.SIGNALS);for(s=0,u=r.length;u>s;++s)l=r[s],c=l.mark.def.properties,h=c&&c[n],h&&(a.call(null,h,l,t,g,m,p,i),f.item(l))},t.exports=r},{"./Builder":108,datalib:24,"vega-dataflow":39,"vega-logging":45,"vega-scenegraph":46}],110:[function(e,t,n){function r(){return this._children={},this._scaler=null,this._recursor=null,this._scales={},this.scale=a.bind(this),arguments.length?this.init.apply(this,arguments):this}function i(e){function t(e){e.type!=b.MARK||e.inline||void 0===m._graph.data(e.from)||m._recursor.removeListener(e.builder)}function n(t){var n=t.scale();e.scales[n.scaleName]&&t.reset().def()}function r(t){var n=t.size()||t.shape()||t.fill()||t.stroke();e.scales[n.scaleName]&&t.reset().def()}function i(e){m._recursor.removeListener(e.builder),e.builder.disconnect()}var a,s,d,f,h,p,g,m=this,v=c.array(this._def.marks).length>0,y=c.array(this._def.axes).length>0,_=c.array(this._def.legends).length>0,x=!1;for(a=0,f=e.add.length;f>a;++a)h=e.add[a],v&&o.call(this,e,h),y&&u.call(this,e,h),_&&l.call(this,e,h);for(a=e.add.length-1;a>=0;--a)for(h=e.add[a],s=this._children[h._id].length-1;s>=0;--s)d=this._children[h._id][s],d.builder.connect(),p=d.builder.pipeline(),g=d.builder._def,x=g.type!==b.GROUP,x=x&&void 0!==this._graph.data(d.from),x=x&&1===p[p.length-1].listeners().length,x=x&&g.from&&!g.from.mark,d.inline=x,x?this._graph.evaluate(e,d.builder):this._recursor.addListener(d.builder);for(a=0,f=e.mod.length;f>a;++a)h=e.mod[a],v&&m._children[h._id].forEach(t),y&&h.axes.forEach(n),_&&h.legends.forEach(r);for(a=0,f=e.rem.length;f>a;++a)h=e.rem[a],m._children[h._id].forEach(i),delete m._children[h._id];return e}function a(e,t){var n=this,r=null;if(2===arguments.length)return n._scales[e]=t,t;for(;null==r&&(r=n._scales[e],n=n.mark?n.mark.group:n._parent););return r}function s(e,t){g.debug(e,["building group",t._id]),t._scales=t._scales||{},t.scale=a.bind(t),t.items=t.items||[],this._children[t._id]=this._children[t._id]||[],t.axes=t.axes||[],t.axisItems=t.axisItems||[],t.legends=t.legends||[],t.legendItems=t.legendItems||[]}function o(e,t){g.debug(e,["building children marks #"+t._id]);var n,i,a,s,o,u,l=this._def.marks;for(s=0,o=l.length;o>s;++s)n=l[s],i=n.from||{},a=t.datum._facetID,t.items[s]={group:t,_scaleRefs:{}},u=n.type===b.GROUP?new r:new m,u.init(this._graph,n,t.items[s],this,t._id,a),this._children[t._id].push({builder:u,from:i.data||(i.mark?"vg_"+t._id+"_"+i.mark:a),type:b.MARK})}function u(e,t){var n=t.axes,i=t.axisItems,a=this;y(this._graph,this._def.axes,n,t),n.forEach(function(e,n){var s=a._def.axes[n].scale,o=e.def(),u=null;i[n]={group:t,axis:!0,layer:o.layer},u=o.type===b.GROUP?new r:new m,u.init(a._graph,o,i[n],a).dependency(h.SCALES,s),a._children[t._id].push({builder:u,type:b.AXIS,scale:s})})}function l(e,t){var n=t.legends,i=t.legendItems,a=this;_(this._graph,this._def.legends,n,t),n.forEach(function(e,n){var s=e.size()||e.shape()||e.fill()||e.stroke(),o=e.def(),u=null;i[n]={group:t,legend:!0},u=o.type===b.GROUP?new r:new m,u.init(a._graph,o,i[n],a).dependency(h.SCALES,s),a._children[t._id].push({builder:u,type:b.LEGEND,scale:s})})}var c=e("datalib"),d=e("vega-dataflow"),f=d.Node,h=d.Dependencies,p=d.Collector,g=e("vega-logging"),m=e("./Builder"),v=e("./Scale"),y=e("../parse/axes"),_=e("../parse/legends"),b=r.TYPES={GROUP:"group",MARK:"mark",AXIS:"axis",LEGEND:"legend"},x=r.prototype=new m;x.init=function(e,t){var n,r=this;this._scaler=new f(e),(t.scales||[]).forEach(function(t){t=r.scale(n=t.name,new v(e,t,r)),r.scale(n+":prev",t),r._scaler.addListener(t)}),this._recursor=new f(e),this._recursor.evaluate=i.bind(this);var a=(t.axes||[]).reduce(function(e,t){return e[t.scale]=1,e},{});return a=(t.legends||[]).reduce(function(e,t){return e[t.size||t.shape||t.fill||t.stroke],e},a),this._recursor.dependency(h.SCALES,c.keys(a)),this._collector=new p(e),m.prototype.init.apply(this,arguments)},x.evaluate=function(){var e=m.prototype.evaluate.apply(this,arguments),t=this;return e.add.forEach(function(n){s.call(t,e,n)}),e},x.pipeline=function(){return[this,this._scaler,this._recursor,this._collector,this._bounder]},x.disconnect=function(){var e=this;return c.keys(e._children).forEach(function(t){e._children[t].forEach(function(t){e._recursor.removeListener(t.builder),t.builder.disconnect()})}),e._children={},m.prototype.disconnect.call(this)},x.child=function(e,t){for(var n,r=this._children[t],i=0,a=r.length;a>i&&(n=r[i],n.type!=b.MARK||n.builder._def.name!=e);++i);return n.builder},t.exports=r},{"../parse/axes":90,"../parse/legends":96,"./Builder":108,"./Scale":111,datalib:24,"vega-dataflow":39,"vega-logging":45}],111:[function(e,t,n){(function(n){function r(e,t,n){return this._def=t,this._parent=n,this._updated=!1,w.prototype.init.call(this,e).reflows(!0)}function i(e){var t=this._def.name,n=t+":prev",r=a.call(this,e.scale(t)),i=r.type===T.ORDINAL?s:o,u=v.call(this,e);return i.call(this,r,u,e),e.scale(t,r),e.scale(n,e.scale(n)||r),r}function a(e){var t=this._graph.config(),n=this._def.type||T.LINEAR;if(!e||n!==e.type){var r=t.scale[n]||y.scale[n];if(!r)throw Error("Unrecognized scale type: "+n);(e=r()).type=e.type||n,e.scaleName=this._def.name,e._prev={}}return e}function s(e,t,n){var r,i,a=this._def,s=e._prev,o=!1,u=g.call(this,a.padding)||0,l=null==a.outerPadding?u:g.call(this,a.outerPadding),c=a.points&&g.call(this,a.points),d=g.call(this,a.round)||null==a.round;if(_.isObject(a.range)&&!_.isArray(a.range)&&(o=!0,t=p.call(this,A.RANGE,a.range,e,n)),r=p.call(this,A.DOMAIN,a.domain,e,n),r&&!_.equal(s.domain,r)&&(e.domain(r),s.domain=r,this._updated=!0),!_.equal(s.range,t)){if(a.bandWidth){var f,h=g.call(this,a.bandWidth),m=r.length,v=a.points?u*h:u*h*(m-1)+2*l;t[0]>t[1]?(f=t[1]||0,t=[f+(h*m+v),f]):(f=t[0]||0,t=[f,f+(h*m+v)])}i="string"==typeof t[0],i||t.length>2||1===t.length||o?e.range(t):c&&d?e.rangeRoundPoints(t,u):c?e.rangePoints(t,u):d?e.rangeRoundBands(t,u,l):e.rangeBands(t,u,l),e.invert||(e.invert=function(t,n){if(1===arguments.length)return e.domain()[y.bisect(e.range(),t)-1];if(2===arguments.length){if(!_.isNumber(t)||!_.isNumber(n))throw Error("Extents to ordinal invert are not numbers ("+t+", "+n+").");for(var r,i=[],a=e.range(),s=0,o=a.length;o>s;++s)r=a[s],(n>t?r>=t&&n>=r:r>=n&&t>=r)&&i.push(r);return i.map(function(t){return e.invert(t)})}}),s.range=t,this._updated=!0}}function o(e,t,n){var r,i,a=this._def,s=e._prev,o=g.call(this,a.round),u=g.call(this,a.exponent),l=g.call(this,a.clamp),c=g.call(this,a.nice);r=a.type===T.QUANTILE?p.call(this,A.DOMAIN,a.domain,e,n):m.call(this,e,n),r&&!_.equal(s.domain,r)&&(e.domain(r),s.domain=r,this._updated=!0),"height"===g.call(this,a.range)&&(t=t.reverse()),_.equal(s.range,t)||(e[o&&e.rangeRound?"rangeRound":"range"](t),s.range=t,this._updated=!0,this._stamp>0||(u&&a.type===T.POWER&&e.exponent(u),l&&e.clamp(!0),c&&(a.type===T.TIME?(i=y.time[c],i||x.error("Unrecognized interval: "+i),e.nice(i)):e.nice())))}function u(e){return e.type===T.ORDINAL||e.type===T.QUANTILE}function l(e){return e.fields||_.array(e)}function c(e){return e.some(function(e){return e.data?e.data&&_.array(e.field).some(function(e){return e.parent}):!0})}function d(e,t){return _.array(e.field).map(function(e){return e.parent?_.accessor(e.parent)(t.datum):e})}function f(e,t){var n=l(e);return 1==n.length&&1==_.array(n[0].field).length?S.TYPES.TUPLE:u(t)&&e.sort?S.TYPES.MULTI:S.TYPES.VALUE}function h(e,t,n,r){var i=l(t),a=c(i),s=f(t,n),o=u(n),h=t.sort,p="_"+e,g=d(i[0],r);if(n[p]||this[p])return n[p]||this[p];var m,v,y=new S(this._graph).type(s);return a?n[p]=y:this[p]=y,o?s===S.TYPES.VALUE?(m=[{name:A.GROUPBY,get:_.identity}],v={"*":A.COUNT}):s===S.TYPES.TUPLE?(m=[{name:A.GROUPBY,get:_.$(g[0])}],v=h?[{field:A.VALUE,get:_.$(h.field),ops:[h.op]}]:{"*":A.COUNT}):(m=A.GROUPBY,v=[{field:A.VALUE,ops:[h.op]}]):(m=[],v=[{field:A.VALUE,get:s==S.TYPES.TUPLE?_.$(g[0]):_.identity,ops:[A.MIN,A.MAX],as:[A.MIN,A.MAX]}]),y.param("groupby",m).param("summarize",v),y._lastUpdate=-1,y}function p(e,t,n,r){function i(e){M.dependency(k.SIGNALS,e)}if(null==t)return[];if(_.isArray(t))return t.map(g.bind(this));var a,s,o,p,m,v,y,b,x,w,M=this,T=this._graph,E=l(t),L=c(E),C=f(t,n),D=h.apply(this,arguments),N=t.sort,P=u(n);if(L||!L&&D._lastUpdate<this._stamp){for(a=0,s=E.length;s>a;++a)if(m=E[a],x=m.data||r.datum._facetID,b=T.data(x).last(),!(b.stamp<=this._stamp)){for(v=d(m,r),o=0,p=v.length;p>o;++o)y=v[o],C===S.TYPES.VALUE?D.accessors(null,y):C===S.TYPES.MULTI&&D.accessors(y,m.sort||N.field),D.evaluate(b);this.dependency(k.DATA,x),D.dependency(k.SIGNALS).forEach(i)}D._lastUpdate=this._stamp,b=D.aggr().result(),P?(N&&(w=N.order.signal?T.signalRef(N.order.signal):N.order,w=(w==A.DESC?"-":"+")+N.op+"_"+A.VALUE,w=_.comparator(w),b=b.sort(w)),D._values=b.map(function(e){return e[A.GROUPBY]})):(b=b[0],D._values=_.isValid(b)?[b[A.MIN],b[A.MAX]]:[])}return D._values}function g(e){if(!e||!e.signal)return e;var t,n=e.signal;return this.dependency(k.SIGNALS,(t=_.field(n))[0]),this._graph.signalRef(t)}function m(e,t){var n,r=this._def,i=[null,null];return void 0!==r.domain&&(i=_.isObject(r.domain)?p.call(this,A.DOMAIN,r.domain,e,t):i),n=i.length-1,void 0!==r.domainMin&&(_.isObject(r.domainMin)?r.domainMin.signal?i[0]=g.call(this,r.domainMin):i[0]=p.call(this,A.DOMAIN+A.MIN,r.domainMin,e,t)[0]:i[0]=r.domainMin),void 0!==r.domainMax&&(_.isObject(r.domainMax)?r.domainMax.signal?i[n]=g.call(this,r.domainMax):i[n]=p.call(this,A.DOMAIN+A.MAX,r.domainMax,e,t)[1]:i[n]=r.domainMax),r.type===T.LOG||r.type===T.TIME||!r.zero&&void 0!==r.zero||(i[0]=Math.min(0,i[0]),i[n]=Math.max(0,i[n])),i}function v(e){var t=this._def,n=this._graph.config(),r=g.call(this,t.range),i=[null,null];if(void 0!==r)if("string"==typeof r)if(M[r])i=[0,e[r]];else{if(!n.range[r])return x.error("Unrecogized range: "+r),i;i=n.range[r]}else if(_.isArray(r))i=_.duplicate(r).map(g.bind(this));else{if(_.isObject(r))return null;i=[0,r]}if(void 0!==t.rangeMin&&(i[0]=t.rangeMin.signal?g.call(this,t.rangeMin):t.rangeMin),void 0!==t.rangeMax&&(i[i.length-1]=t.rangeMax.signal?g.call(this,t.rangeMax):t.rangeMax),void 0!==t.reverse){var a=g.call(this,t.reverse);_.isObject(a)&&(a=_.accessor(a.field)(e.datum)),a&&(i=i.reverse())}return i}var y="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,_=e("datalib"),b=e("vega-dataflow"),x=e("vega-logging"),w=b.Node,k=b.Dependencies,S=e("../transforms/Aggregate"),M={width:1,height:1},T={LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",SQRT:"sqrt",TIME:"time",TIME_UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold"},A={DOMAIN:"domain",RANGE:"range",COUNT:"count",GROUPBY:"groupby",MIN:"min",MAX:"max",VALUE:"value",ASC:"asc",DESC:"desc"},E=r.prototype=new w;E.evaluate=function(e){var t=this,n=function(e){i.call(t,e)};return this._updated=!1,e.add.forEach(n),e.mod.forEach(n),this._updated&&(e.scales[this._def.name]=1,x.debug(e,["scale",this._def.name])),b.ChangeSet.create(e,!0)},E.dependency=function(e,t){if(2==arguments.length){var n=e===k.DATA?"data":"signal";t=_.array(t);for(var r=0,i=t.length;i>r;++r)this._graph[n](t[r]).addListener(this._parent)}return w.prototype.dependency.call(this,e,t)},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../transforms/Aggregate":116,datalib:24,"vega-dataflow":39,"vega-logging":45}],112:[function(e,t,n){(function(n){function r(e,t){this.duration=e||500,this.ease=t&&a.ease(t)||a.ease("cubic-in-out"),this.updates={next:null}}function i(e){for(var t,n,r,i,a,o,l=this.updates,c=l,d=c.next,f=this.duration,h=!0;null!=d;c=d,d=c.next)if(t=d.item,n=t.delay||0,r=(e-n)/f,0>r)h=!1;else{for(r>1&&(r=1),i=d.ease(r),a=0,o=d.length;o>a;++a)t[d[a].property]=d[a](i);t.touch(),s.item(t),1===r?(d.remove&&(t.status=u.EXIT,t.remove()),c.next=d.next,d=c):h=!1}return this.callback(),h}var a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=e("vega-scenegraph").bound,o=e("vega-dataflow").Tuple,u=e("./Builder").STATUS,l=r.prototype,c={text:1,url:1};l.interpolate=function(e,t){var n,r,i,s,l=null;for(n in t)r=e[n],i=t[n],r!==i&&(c[n]||void 0===r?o.set(e,n,i):"number"!=typeof r||isFinite(r)?(s=a.interpolate(r,i),s.property=n,(l||(l=[])).push(s)):o.set(e,n,i));return null===l&&e.status===u.EXIT&&(l=[]),null!=l&&(l.item=e,l.ease=e.mark.ease||this.ease,l.next=this.updates.next,this.updates.next=l),this},l.start=function(e){for(var t=this,n=t.updates,r=n.next;null!=r;n=r,r=n.next)r.item.status===u.EXIT&&(r.item.status=u.UPDATE,r.remove=!0);t.callback=e,a.timer(function(e){return i.call(t,e)})},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Builder":108,"vega-dataflow":39,"vega-scenegraph":46}],113:[function(e,t,n){function r(e){function t(){P.type=null}function n(e){return{data:e}}function r(){var e=B||a();return M(e,G)}function a(){switch(E.type){case _:return _;case b:return b;case w:return x;default:return k}}function v(e,t,n){function r(t){return(e[0]<0?-Math.log(t>0?0:-t):Math.log(0>t?0:t))/Math.log(s)}function i(t){return e[0]<0?-Math.pow(s,-t):Math.pow(s,t)}if(null==t)return n;var a,s=E.base(),o=Math.min(s,E.ticks().length/t),u=e[0]>0?(a=1e-12,Math.ceil):(a=-1e-12,Math.floor);return function(e){return i(u(r(e)+a))/e>=o?n(e):""}}function M(e,t){var n,r,i=m.format,a="log"===E.type;switch(e){case k:return n=E.domain(),r=i.auto.number(n,Y,t||(a?".1r":null)),a?v(n,Y,r):r;case _:return(t?i:i.auto).time(t);case b:return(t?i:i.auto).utc(t);default:return String}}function T(e){var t=q||(E.ticks?E.ticks(Y):E.domain()),r=i(E,t,$).map(n);return t=t.map(function(t){return t=n(t),t.label=e(t.data),t}),[t,r]}function A(t){var n,r,i;t.type===w?(n={scale:t.scaleName,offset:.5+t.rangeBand()/2},r=n):(n={scale:t.scaleName,offset:.5},r={scale:t.scaleName+":prev",offset:.5}),i=s(t),m.extend(Z.gridLines,f(L)),m.extend(Z.majorTicks,f(L)),m.extend(Z.minorTicks,f(L)),m.extend(Z.tickLabels,h(L)),m.extend(Z.domain,g(L)),m.extend(Z.title,p(L)),Z.gridLines.properties.enter.stroke={value:L.axis.gridColor},Z.gridLines.properties.enter.strokeOpacity={value:L.axis.gridOpacity},u(C,Z.gridLines,r,n,1/0),u(C,Z.majorTicks,r,n,z),u(C,Z.minorTicks,r,n,j),o(C,Z.tickLabels,r,n,z,R),c(C,Z.domain,i,F),l(C,Z.title,i,N),m.extend(Z.gridLines.properties.update,H),m.extend(Z.majorTicks.properties.update,V),m.extend(Z.minorTicks.properties.update,X),m.extend(Z.tickLabels.properties.update,W),m.extend(Z.domain.properties.update,K),m.extend(Z.title.properties.update,J);var a=[Z.gridLines,Z.majorTicks,Z.minorTicks,Z.tickLabels,Z.domain,Z.title];m.extend(P,{type:"group",interactive:!1,properties:{enter:{encode:d,scales:[t.scaleName],signals:[],data:[]},update:{encode:d,scales:[t.scaleName],signals:[],data:[]}}}),P.marks=a.map(function(t){return y(e,t)})}var E,L=e.config(),C=L.axis.orient,D=0,N=L.axis.titleOffset,P={},I="front",O=!1,U=null,z=L.axis.tickSize,j=L.axis.tickSize,F=L.axis.tickSize,R=L.axis.padding,q=null,G=null,B=null,$=0,Y=L.axis.ticks,H={},W={},V={},X={},J={},K={},Z={gridLines:{},majorTicks:{},minorTicks:{},tickLabels:{},domain:{},title:{}},Q={};return Q.def=function(){P.type||A(E);var e=T(r()),t=U?[U].map(n):[];return P.marks[0].from=function(){return O?e[0]:[]},P.marks[1].from=function(){return e[0]},P.marks[2].from=function(){return e[1]},P.marks[3].from=P.marks[1].from,P.marks[4].from=function(){return[1]},P.marks[5].from=function(){return t},P.offset=D,P.orient=C,P.layer=I,P},Q.scale=function(e){return arguments.length?(E!==e&&(E=e,t()),Q):E},Q.orient=function(e){return arguments.length?(C!==e&&(C=e in S?e+"":L.axis.orient,t()),Q):C},Q.title=function(e){return arguments.length?(U!==e&&(U=e,t()),Q):U},Q.tickCount=function(e){return arguments.length?(Y=e,Q):Y},Q.tickValues=function(e){return arguments.length?(q=e,Q):q},Q.tickFormat=function(e){return arguments.length?(G!==e&&(G=e,t()),Q):G},Q.tickFormatType=function(e){return arguments.length?(B!==e&&(B=e,t()),Q):B},Q.tickSize=function(e,n){if(!arguments.length)return z;var r=arguments.length-1,i=+e,a=r>1?+n:z,s=r>0?+arguments[r]:z;return(z!==i||j!==a||F!==s)&&t(),z=i,j=a,F=s,Q},Q.tickSubdivide=function(e){return arguments.length?($=+e,Q):$},Q.offset=function(e){return arguments.length?(D=m.isObject(e)?e:+e,Q):D},Q.tickPadding=function(e){return arguments.length?(R!==+e&&(R=+e,t()),Q):R},Q.titleOffset=function(e){return arguments.length?(N!==+e&&(N=+e,t()),Q):N},Q.layer=function(e){return arguments.length?(I!==e&&(I=e,t()),Q):I},Q.grid=function(e){return arguments.length?(O!==e&&(O=e,t()),Q):O},Q.gridLineProperties=function(e){return arguments.length?(H!==e&&(H=e),Q):H},Q.majorTickProperties=function(e){return arguments.length?(V!==e&&(V=e),Q):V},Q.minorTickProperties=function(e){return arguments.length?(X!==e&&(X=e),Q):X},Q.tickLabelProperties=function(e){return arguments.length?(W!==e&&(W=e),Q):W},Q.titleProperties=function(e){return arguments.length?(J!==e&&(J=e),Q):J},Q.domainProperties=function(e){return arguments.length?(K!==e&&(K=e),Q):K},Q.reset=function(){return t(),Q},Q}function i(e,t,n){var r=[];if(n&&t.length>1){for(var i,s,o=a(e.domain()),u=-1,l=t.length,c=(t[1]-t[0])/++n;++u<l;)for(i=n;--i>0;)(s=+t[u]-i*c)>=o[0]&&r.push(s);for(--u,i=0;++i<n&&(s=+t[u]+i*c)<o[1];)r.push(s)}return r}function a(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function s(e){return e.rangeExtent?e.rangeExtent():a(e.range())}function o(e,t,n,r,i,a){i=Math.max(i,0)+a,("left"===e||"top"===e)&&(i*=-1),"top"===e||"bottom"===e?(m.extend(t.properties.enter,{x:n,y:{value:i}}),m.extend(t.properties.update,{x:r,y:{value:i},align:{value:"center"
},baseline:{value:T[e]}})):(m.extend(t.properties.enter,{x:{value:i},y:n}),m.extend(t.properties.update,{x:{value:i},y:r,align:{value:M[e]},baseline:{value:"middle"}}))}function u(e,t,n,r,i){var a="left"===e||"top"===e?-1:1;i=i===1/0?"top"===e||"bottom"===e?{field:{group:"height",level:2},mult:-a}:{field:{group:"width",level:2},mult:-a}:{value:a*i},"top"===e||"bottom"===e?(m.extend(t.properties.enter,{x:n,y:{value:0},y2:i}),m.extend(t.properties.update,{x:r,y:{value:0},y2:i}),m.extend(t.properties.exit,{x:r})):(m.extend(t.properties.enter,{x:{value:0},x2:i,y:n}),m.extend(t.properties.update,{x:{value:0},x2:i,y:r}),m.extend(t.properties.exit,{y:r}))}function l(e,t,n,r){var i=~~((n[0]+n[1])/2),a="top"===e||"left"===e?-1:1;"bottom"===e||"top"===e?m.extend(t.properties.update,{x:{value:i},y:{value:a*r},angle:{value:0}}):m.extend(t.properties.update,{x:{value:a*r},y:{value:i},angle:{value:"left"===e?-90:90}})}function c(e,t,n,r){var i;("top"===e||"left"===e)&&(r=-1*r),i="bottom"===e||"top"===e?"M"+n[0]+","+r+"V0H"+n[1]+"V"+r:"M"+r+","+n[0]+"H0V"+n[1]+"H"+r,t.properties.update.path={value:i}}function d(e,t,n){var r=n?{}:e,i=e.mark.def.offset,a=e.mark.def.orient,s=t.width,o=t.height;if(m.isArray(i)){var u=i[0],l=i[1];switch(a){case"left":v.set(r,"x",-u),v.set(r,"y",l);break;case"right":v.set(r,"x",s+u),v.set(r,"y",l);break;case"bottom":v.set(r,"x",u),v.set(r,"y",o+l);break;case"top":v.set(r,"x",u),v.set(r,"y",-l);break;default:v.set(r,"x",u),v.set(r,"y",l)}}else switch(m.isObject(i)&&(i=-t.scale(i.scale)(i.value)),a){case"left":v.set(r,"x",-i),v.set(r,"y",0);break;case"right":v.set(r,"x",s+i),v.set(r,"y",0);break;case"bottom":v.set(r,"x",0),v.set(r,"y",o+i);break;case"top":v.set(r,"x",0),v.set(r,"y",-i);break;default:v.set(r,"x",0),v.set(r,"y",0)}return n&&n.interpolate(e,r),!0}function f(e){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:e.axis.tickColor},strokeWidth:{value:e.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function h(e){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:e.axis.tickLabelColor},font:{value:e.axis.tickLabelFont},fontSize:{value:e.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function p(e){return{type:"text",interactive:!0,properties:{enter:{font:{value:e.axis.titleFont},fontSize:{value:e.axis.titleFontSize},fontWeight:{value:e.axis.titleFontWeight},fill:{value:e.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function g(e){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:e.axis.axisColor},strokeWidth:{value:e.axis.axisWidth}},update:{}}}}var m=e("datalib"),v=e("vega-dataflow").Tuple,y=e("../parse/mark"),_="time",b="utc",x="string",w="ordinal",k="number",S={top:1,right:1,bottom:1,left:1},M={bottom:"center",top:"center",left:"right",right:"left"},T={bottom:"top",top:"bottom",left:"middle",right:"middle"};t.exports=r},{"../parse/mark":97,datalib:24,"vega-dataflow":39}],114:[function(e,t,n){(function(n){function r(e){function t(){G.type=null}function n(e,t){return{data:e,index:t}}function r(e){return"ordinal"===e||"quantize"===e||"quantile"===e||"threshold"===e}function v(e){var t,r,i,a=y(w,k,S,M),s=(null==A?e.ticks?e.ticks.apply(e,I):e.domain():A).map(n),o=null==E?e.tickFormat?e.tickFormat.apply(e,I):String:E,u=5,l=d.range(s.length);w?(r=s.map(function(e){return Math.sqrt(w(e.data))}),i=d.max(r),r=r.reduce(function(e,t,n,r){return n>0&&(e[n]=e[n-1]+r[n-1]/2+u),e[n]+=t/2,e},[0]).map(Math.round)):(i=Math.round(Math.sqrt(C.legend.symbolSize)),r=T||(t=F.fontSize)&&t.value+u||C.legend.labelFontSize+u,r=l.map(function(e,t){return Math.round(i/2+t*r)}));var c,f=P;x&&(c=j.fontSize,f+=5+(c&&c.value||C.legend.titleFontSize));for(var h=0,p=r.length;p>h;++h)r[h]+=f;var g={name:"legend",type:"ordinal",points:!0,domain:l,range:r},m=(x?[x]:[]).map(n);return s.forEach(function(e){e.label=o(e.data),e.offset=i}),a.scales=[g],a.marks[0].from=function(){return m},a.marks[1].from=function(){return s},a.marks[2].from=a.marks[1].from,a}function y(t,n,r,l){var c=f.extend(R.titles,s(C)),d=f.extend(R.symbols,o(C)),h=f.extend(R.labels,u(C));return a(d,t,n,r,l),f.extend(c.properties.update,j),f.extend(d.properties.update,U),f.extend(h.properties.update,F),c.properties.enter.x.value+=P,c.properties.enter.y.value+=P,h.properties.enter.x.offset+=P+1,d.properties.enter.x.offset=P+1,h.properties.update.x.offset+=P+1,d.properties.update.x.offset=P+1,f.extend(G,{type:"group",interactive:!1,properties:{enter:p(e,"group",O),vg_legendPosition:{encode:i,signals:[],scales:[],data:[],fields:[]}}}),G.marks=[c,d,h].map(function(t){return g(e,t)}),G}function _(e){var t=b(e),r=e.domain(),i=(null==A?e.ticks?e.ticks.apply(e,I):e.domain():A).map(n),a=z.width&&z.width.value||C.legend.gradientWidth,s=null==E?e.tickFormat?e.tickFormat.apply(e,I):String:E,o={name:"legend",type:e.type,round:!0,zero:!1,domain:[r[0],r[r.length-1]],range:[P,a+P]};"pow"===e.type&&(o.exponent=e.exponent());var u=(x?[x]:[]).map(n);return i.forEach(function(e,t){e.label=s(e.data),e.align=t==i.length-1?"right":0===t?"left":"center"}),t.scales=[o],t.marks[0].from=function(){return u},t.marks[1].from=function(){return[1]},t.marks[2].from=function(){return i},t}function b(t){var n=f.extend(R.titles,s(C)),r=f.extend(R.gradient,l(C)),a=f.extend(R.labels,c(C)),o=new h,u=t.domain(),d=u[0],m=u[u.length-1],v=t.copy().domain([d,m]).range([0,1]),y="linear"!==t.type&&t.ticks?t.ticks.call(t,15):u;d!==y[0]&&y.unshift(d),m!==y[y.length-1]&&y.push(m);for(var _=0,b=y.length;b>_;++_)o.stop(v(y[_]),t(y[_]));r.properties.enter.fill={value:o},f.extend(n.properties.update,j),f.extend(r.properties.update,z),f.extend(a.properties.update,F);var w=r.properties,k=z.height,S=k&&k.value||w.enter.height.value;if(a.properties.enter.y.value=S,a.properties.update.y.value=S,x){var M=n.properties,T=j.fontSize,A=4+(T&&T.value||M.enter.fontSize.value);r.properties.enter.y.value+=A,a.properties.enter.y.value+=A,r.properties.update.y.value+=A,a.properties.update.y.value+=A}return n.properties.enter.x.value+=P,n.properties.enter.y.value+=P,r.properties.enter.x.value+=P,r.properties.enter.y.value+=P,a.properties.enter.y.value+=P,r.properties.update.x.value+=P,r.properties.update.y.value+=P,a.properties.update.y.value+=P,f.extend(G,{type:"group",interactive:!1,properties:{enter:p(e,"group",O),vg_legendPosition:{encode:i,signals:[],scales:[],data:[],fields:[]}}}),G.marks=[n,r,a].map(function(t){return g(e,t)}),G}var x,w=null,k=null,S=null,M=null,T=null,A=null,E=null,L=null,C=e.config(),D="right",N=C.legend.offset,P=C.legend.padding,I=[5],O={},U={},z={},j={},F={},R={titles:{},symbols:{},labels:{},gradient:{}},q={},G={};return q.def=function(){var e=w||k||S||M;return E=L?"time"===e.type?f.format.time(L):f.format.number(L):null,G.type||(G=e!==S&&e!==M||r(e.type)?v(e):_(e)),G.orient=D,G.offset=N,G.padding=P,G},q.size=function(e){return arguments.length?(w!==e&&(w=e,t()),q):w},q.shape=function(e){return arguments.length?(k!==e&&(k=e,t()),q):k},q.fill=function(e){return arguments.length?(S!==e&&(S=e,t()),q):S},q.stroke=function(e){return arguments.length?(M!==e&&(M=e,t()),q):M},q.title=function(e){return arguments.length?(x!==e&&(x=e,t()),q):x},q.format=function(e){return arguments.length?(L!==e&&(L=e,t()),q):L},q.spacing=function(e){return arguments.length?(T!==+e&&(T=+e,t()),q):T},q.orient=function(e){return arguments.length?(D=e in m?e+"":C.legend.orient,q):D},q.offset=function(e){return arguments.length?(N=+e,q):N},q.values=function(e){return arguments.length?(A=e,q):A},q.legendProperties=function(e){return arguments.length?(O=e,q):O},q.symbolProperties=function(e){return arguments.length?(U=e,q):U},q.gradientProperties=function(e){return arguments.length?(z=e,q):z},q.labelProperties=function(e){return arguments.length?(F=e,q):F},q.titleProperties=function(e){return arguments.length?(j=e,q):j},q.reset=function(){return t(),q},q}function i(e,t,n,r,i,a){var s,o=n?{}:e,u=e.mark.def.offset,l=e.mark.def.orient,c=2*e.mark.def.padding,d=~~e.bounds.width()+(e.width?0:c),f=~~e.bounds.height()+(e.height?0:c),h=t._legendPositions||(t._legendPositions={right:.5,left:.5});switch(o.x=.5,o.width=d,o.y=h[l],h[l]+=o.height=f,!n&&t.bounds&&(t.bounds.delta=t.bounds.x2-t.width),l){case"left":s=t.bounds?t.bounds.x1:0,o.x+=s-u-d;break;case"right":s=t.width+(t.bounds&&n?t.bounds.delta:0),o.x+=s+u}n&&n.interpolate(e,o);var p=e.mark.def.properties.enter.encode;return p.call(p,e,t,n,r,i,a),!0}function a(e,t,n,r,i){var a=e.properties.enter,s=e.properties.update;t&&(a.size=s.size={scale:t.scaleName,field:"data"}),n&&(a.shape=s.shape={scale:n.scaleName,field:"data"}),r&&(a.fill=s.fill={scale:r.scaleName,field:"data"}),i&&(a.stroke=s.stroke={scale:i.scaleName,field:"data"})}function s(e){var t=e.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:t.titleColor},font:{value:t.titleFont},fontSize:{value:t.titleFontSize},fontWeight:{value:t.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function o(e){var t=e.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:t.symbolShape},size:{value:t.symbolSize},stroke:{value:t.symbolColor},strokeWidth:{value:t.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function u(e){var t=e.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:t.labelColor},font:{value:t.labelFont},fontSize:{value:t.labelFontSize},align:{value:t.labelAlign},baseline:{value:t.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function l(e){var t=e.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:t.gradientWidth},height:{value:t.gradientHeight},stroke:{value:t.gradientStrokeColor},strokeWidth:{value:t.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function c(e){var t=e.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:t.labelColor},font:{value:t.labelFont},fontSize:{value:t.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var d="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,f=e("datalib"),h=e("vega-scenegraph").Gradient,p=e("../parse/properties"),g=e("../parse/mark"),m={right:1,left:1};t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../parse/mark":97,"../parse/properties":102,datalib:24,"vega-scenegraph":46}],115:[function(e,t,n){t.exports=function r(e,t){var n,i,a,s,o;if(t(e))return!0;var u=["items","axisItems","legendItems"];for(a=0,s=u.length;s>a;++a)if(o=e[u[a]])for(n=0,i=o.length;i>n;++n)if(r(o[n],t))return!0}},{}],116:[function(e,t,n){function r(e){return d.prototype.init.call(this,e),d.addParameters(this,{groupby:{type:"array<field>"},summarize:{type:"custom",set:function(e){function t(e){e.signal&&(l[e.signal]=1)}var n,r,i,s,o,u,l={},d=this._transform;if(!a.isArray(s=e)){s=[];for(o in e)u=a.array(e[o]),s.push({field:o,ops:u})}for(n=0,r=s.length;r>n;++n)i=s[n],i.field.signal&&(l[i.field.signal]=1),a.array(i.ops).forEach(t),a.array(i.as).forEach(t);return d._fields=s,d._aggr=null,d.dependency(c.SIGNALS,a.keys(l)),d}}}),this._aggr=null,this._input=null,this._args=null,this._fields=[],this._out=[],this._type=p.TUPLE,this._acc={groupby:a["true"],value:a["true"]},this.router(!0).produces(!0)}function i(e){var t,n,r,i,a,s,o,u=[];for(a=e._dims,t=0,n=a.length;n>t;++t)u.push(a[t].name);for(s=e._aggr,t=0,n=s.length;n>t;++t)for(o=s[t].measures.fields,r=0,i=o.length;i>r;++r)u.push(o[r]);return u}var a=e("datalib"),s=e("vega-dataflow"),o=e("vega-logging"),u=s.ChangeSet,l=s.Tuple,c=s.Dependencies,d=e("./Transform"),f=e("./Facetor"),h=r.prototype=Object.create(d.prototype);h.constructor=r;var p=r.TYPES={VALUE:1,TUPLE:2,MULTI:3};r.VALID_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"],h.type=function(e){return this._type=e,this},h.accessors=function(e,t){var n=this._acc;n.groupby=a.$(e)||a["true"],n.value=a.$(t)||a["true"]},h.aggr=function(){if(this._aggr)return this._aggr;var e=this._graph,t=!1,n=[],r=this.param("groupby").field,s=function(t){return t.signal?e.signalRef(t.signal):t},o=this._fields.map(function(e){var r={name:s(e.field),as:a.array(e.as),ops:a.array(s(e.ops)).map(s),get:e.get};return t=t||null!=r.get,n.push(r.name),r});r.forEach(function(e){e.get&&(t=!0),n.push(e.name||e)}),this._args=t||!o.length?null:n,o.length||(o={"*":"values"});var u=this._aggr=(new f).groupby(r).stream(!0).summarize(o);return this._out=i(u),this._type!==p.VALUE&&u.key("_id"),u},h.transform=function(e,t){o.debug(e,["aggregate"]),this._input=e;var n,r,i,a,s=u.create(e),c=this.aggr(),d=this._out,f=this._args,h=!0,g=l.prev;if(t&&(s.rem.push.apply(s.rem,c.result()),c.clear(),this._aggr=null,c=this.aggr()),this._type===p.TUPLE)n=function(e){c._add(e),l.prev_init(e)},r=function(e){c._rem(g(e))},i=function(e){c._mod(e,g(e))};else{var m=this._acc.groupby,v=this._acc.value,y=this._type===p.VALUE?v:function(e){return{_id:e._id,groupby:m(e),value:v(e)}};n=function(e){c._add(y(e)),l.prev_init(e)},r=function(e){c._rem(y(g(e)))},i=function(e){c._mod(y(e),y(g(e)))}}if(e.add.forEach(n),t)e.mod.forEach(n);else{if(e.rem.forEach(r),f)for(a=0,h=!1;a<f.length;++a)if(e.fields[f[a]]){h=!0;break}h&&e.mod.forEach(i)}for(a=0;a<d.length;++a)s.fields[d[a]]=1;return c.changes(s)},t.exports=r},{"./Facetor":122,"./Transform":135,datalib:24,"vega-dataflow":39,"vega-logging":45}],117:[function(e,t,n){function r(){this._collector=null}var i=e("./Transform").prototype,a=r.prototype=Object.create(i);a.constructor=r,a.init=function(e){return i.init.call(this,e),this.batch(!0)},a.transform=function(e){return this.batchTransform(e,this._collector.data())},a.batchTransform=function(){},t.exports=r},{"./Transform":135}],118:[function(e,t,n){function r(e){return o.prototype.init.call(this,e),o.addParameters(this,{field:{type:"field"},min:{type:"value"},max:{type:"value"},base:{type:"value","default":10},maxbins:{type:"value","default":20},step:{type:"value"},steps:{type:"value"},minstep:{type:"value"},div:{type:"array<value>","default":[5,2]}}),this._output={bin:"bin"},this.mutates(!0)}var i=e("datalib").bins,a=e("vega-dataflow").Tuple,s=e("vega-logging"),o=e("./Transform"),u=r.prototype=Object.create(o.prototype);u.constructor=r,u.transform=function(e){function t(e){var t=l(e);t=null==t?null:d.start+d.step*~~((t-d.start)/d.step),a.set(e,n,t)}s.debug(e,["binning"]);var n=this._output.bin,r=this.param("step"),o=this.param("steps"),u=this.param("minstep"),l=this.param("field").accessor,c={min:this.param("min"),max:this.param("max"),base:this.param("base"),maxbins:this.param("maxbins"),div:this.param("div")};r&&(c.step=r),o&&(c.steps=o),u&&(c.minstep=u);var d=i(c);return e.add.forEach(t),e.mod.forEach(t),e.rem.forEach(t),e},t.exports=r},{"./Transform":135,datalib:24,"vega-dataflow":39,"vega-logging":45}],119:[function(e,t,n){function r(e){return o.prototype.init.call(this,e),o.addParameters(this,{field:{type:"field","default":"data"},pattern:{type:"value","default":"[\\w']+"},"case":{type:"value","default":"lower"},stopwords:{type:"value","default":""}}),this._output={text:"text",count:"count"},this.router(!0).produces(!0)}var i=e("vega-dataflow"),a=i.Tuple,s=e("vega-logging"),o=e("./Transform"),u=r.prototype=Object.create(o.prototype);u.constructor=r,u.transform=function(e,t){function n(e){return a.prev_init(e),i(e)}function r(e){return i(a.prev(e))}s.debug(e,["countpattern"]);var i=this.param("field").accessor,o=this.param("pattern"),u=this.param("stopwords"),l=!1;return this._stop!==u&&(this._stop=u,this._stop_re=new RegExp("^"+u+"$","i"),t=!0),this._pattern!==o&&(this._pattern=o,this._match=new RegExp(this._pattern,"g"),t=!0),t&&(this._counts={}),this._add(e.add,n),t||this._rem(e.rem,r),(t||(l=e.fields[i.field]))&&(l&&this._rem(e.mod,r),this._add(e.mod,n)),this._changeset(e)},u._changeset=function(e){var t,n,r,s=this._counts,o=this._tuples||(this._tuples={}),u=i.ChangeSet.create(e),l=this._output;for(t in s)n=o[t],r=s[t]||0,!n&&r?(o[t]=n=a.ingest({}),n[l.text]=t,n[l.count]=r,u.add.push(n)):0===r?(n&&u.rem.push(n),delete s[t],delete o[t]):n[l.count]!==r&&(a.set(n,l.count,r),u.mod.push(n));return u},u._tokenize=function(e){switch(this.param("case")){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(this._match)},u._add=function(e,t){var n,r,i,a,s=this._counts,o=this._stop_re;for(i=0;i<e.length;++i)for(n=this._tokenize(t(e[i])),r=0;r<n.length;++r)o.test(a=n[r])||(s[a]=1+(s[a]||0))},u._rem=function(e,t){var n,r,i,a,s=this._counts,o=this._stop_re;for(i=0;i<e.length;++i)for(n=this._tokenize(t(e[i])),r=0;r<n.length;++r)o.test(a=n[r])||(s[a]-=1)},t.exports=r},{"./Transform":135,"vega-dataflow":39,"vega-logging":45}],120:[function(e,t,n){function r(e){return p.prototype.init.call(this,e),h.addParameters(this,{"with":{type:"data"},diagonal:{type:"value","default":"true"}}),this._output={left:"a",right:"b"},this._lastRem=null,this._lastWith=null,this._ids={},this._cache={},this.router(!0).produces(!0)}function i(e,t){var n=this._cache[e._id]=this._cache[e._id]||{c:[],s:this._stamp};n.c.push(t)}function a(e,t,n,r,a){for(var s,o,u,l=0,c=n.length;c>l;++l)o=n[l],u=t?a._id+"_"+o._id:o._id+"_"+a._id,this._ids[u]||(a._id!=o._id||r)&&(s=d.ingest({}),s[this._output.left]=t?a:o,s[this._output.right]=t?o:a,e.add.push(s),i.call(this,a,s),i.call(this,o,s),this._ids[u]=1)}function s(e,t,n){var r=this,i=this._cache[n._id];this._lastRem>i.s&&(i.c=i.c.filter(function(e){var n=e[r._output[t?"right":"left"]];return null!==r._cache[n._id]}),i.s=this._lastRem),e.mod.push.apply(e.mod,i.c)}function o(e,t){e.rem.push.apply(e.rem,this._cache[t._id].c),this._cache[t._id]=null,this._lastRem=this._stamp}function u(e,t){(e.add.length||e.rem.length)&&(t.fields[this._output.left]=1,t.fields[this._output.right]=1)}var l=e("vega-dataflow"),c=l.ChangeSet,d=l.Tuple,f=e("vega-logging"),h=e("./Transform"),p=e("./BatchTransform"),g=r.prototype=Object.create(p.prototype);g.constructor=r,g.batchTransform=function(e,t){f.debug(e,["crossing"]);var n=this.param("with"),r=this.param("diagonal"),i=!n.name,l=i?e:n.source.last(),d=i?t:n.source.values(),h=c.create(e),p=o.bind(this,h);return e.rem.forEach(p),e.add.forEach(a.bind(this,h,!0,d,r)),!i&&l.stamp>this._lastWith&&(l.rem.forEach(p),l.add.forEach(a.bind(this,h,!1,t,r)),l.mod.forEach(s.bind(this,h,!1)),u.call(this,l,h),this._lastWith=l.stamp),e.mod.forEach(s.bind(this,h,!0)),u.call(this,e,h),h},t.exports=r},{"./BatchTransform":117,"./Transform":135,"vega-dataflow":39,"vega-logging":45}],121:[function(e,t,n){function r(t){return i.addParameters(this,{transform:{type:"custom",set:function(e){return this._transform._pipeline=e,this._transform},get:function(){var t=e("../parse/transforms"),n=this._transform;return n._pipeline.map(function(e){return t(n._graph,e)})}}}),this._pipeline=[],a.call(this,t)}var i=e("./Transform"),a=e("./Aggregate"),s=r.prototype=Object.create(a.prototype);s.constructor=r,s.aggr=function(){return a.prototype.aggr.call(this).facet(this)},t.exports=r},{"../parse/transforms":106,"./Aggregate":116,"./Transform":135}],122:[function(e,t,n){function r(){s.call(this),this._facet=null,this._facetID=++d}function i(e){c.debug({},["disconnecting cell",this.tuple._id]);var t=this.ds.pipeline();e.removeListener(t[0]),e._graph.removeListener(t[0]),e._graph.disconnect(t)}var a=e("datalib"),s=a.Aggregator,o=s.prototype,u=e("vega-dataflow"),l=u.Tuple,c=e("vega-logging"),d=0,f=r.prototype=Object.create(o);f.constructor=r,f.facet=function(e){return arguments.length?(this._facet=e,this):this._facet},f._ingest=function(e){return l.ingest(e,null)},f._assign=l.set,f._newcell=function(e,t){var n=o._newcell.call(this,e,t),r=this._facet;if(r){var a=r._graph,s=n.tuple,u=r.param("transform");n.ds=a.data(s._facetID,u,s),n.disconnect=i,r.addListener(u[0])}return n},f._newtuple=function(e,t){var n=o._newtuple.call(this,e);return this._facet&&(l.set(n,"key",t),l.set(n,"_facetID",this._facetID+"_"+t)),n},f.clear=function(){if(this._facet)for(var e in this._cells)this._cells[e].disconnect(this._facet);return o.clear.call(this)},f._on_add=function(e,t){this._facet&&t.ds._input.add.push(e)},f._on_rem=function(e,t){this._facet&&t.ds._input.rem.push(e)},f._on_mod=function(e,t,n,r){this._facet&&(n===r?n.ds._input.mod.push(e):(n.ds._input.rem.push(e),r.ds._input.add.push(e)))},f._on_drop=function(e){this._facet&&e.disconnect(this._facet)},f._on_keep=function(e){this._facet&&u.ChangeSet.copy(this._input,e.ds._input)},t.exports=r},{datalib:24,"vega-dataflow":39,"vega-logging":45}],123:[function(e,t,n){function r(e){return o.prototype.init.call(this,e),o.addParameters(this,{test:{type:"expr"}}),this._skip={},this.router(!0)}var i=e("vega-dataflow"),a=i.Dependencies.SIGNALS,s=e("vega-logging"),o=e("./Transform"),u=r.prototype=Object.create(o.prototype);u.constructor=r,u.transform=function(e){s.debug(e,["filtering"]);var t=i.ChangeSet.create(e),n=this._graph,r=this._skip,o=this.param("test"),u=n.values(a,this.dependency(a));return e.rem.forEach(function(e){1!==r[e._id]?t.rem.push(e):r[e._id]=0}),e.add.forEach(function(e){o(e,null,u)?t.add.push(e):r[e._id]=1}),e.mod.forEach(function(e){var n=o(e,null,u),i=1===r[e._id];n&&i?(r[e._id]=0,t.add.push(e)):n&&!i?t.mod.push(e):!n&&i||(t.rem.push(e),r[e._id]=1)}),t},t.exports=r},{"./Transform":135,"vega-dataflow":39,"vega-logging":45}],124:[function(e,t,n){function r(e){return o.prototype.init.call(this,e),o.addParameters(this,{fields:{type:"array<field>"}}),this._output={key:"key",value:"value"},this._cache={},this.router(!0).produces(!0)}var i=e("vega-dataflow"),a=i.Tuple,s=e("vega-logging"),o=e("./Transform"),u=r.prototype=Object.create(o.prototype);u.constructor=r,u._reset=function(e,t){for(var n in this._cache)t.rem.push.apply(t.rem,this._cache[n]);this._cache={}},u._tuple=function(e,t,n){var r=this._cache[e._id]||(this._cache[e._id]=Array(n));return r[t]?a.rederive(e,r[t]):r[t]=a.derive(e)},u._fn=function(e,t,n){var r,i,s,o,u,l;for(r=0,s=e.length;s>r;++r)for(u=e[r],i=0,o=t.field.length;o>i;++i)l=this._tuple(u,i,o),a.set(l,this._output.key,t.field[i]),a.set(l,this._output.value,t.accessor[i](u)),n.push(l)},u.transform=function(e,t){s.debug(e,["folding"]);var n=this,r=this.param("fields"),a=i.ChangeSet.create(e);return t&&this._reset(e,a),this._fn(e.add,r,a.add),this._fn(e.mod,r,t?a.add:a.mod),e.rem.forEach(function(e){a.rem.push.apply(a.rem,n._cache[e._id]),n._cache[e._id]=null}),(e.add.length||e.rem.length||r.field.some(function(t){return!!e.fields[t]}))&&(a.fields[this._output.key]=1,a.fields[this._output.value]=1),a},t.exports=r},{"./Transform":135,"vega-dataflow":39,"vega-logging":45}],125:[function(e,t,n){(function(n){function r(e){return l.prototype.init.call(this,e),this._prev=null,this._interactive=!1,this._setup=!0,this._nodes=[],this._links=[],this._layout=i.layout.force(),l.addParameters(this,{size:{type:"array<value>","default":[500,500]},bound:{type:"value","default":!0},links:{type:"data"},linkStrength:{type:"value","default":1},linkDistance:{type:"value","default":20},charge:{type:"value","default":-30},chargeDistance:{type:"value","default":1/0},friction:{type:"value","default":.9},theta:{type:"value","default":.8},gravity:{type:"value","default":.1},alpha:{type:"value","default":.1},iterations:{type:"value","default":500},interactive:{type:"value","default":this._interactive},active:{type:"value","default":this._prev},fixed:{type:"data"}}),this._output={x:"layout_x",y:"layout_y"},this.mutates(!0)}var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("vega-dataflow"),s=a.Tuple,o=a.ChangeSet,u=e("vega-logging"),l=e("./Transform"),c=r.prototype=Object.create(l.prototype);c.constructor=r,c.transform=function(e,t){u.debug(e,["force"]),t-=e.signals.active?1:0;var n=this.param("interactive"),r=this.param("links").source,i=r.last(),a=this.param("active"),o=this._output,l=this._layout,c=this._nodes,d=this._links;if(i.stamp<e.stamp&&(i=null),this.configure(e,i,n,t),!n){for(var f=this.param("iterations"),h=0;f>h;++h)l.tick();l.stop()}return this.update(a),(t||a!==this._prev&&a&&a.update)&&l.alpha(this.param("alpha")),a!==this._prev&&(this._prev=a),e.rem.length&&l.nodes(this._nodes=s.idFilter(c,e.rem)),i&&i.rem.length&&l.links(this._links=s.idFilter(d,i.rem)),e.fields[o.x]=1,e.fields[o.y]=1,e},c.configure=function(e,t,n,r){var i=this._layout,a=this._setup||e.add.length||t&&t.add.length||n!==this._interactive||this.param("charge")!==i.charge()||this.param("linkStrength")!==i.linkStrength()||this.param("linkDistance")!==i.linkDistance();if((a||r)&&i.size(this.param("size")).chargeDistance(this.param("chargeDistance")).theta(this.param("theta")).gravity(this.param("gravity")).friction(this.param("friction")),a){this._setup=!1,this._interactive=n;var s,u,l=this,c=this._graph,d=this._nodes,f=this._links;for(s=e.add,u=0;u<s.length;++u)d.push({tuple:s[u]});if(t)for(s=t.add,u=0;u<s.length;++u)f.push({tuple:s[u],source:d[s[u].source],target:d[s[u].target]});var h=n?function(){c.propagate(o.create(null,!0),l)}:null;i.linkStrength(this.param("linkStrength")).linkDistance(this.param("linkDistance")).charge(this.param("charge")).nodes(d).links(f).on("tick",h).start().alpha(this.param("alpha"))}},c.update=function(e){var t,n,r,i,a,o,u=this._output,l=this.param("bound"),c=this.param("fixed"),d=this.param("size"),f=this._nodes,h={};if(c&&c.source)for(c=c.source.values(),n=0,r=c.length;r>n;++n)h[c[n].id]=1;for(n=0;n<f.length;++n)r=f[n],i=r.tuple,t=i._id,e&&e.id===t?(r.fixed=1,e.update&&(r.x=r.px=e.x,r.y=r.py=e.y)):r.fixed=h[t]||0,a=l?Math.max(0,Math.min(r.x,d[0])):r.x,o=l?Math.max(0,Math.min(r.y,d[1])):r.y,s.set(i,u.x,a),s.set(i,u.y,o)},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Transform":135,"vega-dataflow":39,"vega-logging":45}],126:[function(e,t,n){function r(e){return u.prototype.init.call(this,e),u.addParameters(this,{field:{type:"value"},expr:{type:"expr"}}),this.mutates(!0)}var i=e("vega-dataflow"),a=i.Tuple,s=i.Dependencies.SIGNALS,o=e("vega-logging"),u=e("./Transform"),l=r.prototype=Object.create(u.prototype);l.constructor=r,l.transform=function(e){function t(e){a.set(e,r,i(e,null,u))}o.debug(e,["formulating"]);var n=this._graph,r=this.param("field"),i=this.param("expr"),u=n.values(s,this.dependency(s));return e.add.forEach(t),this.reevaluate(e)&&e.mod.forEach(t),e.fields[r]=1,e},t.exports=r},{"./Transform":135,"vega-dataflow":39,"vega-logging":45}],127:[function(e,t,n){(function(n){function r(e){return u.prototype.init.call(this,e),u.addParameters(this,r.Parameters),u.addParameters(this,{lon:{type:"field"},lat:{type:"field"}}),this._output={x:"layout_x",y:"layout_y"},this.mutates(!0)}var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("datalib"),s=e("vega-dataflow").Tuple,o=e("vega-logging"),u=e("./Transform");r.Parameters={projection:{type:"value","default":"mercator"},center:{type:"array<value>"},translate:{type:"array<value>"},rotate:{type:"array<value>"},scale:{type:"value"},precision:{type:"value"},clipAngle:{type:"value"},clipExtent:{type:"value"}},r.d3Projection=function(){var e,t,n,s=this.param("projection"),o=r.Parameters;s!==this._mode&&(this._mode=s,this._projection=i.geo[s]()),e=this._projection;for(t in o)"projection"!==t&&e[t]&&(n=this.param(t),void 0===n||a.isArray(n)&&0===n.length||n!==e[t]()&&e[t](n));return e};var l=r.prototype=Object.create(u.prototype);l.constructor=r,l.transform=function(e){function t(e){var t=[i(e),a(e)],r=u(t)||[null,null];s.set(e,n.x,r[0]),s.set(e,n.y,r[1])}o.debug(e,["geo"]);var n=this._output,i=this.param("lon").accessor,a=this.param("lat").accessor,u=r.d3Projection.call(this);return e.add.forEach(t),this.reevaluate(e)&&(e.mod.forEach(t),e.rem.forEach(t)),e.fields[n.x]=1,e.fields[n.y]=1,e},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Transform":135,datalib:24,"vega-dataflow":39,"vega-logging":45}],128:[function(e,t,n){(function(n){function r(e){return l.prototype.init.call(this,e),l.addParameters(this,u.Parameters),l.addParameters(this,{field:{type:"field","default":null}}),this._output={path:"layout_path"},this.mutates(!0)}var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("datalib"),s=e("vega-dataflow").Tuple,o=e("vega-logging"),u=e("./Geo"),l=e("./Transform"),c=r.prototype=Object.create(l.prototype);c.constructor=r,c.transform=function(e){function t(e){s.set(e,n.path,c(r(e)))}o.debug(e,["geopath"]);var n=this._output,r=this.param("field").accessor||a.identity,l=u.d3Projection.call(this),c=i.geo.path().projection(l);return e.add.forEach(t),this.reevaluate(e)&&(e.mod.forEach(t),e.rem.forEach(t)),e.fields[n.path]=1,e},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Geo":127,"./Transform":135,datalib:24,"vega-dataflow":39,"vega-logging":45}],129:[function(e,t,n){function r(e){return c.prototype.init.call(this,e),c.addParameters(this,{sourceX:{type:"field","default":"_source.layout_x"},sourceY:{type:"field","default":"_source.layout_y"},targetX:{type:"field","default":"_target.layout_x"},targetY:{type:"field","default":"_target.layout_y"},tension:{type:"value","default":.2},shape:{type:"value","default":"line"}}),this._output={path:"layout_path"},this.mutates(!0)}function i(e,t,n,r){return"M"+e+","+t+"L"+n+","+r}function a(e,t,n,r,i){var a=n-e,s=r-t,o=i*(a+s),u=i*(s-a);return"M"+e+","+t+"C"+(e+o)+","+(t+u)+" "+(n+u)+","+(r-o)+" "+n+","+r}function s(e,t,n,r){var i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r}function o(e,t,n,r){var i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r}var u=e("vega-dataflow").Tuple,l=e("vega-logging"),c=e("./Transform"),d=r.prototype=Object.create(c.prototype);d.constructor=r;var f={line:i,curve:a,diagonal:s,diagonalX:s,diagonalY:o};d.transform=function(e){function t(e){var t=r(i(e),a(e),s(e),o(e),c);u.set(e,n.path,t)}l.debug(e,["linkpath"]);var n=this._output,r=f[this.param("shape")]||f.line,i=this.param("sourceX").accessor,a=this.param("sourceY").accessor,s=this.param("targetX").accessor,o=this.param("targetY").accessor,c=this.param("tension");return e.add.forEach(t),this.reevaluate(e)&&(e.mod.forEach(t),e.rem.forEach(t)),e.fields[n.path]=1,e},t.exports=r},{"./Transform":135,"vega-dataflow":39,"vega-logging":45}],130:[function(e,t,n){function r(e){return s.prototype.init.call(this,e),s.addParameters(this,{on:{type:"data"},onKey:{type:"field","default":null},as:{type:"array<value>"},keys:{type:"array<field>","default":["data"]},"default":{type:"value"}}),this.mutates(!0)}var i=e("vega-dataflow").Tuple,a=e("vega-logging"),s=e("./Transform"),o=r.prototype=Object.create(s.prototype);o.constructor=r,o.transform=function(e,t){function n(e){for(var t=0;t<h.length;++t){var n=m[h[t](e)]||g;i.set(e,p[t],n)}}a.debug(e,["lookup"]);var r,s,o=this.param("on"),u=o.source.last(),l=o.source.values(),c=this.param("onKey"),d=c.field,f=this.param("keys"),h=f.accessor,p=this.param("as"),g=this.param("default"),m=this._lut;
if(null==m||this._on!==d||d&&u.fields[d]||u.add.length||u.rem.length){if(d)for(c=c.accessor,m={},r=0;r<l.length;++r)m[c(s=l[r])]=s;else m=l;this._lut=m,this._on=d,t=!0}e.add.forEach(n);var v=f.field.some(function(t){return e.fields[t]});return(v||t)&&(e.mod.forEach(n),e.rem.forEach(n)),p.forEach(function(t){e.fields[t]=1}),e},t.exports=r},{"./Transform":135,"vega-dataflow":39,"vega-logging":45}],131:[function(e,t,n){function r(e,t,n){this._name=e,this._type=t,this._transform=n,this._value=[],this._accessors=[],this._resolution=!1,this._signals={}}function i(){var e=u.test(this._type),t=l.test(this._type),n=c.test(this._type),r=e?this._value:this._value[0],i=e?this._accessors:this._accessors[0];return!a.isValid(i)&&f.test(this._type)?r:t?{name:r,source:i}:n?{field:r,accessor:i}:r}var a=e("datalib"),s=e("vega-dataflow").Dependencies,o=e("../parse/expr"),u=/array/i,l=/data/i,c=/field/i,d=/expr/i,f=/value/i,h=r.prototype;h.get=function(){var e,t,n,r=this._transform._graph,s=l.test(this._type),o=c.test(this._type);if(!this._resolution)return i.call(this);if(s)return this._accessors=this._value.map(function(e){return r.data(e)}),i.call(this);for(e in this._signals)t=this._signals[e],n=r.signalRef(e),o&&(this._accessors[t]=this._value[t]!=n?a.accessor(n):this._accessors[t]),this._value[t]=n;return i.call(this)},h.set=function(e){var t=this,n=d.test(this._type),r=l.test(this._type),i=c.test(this._type);return this._value=a.array(e).map(function(e,u){if(a.isString(e)){if(n){var l=o(e);return t._transform.dependency(s.FIELDS,l.fields),t._transform.dependency(s.SIGNALS,l.globals),l.fn}return i?(t._accessors[u]=a.accessor(e),t._transform.dependency(s.FIELDS,a.field(e))):r&&(t._resolution=!0,t._transform.dependency(s.DATA,e)),e}return void 0!==e.value?e.value:void 0!==e.field?(t._accessors[u]=a.accessor(e.field),t._transform.dependency(s.FIELDS,a.field(e.field)),e.field):void 0!==e.signal?(t._resolution=!0,t._signals[e.signal]=u,t._transform.dependency(s.SIGNALS,e.signal),e.signal):e}),t._transform},t.exports=r},{"../parse/expr":94,datalib:24,"vega-dataflow":39}],132:[function(e,t,n){function r(e){return l.prototype.init.call(this,e),u.addParameters(this,{field:{type:"field","default":null},startAngle:{type:"value","default":0},endAngle:{type:"value","default":2*Math.PI},sort:{type:"value","default":!1}}),this._output={start:"layout_start",end:"layout_end",mid:"layout_mid"},this.mutates(!0)}function i(){return 1}var a=e("datalib"),s=e("vega-dataflow").Tuple,o=e("vega-logging"),u=e("./Transform"),l=e("./BatchTransform"),c=r.prototype=Object.create(l.prototype);c.constructor=r,c.batchTransform=function(e,t){o.debug(e,["pie"]);var n,r,u,l=this._output,c=this.param("field").accessor||i,d=this.param("startAngle"),f=this.param("endAngle"),h=this.param("sort"),p=t.map(c),g=d,m=(f-d)/a.sum(p),v=a.range(t.length);for(h&&v.sort(function(e,t){return p[e]-p[t]}),n=0;n<v.length;++n)r=t[v[n]],u=p[v[n]],s.set(r,l.start,g),s.set(r,l.mid,g+.5*u*m),s.set(r,l.end,g+=u*m);return e.fields[l.start]=1,e.fields[l.end]=1,e.fields[l.mid]=1,e},t.exports=r},{"./BatchTransform":117,"./Transform":135,datalib:24,"vega-dataflow":39,"vega-logging":45}],133:[function(e,t,n){function r(e){s.prototype.init.call(this,e),s.addParameters(this,{by:{type:"array<field>"}}),this.router(!0)}var i=e("datalib"),a=e("vega-logging"),s=e("./Transform"),o=r.prototype=Object.create(s.prototype);o.constructor=r,o.transform=function(e){return a.debug(e,["sorting"]),(e.add.length||e.mod.length||e.rem.length)&&(e.sort=i.comparator(this.param("by").field)),e},t.exports=r},{"./Transform":135,datalib:24,"vega-logging":45}],134:[function(e,t,n){function r(e){return l.prototype.init.call(this,e),u.addParameters(this,{groupby:{type:"array<field>"},sortby:{type:"array<field>"},field:{type:"field"},offset:{type:"value","default":"zero"}}),this._output={start:"layout_start",end:"layout_end",mid:"layout_mid"},this.mutates(!0)}function i(e,t,n,r){var i,a,s,o,u,l,c,d=[],f=function(e){return e(s)};if(null==t)d.push(e.slice());else for(i={},a=0;a<e.length;++a)s=e[a],o=t.map(f),u=i[o]||(d.push(i[o]=[]),i[o]),u.push(s);for(o=0,c=0;o<d.length;++o){for(u=d[o],a=0,l=0;a<u.length;++a)l+=r(u[a]);u.sum=l,l>c&&(c=l),null!=n&&u.sort(n)}return d.max=c,d}var a=e("datalib"),s=e("vega-dataflow").Tuple,o=e("vega-logging"),u=e("./Transform"),l=e("./BatchTransform"),c=r.prototype=Object.create(l.prototype);c.constructor=r,c.batchTransform=function(e,t){o.debug(e,["stacking"]);for(var n=this.param("groupby").accessor,r=a.comparator(this.param("sortby").field),u=this.param("field").accessor,l=this.param("offset"),c=this._output,d=i(t,n,r,u),f=0,h=d.max;f<d.length;++f){var p,g,m,v=d[f],y=v.sum,_="center"===l?(h-y)/2:0,b="normalize"===l?1/y:1,x=_,w=0;for(p=0;p<v.length;++p)g=v[p],m=x,w+=u(g),x=b*w+_,s.set(g,c.start,m),s.set(g,c.end,x),s.set(g,c.mid,.5*(m+x))}return e.fields[c.start]=1,e.fields[c.end]=1,e.fields[c.mid]=1,e},t.exports=r},{"./BatchTransform":117,"./Transform":135,datalib:24,"vega-dataflow":39,"vega-logging":45}],135:[function(e,t,n){function r(e){e&&a.init.call(this,e)}var i=e("vega-dataflow"),a=i.Node.prototype,s=i.Dependencies,o=e("./Parameter");r.addParameters=function(e,t){e._parameters=e._parameters||{};for(var n in t){var r=t[n],i=new o(n,r.type,e);e._parameters[n]=i,"custom"===r.type&&(r.set&&(i.set=r.set.bind(i)),r.get&&(i.get=r.get.bind(i))),r.hasOwnProperty("default")&&i.set(r["default"])}};var u=r.prototype=Object.create(a);u.constructor=r,u.param=function(e,t){var n=this._parameters[e];return void 0===n?this:1===arguments.length?n.get():n.set(t)},u.transform=function(e){return e},u.evaluate=function(e){var t=this._stamp<e.stamp&&this.dependency(s.SIGNALS).reduce(function(t,n){return t+=e.signals[n]?1:0},0);return this.transform(e,t)},u.output=function(e){for(var t in this._output)void 0!==e[t]&&(this._output[t]=e[t]);return this},t.exports=r},{"./Parameter":131,"vega-dataflow":39}],136:[function(e,t,n){(function(n){function r(e){return l.prototype.init.call(this,e),u.addParameters(this,{sort:{type:"array<field>","default":["-value"]},children:{type:"field","default":"children"},field:{type:"field","default":"value"},size:{type:"array<value>","default":[500,500]},round:{type:"value","default":!0},sticky:{type:"value","default":!1},ratio:{type:"value","default":c},padding:{type:"value","default":null},mode:{type:"value","default":"squarify"}}),this._layout=i.layout.treemap(),this._output={x:"layout_x",y:"layout_y",width:"layout_width",height:"layout_height",depth:"layout_depth"},this.mutates(!0)}var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("datalib"),s=e("vega-dataflow").Tuple,o=e("vega-logging"),u=e("./Transform"),l=e("./BatchTransform"),c=.5*(1+Math.sqrt(5)),d=r.prototype=Object.create(l.prototype);d.constructor=r,d.batchTransform=function(e,t){o.debug(e,["treemap"]);var n=this._layout,r=this._output;return n.sort(a.comparator(this.param("sort").field)).children(this.param("children").accessor).value(this.param("field").accessor).size(this.param("size")).round(this.param("round")).sticky(this.param("sticky")).ratio(this.param("ratio")).padding(this.param("padding")).mode(this.param("mode")).nodes(t[0]),t.forEach(function(e){s.set(e,r.x,e.x),s.set(e,r.y,e.y),s.set(e,r.width,e.dx),s.set(e,r.height,e.dy),s.set(e,r.depth,e.depth)}),e.fields[r.x]=1,e.fields[r.y]=1,e.fields[r.width]=1,e.fields[r.height]=1,e},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./BatchTransform":117,"./Transform":135,datalib:24,"vega-dataflow":39,"vega-logging":45}],137:[function(e,t,n){(function(n){function r(e){return u.prototype.init.call(this,e),o.addParameters(this,{clipExtent:{type:"array<value>","default":[[-1e5,-1e5],[1e5,1e5]]},x:{type:"field","default":"layout_x"},y:{type:"field","default":"layout_y"}}),this._layout=i.geom.voronoi(),this._output={path:"layout_path"},this.mutates(!0)}var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("vega-dataflow/src/Tuple"),s=e("vega-logging"),o=e("./Transform"),u=e("./BatchTransform"),l=r.prototype=Object.create(u.prototype);l.constructor=r,l.batchTransform=function(e,t){s.debug(e,["voronoi"]);for(var n=this._output.path,r=this._layout.clipExtent(this.param("clipExtent")).x(this.param("x").accessor).y(this.param("y").accessor)(t),i=0;i<t.length;++i)a.set(t[i],n,"M"+r[i].join("L")+"Z");return e.fields[n]=1,e},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./BatchTransform":117,"./Transform":135,"vega-dataflow/src/Tuple":38,"vega-logging":45}],138:[function(e,t,n){(function(n){function r(e){return f.prototype.init.call(this,e),d.addParameters(this,{size:{type:"array<value>","default":[900,500]},text:{type:"field","default":"data"},rotate:{type:"field|value","default":0},font:{type:"field|value","default":{value:"sans-serif"}},fontSize:{type:"field|value","default":14},fontStyle:{type:"field|value","default":{value:"normal"}},fontWeight:{type:"field|value","default":{value:"normal"}},fontScale:{type:"array<value>","default":[10,50]},padding:{type:"value","default":1},spiral:{type:"value","default":"archimedean"}}),this._layout=u(),this._output={x:"layout_x",y:"layout_y",font:"layout_font",fontSize:"layout_fontSize",fontStyle:"layout_fontStyle",fontWeight:"layout_fontWeight",rotate:"layout_rotate"},this.mutates(!0)}function i(e){return e&&e.accessor||e}function a(e){var t=Object.create(e);return t._tuple=e,t}var s=e("datalib"),o="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,u="undefined"!=typeof window?window.d3.layout.cloud:"undefined"!=typeof n?n.d3.layout.cloud:null,l=e("vega-dataflow/src/Tuple"),c=e("vega-logging"),d=e("./Transform"),f=e("./BatchTransform"),h=r.prototype=Object.create(f.prototype);h.constructor=r,h.batchTransform=function(e,t){c.debug(e,["wordcloud"]);var n,r,u=this._layout,d=this._output,f=this.param("fontSize"),h=f.accessor&&this.param("fontScale");f=f.accessor||o.functor(f),h.length&&(r=o.scale.sqrt().domain(s.extent(t,n=f)).range(h),f=function(e){return r(n(e))}),u.size(this.param("size")).text(i(this.param("text"))).padding(this.param("padding")).spiral(this.param("spiral")).rotate(i(this.param("rotate"))).font(i(this.param("font"))).fontStyle(i(this.param("fontStyle"))).fontWeight(i(this.param("fontWeight"))).fontSize(f).words(t.map(a)).on("end",function(e){var t,n,r,i,a=u.size(),s=a[0]>>1,o=a[1]>>1;for(r=0,i=e.length;i>r;++r)t=e[r],n=t._tuple,l.set(n,d.x,t.x+s),l.set(n,d.y,t.y+o),l.set(n,d.font,t.font),l.set(n,d.fontSize,t.size),l.set(n,d.fontStyle,t.style),l.set(n,d.fontWeight,t.weight),l.set(n,d.rotate,t.rotate)}).start();for(var p in d)e.fields[d[p]]=1;return e},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./BatchTransform":117,"./Transform":135,datalib:24,"vega-dataflow/src/Tuple":38,"vega-logging":45}],139:[function(e,t,n){t.exports={aggregate:e("./Aggregate"),bin:e("./Bin"),cross:e("./Cross"),countpattern:e("./CountPattern"),linkpath:e("./LinkPath"),facet:e("./Facet"),filter:e("./Filter"),fold:e("./Fold"),force:e("./Force"),formula:e("./Formula"),geo:e("./Geo"),geopath:e("./GeoPath"),lookup:e("./Lookup"),pie:e("./Pie"),sort:e("./Sort"),stack:e("./Stack"),treemap:e("./Treemap"),voronoi:e("./Voronoi"),wordcloud:e("./Wordcloud")}},{"./Aggregate":116,"./Bin":118,"./CountPattern":119,"./Cross":120,"./Facet":121,"./Filter":123,"./Fold":124,"./Force":125,"./Formula":126,"./Geo":127,"./GeoPath":128,"./LinkPath":129,"./Lookup":130,"./Pie":132,"./Sort":133,"./Stack":134,"./Treemap":136,"./Voronoi":137,"./Wordcloud":138}]},{},[1])(1)});
